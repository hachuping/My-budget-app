<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïä§ÎßàÌä∏ Í∞ÄÍ≥ÑÎ∂Ä</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .page { display: none; }
        .page.active { display: block; }
        .nav-item.active { background-color: #3b82f6; color: white; }
        .chart-container { position: relative; height: 300px; }
        .chart-bar { transition: all 0.3s ease; }
        .chart-bar:hover { opacity: 0.8; }
        
        .calendar-container {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .calendar-header {
            background-color: #f3f4f6;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            color: #374151;
        }
        
        .calendar-day {
            background-color: white;
            min-height: 80px;
            padding: 8px 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .calendar-day:hover {
            background-color: #f9fafb;
            transform: scale(1.02);
        }
        
        .calendar-day.other-month {
            background-color: #f9fafb;
            color: #9ca3af;
        }
        
        .calendar-day.today {
            background-color: #dbeafe;
            border: 2px solid #3b82f6;
        }
        
        .calendar-day.no-spend {
            background-color: #fef3c7;
        }
        
        .calendar-day-number {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .calendar-indicators {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            justify-content: center;
        }
        
        .calendar-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }
        
        .calendar-indicator.income { background-color: #10b981; }
        .calendar-indicator.savings { background-color: #3b82f6; }
        .calendar-indicator.expense { background-color: #ef4444; }
        
        .no-spend-icon {
            font-size: 16px;
            margin-top: 2px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .close {
            color: #9ca3af;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        
        .close:hover {
            color: #374151;
        }
        
        .comment-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
        }
        
        .comment-item {
            background-color: #f9fafb;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
        }
        
        .comment-author {
            font-weight: 600;
            font-size: 14px;
            color: #374151;
            margin-bottom: 4px;
        }
        
        .comment-text {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 4px;
        }
        
        .comment-date {
            font-size: 12px;
            color: #9ca3af;
        }
        
        .mood-btn.selected {
            background-color: #3b82f6;
            border-color: #3b82f6;
            color: white;
            transform: scale(1.1);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
    <nav class="bg-white shadow-lg border-b">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <h1 class="text-2xl font-bold text-gray-800">üí∞ Ïä§ÎßàÌä∏ Í∞ÄÍ≥ÑÎ∂Ä</h1>
                <div class="flex space-x-2">
                    <button onclick="showPage('entry')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-blue-500 text-white">ÎÇ¥Ïó≠ ÏûÖÎ†•</button>
                    <button onclick="showPage('monthly')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100">ÏõîÎ≥Ñ Ï†ïÎ¶¨</button>
                    <button onclick="showPage('yearly')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100">Ïó∞ÎèÑÎ≥Ñ Ï†ïÎ¶¨</button>
                    <button onclick="showPage('assets')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100">ÏûêÏÇ∞ Í¥ÄÎ¶¨</button>
                    <button onclick="showPage('settings')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100">ÏÑ§Ï†ï</button>
                    <button onclick="showPage('share')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100">Í≥µÏú†</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ÌéòÏù¥ÏßÄ 1: ÎÇ¥Ïó≠ ÏûÖÎ†• -->
    <div id="entry" class="page active">
        <div class="max-w-4xl mx-auto p-6">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold mb-6 text-gray-800">üí≥ ÏàòÏûÖ/ÏßÄÏ∂ú ÎÇ¥Ïó≠ ÏûÖÎ†•</h2>
                
                <form id="entryForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÎÇ†Ïßú</label>
                        <input type="date" id="entryDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ïú†Ìòï</label>
                        <select id="entryType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="updateCategories()" required>
                            <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                            <option value="income">ÏàòÏûÖ</option>
                            <option value="savings">Ï†ÄÏ∂ï</option>
                            <option value="expense">ÏßÄÏ∂ú</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ïπ¥ÌÖåÍ≥†Î¶¨</label>
                        <select id="entryCategory" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Ïú†ÌòïÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Í∏àÏï°</label>
                        <div class="flex space-x-2">
                            <input type="text" id="entryAmount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" required oninput="formatAmountInput(this)" style="min-width: 200px;">
                            <select id="entryCurrency" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent whitespace-nowrap">
                                <option value="KRW">Ïõê (‚Ç©)</option>
                                <option value="USD">Îã¨Îü¨ ($)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="memoMoodSection" class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4" style="display: none;">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÏÉÅÏÑ∏ Î©îÎ™® üìù</label>
                            <textarea id="entryMemo" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none" placeholder="Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ ÏòàÏãúÍ∞Ä ÌëúÏãúÎê©ÎãàÎã§"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ïò§ÎäòÏùò Í∏∞Î∂Ñ üòä</label>
                            <div class="grid grid-cols-5 gap-2">
                                <button type="button" class="mood-btn p-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-2xl" onclick="selectMood(this, 'üòä')">üòä</button>
                                <button type="button" class="mood-btn p-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-2xl" onclick="selectMood(this, 'üò¢')">üò¢</button>
                                <button type="button" class="mood-btn p-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-2xl" onclick="selectMood(this, 'üòç')">üòç</button>
                                <button type="button" class="mood-btn p-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-2xl" onclick="selectMood(this, 'üò§')">üò§</button>
                                <button type="button" class="mood-btn p-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-2xl" onclick="selectMood(this, 'ü§î')">ü§î</button>
                            </div>
                            <input type="hidden" id="entryMood" value="">
                            <p class="text-xs text-gray-500 mt-2">ÏßÄÏ∂úÏù¥Ïñ¥ÎèÑ Í∏∞Î∂Ñ Ï¢ãÏùÄ ÏÜåÎπÑÍ∞Ä ÏûàÍ≥†, ÏàòÏûÖÏù¥Ïñ¥ÎèÑ Î≥µÏû°Ìïú Í∞êÏ†ïÏù¥ ÏûàÏùÑ Ïàò ÏûàÏñ¥Ïöî!</p>
                        </div>
                    </div>
                    
                    <div id="receiptSection" class="md:col-span-2" style="display: none;">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÏòÅÏàòÏ¶ù Ï†ïÎ≥¥ üßæ</label>
                        <div class="space-y-3 p-4 bg-gray-50 rounded-lg">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">ÏÉÅÌò∏Î™Ö</label>
                                    <input type="text" id="receiptStore" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ïòà: Ïù¥ÎßàÌä∏ ÏõîÎìúÏªµÏ†ê">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">Í≤∞Ï†ú Î∞©Î≤ï</label>
                                    <select id="receiptPayment" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">ÏÑ†ÌÉù</option>
                                        <option value="card">Ïã†Ïö©Ïπ¥Îìú</option>
                                        <option value="cash">ÌòÑÍ∏à</option>
                                        <option value="transfer">Í≥ÑÏ¢åÏù¥Ï≤¥</option>
                                        <option value="mobile">Î™®Î∞îÏùºÌéòÏù¥</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600 mb-1">Íµ¨Îß§ ÌíàÎ™© (Ìïú Ï§ÑÏóê ÌïòÎÇòÏî©)</label>
                                <textarea id="receiptItems" rows="3" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none" placeholder="ÏÇ¨Í≥º 3Í∞ú - 4,500Ïõê
Ïö∞Ïú† 2Ìå© - 3,200Ïõê
Í≥ÑÎûÄ 1Ìåê - 2,800Ïõê"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="md:col-span-2">
                        <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            ‚úÖ ÎÇ¥Ïó≠ Ï∂îÍ∞Ä
                        </button>
                    </div>
                </form>
            </div>

            <!-- ÏµúÍ∑º ÎÇ¥Ïó≠ -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">üìã ÏµúÍ∑º ÎÇ¥Ïó≠</h3>
                <div id="recentEntries" class="space-y-3">
                    <!-- ÏµúÍ∑º ÎÇ¥Ïó≠Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            </div>
        </div>
    </div>

    <!-- ÌéòÏù¥ÏßÄ 2: ÏõîÎ≥Ñ Ï†ïÎ¶¨ -->
    <div id="monthly" class="page">
        <div class="max-w-7xl mx-auto p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">üìä ÏõîÎ≥Ñ Í∞ÄÍ≥ÑÎ∂Ä</h2>
                <div class="flex items-center space-x-4">
                    <select id="monthlyYear" class="px-3 py-2 border border-gray-300 rounded-lg" onchange="updateMonthlyView()">
                        <!-- Ïó∞ÎèÑ ÏòµÏÖòÏù¥ ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                    </select>
                    <select id="monthlyMonth" class="px-3 py-2 border border-gray-300 rounded-lg" onchange="updateMonthlyView()">
                        <option value="1">1Ïõî</option>
                        <option value="2">2Ïõî</option>
                        <option value="3">3Ïõî</option>
                        <option value="4">4Ïõî</option>
                        <option value="5">5Ïõî</option>
                        <option value="6">6Ïõî</option>
                        <option value="7">7Ïõî</option>
                        <option value="8">8Ïõî</option>
                        <option value="9">9Ïõî</option>
                        <option value="10">10Ïõî</option>
                        <option value="11">11Ïõî</option>
                        <option value="12">12Ïõî</option>
                    </select>
                </div>
            </div>

            <!-- ÏõîÎ≥Ñ Îã¨Î†• -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">üìÖ ÏõîÎ≥Ñ Îã¨Î†•</h3>
                <div id="monthlyCalendar" class="calendar-container">
                    <!-- Îã¨Î†•Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
                <div class="flex items-center justify-center space-x-6 mt-4 text-sm">
                    <div class="flex items-center space-x-1">
                        <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                        <span>ÏàòÏûÖ</span>
                    </div>
                    <div class="flex items-center space-x-1">
                        <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
                        <span>Ï†ÄÏ∂ï</span>
                    </div>
                    <div class="flex items-center space-x-1">
                        <span class="w-3 h-3 bg-red-500 rounded-full"></span>
                        <span>ÏßÄÏ∂ú</span>
                    </div>
                    <div class="flex items-center space-x-1">
                        <span class="text-lg">üéâ</span>
                        <span>Î¨¥ÏßÄÏ∂ú</span>
                    </div>
                </div>
            </div>

            <!-- ÏõîÎ≥Ñ ÏöîÏïΩ -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="bg-green-50 border border-green-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-green-600 text-sm font-medium">Ï¥ù ÏàòÏûÖ</p>
                            <p id="monthlyIncome" class="text-2xl font-bold text-green-700">0Ïõê</p>
                            <div id="incomeChange" class="text-xs mt-1"></div>
                        </div>
                        <div class="text-green-500 text-3xl">üí∞</div>
                    </div>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-blue-600 text-sm font-medium">Ï¥ù Ï†ÄÏ∂ï</p>
                            <p id="monthlySavings" class="text-2xl font-bold text-blue-700">0Ïõê</p>
                            <div id="savingsChange" class="text-xs mt-1"></div>
                        </div>
                        <div class="text-blue-500 text-3xl">üè¶</div>
                    </div>
                </div>
                
                <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-red-600 text-sm font-medium">Ï¥ù ÏßÄÏ∂ú</p>
                            <p id="monthlyExpense" class="text-2xl font-bold text-red-700">0Ïõê</p>
                            <div id="expenseChange" class="text-xs mt-1"></div>
                        </div>
                        <div class="text-red-500 text-3xl">üí∏</div>
                    </div>
                </div>
                
                <div class="bg-purple-50 border border-purple-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-purple-600 text-sm font-medium">Ïàú ÏûêÏÇ∞ Î≥ÄÌôî</p>
                            <p id="monthlyNet" class="text-2xl font-bold text-purple-700">0Ïõê</p>
                            <div id="netChange" class="text-xs mt-1"></div>
                        </div>
                        <div class="text-purple-500 text-3xl">üìà</div>
                    </div>
                </div>
            </div>

            <!-- ÏòàÏÇ∞ ÎåÄÎπÑ ÌòÑÌô© -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">üéØ ÏòàÏÇ∞ Îã¨ÏÑ± ÌòÑÌô©</h3>
                <div id="budgetProgress" class="space-y-4">
                    <!-- ÏòàÏÇ∞ ÏßÑÌñâÎ•†Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            </div>

            <!-- ÏßÄÏ∂ú Î∂ÑÏÑù -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-red-700">üîç ÏßÄÏ∂ú Î∂ÑÏÑù</h3>
                <div id="expenseAnalysis" class="space-y-4">
                    <!-- ÏßÄÏ∂ú Î∂ÑÏÑùÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            </div>

            <!-- Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏÉÅÏÑ∏ -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-700">üí∞ ÏàòÏûÖ ÎÇ¥Ïó≠</h3>
                    <div id="monthlyIncomeDetails" class="space-y-2">
                        <!-- ÏàòÏûÖ ÏÉÅÏÑ∏ ÎÇ¥Ïó≠ -->
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-blue-700">üè¶ Ï†ÄÏ∂ï ÎÇ¥Ïó≠</h3>
                    <div id="monthlySavingsDetails" class="space-y-2">
                        <!-- Ï†ÄÏ∂ï ÏÉÅÏÑ∏ ÎÇ¥Ïó≠ -->
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-red-700">üí∏ ÏßÄÏ∂ú ÎÇ¥Ïó≠</h3>
                    <div id="monthlyExpenseDetails" class="space-y-2">
                        <!-- ÏßÄÏ∂ú ÏÉÅÏÑ∏ ÎÇ¥Ïó≠ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÌéòÏù¥ÏßÄ 3: Ïó∞ÎèÑÎ≥Ñ Ï†ïÎ¶¨ -->
    <div id="yearly" class="page">
        <div class="max-w-6xl mx-auto p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">üìà Ïó∞ÎèÑÎ≥Ñ Í∞ÄÍ≥ÑÎ∂Ä</h2>
                <select id="yearlyYear" class="px-3 py-2 border border-gray-300 rounded-lg" onchange="updateYearlyView()">
                    <!-- Ïó∞ÎèÑ ÏòµÏÖòÏù¥ ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                </select>
            </div>

            <!-- Ïó∞ÎèÑÎ≥Ñ ÏöîÏïΩ -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="bg-green-50 border border-green-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-600 text-sm font-medium">Ïó∞Í∞Ñ Ï¥ù ÏàòÏûÖ</p>
                            <p id="yearlyIncome" class="text-2xl font-bold text-green-700">0Ïõê</p>
                        </div>
                        <div class="text-green-500 text-3xl">üí∞</div>
                    </div>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-600 text-sm font-medium">Ïó∞Í∞Ñ Ï¥ù Ï†ÄÏ∂ï</p>
                            <p id="yearlySavings" class="text-2xl font-bold text-blue-700">0Ïõê</p>
                        </div>
                        <div class="text-blue-500 text-3xl">üè¶</div>
                    </div>
                </div>
                
                <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-600 text-sm font-medium">Ïó∞Í∞Ñ Ï¥ù ÏßÄÏ∂ú</p>
                            <p id="yearlyExpense" class="text-2xl font-bold text-red-700">0Ïõê</p>
                        </div>
                        <div class="text-red-500 text-3xl">üí∏</div>
                    </div>
                </div>
                
                <div class="bg-purple-50 border border-purple-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-600 text-sm font-medium">Ïó∞Í∞Ñ Ïàú ÏûêÏÇ∞ Î≥ÄÌôî</p>
                            <p id="yearlyNet" class="text-2xl font-bold text-purple-700">0Ïõê</p>
                        </div>
                        <div class="text-purple-500 text-3xl">üìä</div>
                    </div>
                </div>
            </div>

            <!-- ÏõîÎ≥Ñ Ï∞®Ìä∏ -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">üìä ÏõîÎ≥Ñ Ï∂îÏù¥</h3>
                <div class="chart-container">
                    <canvas id="yearlyChart" class="w-full h-full"></canvas>
                </div>
            </div>

            <!-- ÏõîÎ≥Ñ ÏßÄÏ∂ú Î∂ÑÏÑù -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-red-700">üìä ÏõîÎ≥Ñ ÏßÄÏ∂ú Î∂ÑÏÑù</h3>
                <div id="monthlyExpenseBreakdown" class="space-y-4">
                    <!-- ÏõîÎ≥Ñ ÏßÄÏ∂ú Î∂ÑÏÑùÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            </div>

            <!-- Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Ïó∞Í∞Ñ ÌÜµÍ≥Ñ -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-700">üí∞ Ïó∞Í∞Ñ ÏàòÏûÖ Î∂ÑÏÑù</h3>
                    <div id="yearlyIncomeAnalysis" class="space-y-3">
                        <!-- Ïó∞Í∞Ñ ÏàòÏûÖ Î∂ÑÏÑù -->
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-blue-700">üè¶ Ïó∞Í∞Ñ Ï†ÄÏ∂ï Î∂ÑÏÑù</h3>
                    <div id="yearlySavingsAnalysis" class="space-y-3">
                        <!-- Ïó∞Í∞Ñ Ï†ÄÏ∂ï Î∂ÑÏÑù -->
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-red-700">üí∏ Ïó∞Í∞Ñ ÏßÄÏ∂ú Î∂ÑÏÑù</h3>
                    <div id="yearlyExpenseAnalysis" class="space-y-3">
                        <!-- Ïó∞Í∞Ñ ÏßÄÏ∂ú Î∂ÑÏÑù -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÌéòÏù¥ÏßÄ 4: ÏûêÏÇ∞ Í¥ÄÎ¶¨ -->
    <div id="assets" class="page">
        <div class="max-w-6xl mx-auto p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">üè† ÏûêÏÇ∞ Í¥ÄÎ¶¨</h2>
                <button onclick="showAssetForm()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                    ‚ûï ÏûêÏÇ∞ Ï∂îÍ∞Ä
                </button>
            </div>

            <!-- ÏûêÏÇ∞ ÏöîÏïΩ -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="bg-green-50 border border-green-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-600 text-sm font-medium">Ï¥ù ÏûêÏÇ∞</p>
                            <p id="totalAssets" class="text-2xl font-bold text-green-700">0Ïõê</p>
                        </div>
                        <div class="text-green-500 text-3xl">üíé</div>
                    </div>
                </div>
                
                <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-600 text-sm font-medium">Ï¥ù Î∂ÄÏ±Ñ</p>
                            <p id="totalLiabilities" class="text-2xl font-bold text-red-700">0Ïõê</p>
                        </div>
                        <div class="text-red-500 text-3xl">üìâ</div>
                    </div>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-600 text-sm font-medium">Ïàú ÏûêÏÇ∞</p>
                            <p id="netWorth" class="text-2xl font-bold text-blue-700">0Ïõê</p>
                        </div>
                        <div class="text-blue-500 text-3xl">üí∞</div>
                    </div>
                </div>
            </div>

            <!-- ÏûêÏÇ∞ ÏûÖÎ†• Ìèº (Ïà®ÍπÄ) -->
            <div id="assetForm" class="bg-white rounded-xl shadow-lg p-6 mb-6" style="display: none;">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">ÏûêÏÇ∞/Î∂ÄÏ±Ñ Ï∂îÍ∞Ä</h3>
                <form id="assetEntryForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ïú†Ìòï</label>
                        <select id="assetType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                            <option value="asset">ÏûêÏÇ∞</option>
                            <option value="liability">Î∂ÄÏ±Ñ</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ïπ¥ÌÖåÍ≥†Î¶¨</label>
                        <select id="assetCategory" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Ïú†ÌòïÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ìï≠Î™©Î™Ö</label>
                        <input type="text" id="assetName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ïòà: Ïã†ÌïúÏùÄÌñâ Ï†ÅÍ∏à" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Í∏àÏï°</label>
                        <div class="flex space-x-2">
                            <input type="text" id="assetAmount" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" required oninput="formatAmountInput(this)">
                            <select id="assetCurrency" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="KRW">Ïõê (‚Ç©)</option>
                                <option value="USD">Îã¨Îü¨ ($)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Î©îÎ™®</label>
                        <input type="text" id="assetMemo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ÏÑ†ÌÉùÏÇ¨Ìï≠">
                    </div>
                    
                    <div class="md:col-span-2 flex space-x-3">
                        <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                            ‚úÖ Ï∂îÍ∞Ä
                        </button>
                        <button type="button" onclick="hideAssetForm()" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Ï∑®ÏÜå
                        </button>
                    </div>
                </form>
            </div>

            <!-- ÏûêÏÇ∞ Î™©Î°ù -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-700">üíé ÏûêÏÇ∞ Î™©Î°ù</h3>
                    <div id="assetsList" class="space-y-3">
                        <!-- ÏûêÏÇ∞ Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-red-700">üìâ Î∂ÄÏ±Ñ Î™©Î°ù</h3>
                    <div id="liabilitiesList" class="space-y-3">
                        <!-- Î∂ÄÏ±Ñ Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÌéòÏù¥ÏßÄ 5: Í≥µÏú† -->
    <div id="share" class="page">
        <div class="max-w-4xl mx-auto p-6">
            <h2 class="text-2xl font-semibold mb-6 text-gray-800">ü§ù Í∞ÄÍ≥ÑÎ∂Ä Í≥µÏú†</h2>

            <!-- Í≥µÏú† ÏÉÅÌÉú -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">üìä ÌòÑÏû¨ Í≥µÏú† ÏÉÅÌÉú</h3>
                <div id="shareStatus" class="space-y-3">
                    <!-- Í≥µÏú† ÏÉÅÌÉúÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            </div>

            <!-- Í≥µÏú† ÎßÅÌÅ¨ ÏÉùÏÑ± -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">üîó Í≥µÏú† ÎßÅÌÅ¨ ÏÉùÏÑ±</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Í≥µÏú† Ïú†Ìòï</label>
                        <select id="shareType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="view">Î≥¥Í∏∞ Ï†ÑÏö© (ÏùΩÍ∏∞Îßå Í∞ÄÎä•)</option>
                            <option value="edit">Ìé∏Ïßë Í∞ÄÎä• (ÏàòÏ†ï Í∞ÄÎä•)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Í≥µÏú†Ìï† Îç∞Ïù¥ÌÑ∞ ÏÑ†ÌÉù</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="shareEntries" class="mr-2" checked>
                                <span class="text-sm">ÏàòÏûÖ/ÏßÄÏ∂ú ÎÇ¥Ïó≠</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="shareAssets" class="mr-2" checked>
                                <span class="text-sm">ÏûêÏÇ∞ Ï†ïÎ≥¥</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="shareBudgets" class="mr-2" checked>
                                <span class="text-sm">ÏòàÏÇ∞ Î™©Ìëú</span>
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Í≥µÏú† Í∏∞Í∞Ñ (ÏÑ†ÌÉùÏÇ¨Ìï≠)</label>
                        <select id="shareExpiry" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Î¨¥Ï†úÌïú</option>
                            <option value="1">1Ïùº</option>
                            <option value="7">7Ïùº</option>
                            <option value="30">30Ïùº</option>
                            <option value="90">90Ïùº</option>
                        </select>
                    </div>
                    
                    <button onclick="generateShareLink()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                        üîó Í≥µÏú† ÎßÅÌÅ¨ ÏÉùÏÑ±
                    </button>
                </div>
            </div>

            <!-- ÏÉùÏÑ±Îêú Í≥µÏú† ÎßÅÌÅ¨ -->
            <div id="generatedLink" class="bg-white rounded-xl shadow-lg p-6 mb-6" style="display: none;">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">‚úÖ Í≥µÏú† ÎßÅÌÅ¨Í∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!</h3>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Í≥µÏú† ÎßÅÌÅ¨</label>
                        <div class="flex space-x-2">
                            <input type="text" id="shareUrl" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                            <button onclick="copyShareLink()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                                üìã Î≥µÏÇ¨
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Í≥µÏú† ÏΩîÎìú</label>
                        <div class="flex space-x-2">
                            <input type="text" id="shareCode" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-center text-lg font-mono" readonly>
                            <button onclick="copyShareCode()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                                üìã Î≥µÏÇ¨
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">ÏÉÅÎåÄÎ∞©Ïù¥ Ïù¥ ÏΩîÎìúÎ•º ÏûÖÎ†•ÌïòÏó¨ Í∞ÄÍ≥ÑÎ∂ÄÏóê Ï†ëÍ∑ºÌï† Ïàò ÏûàÏäµÎãàÎã§.</p>
                    </div>
                </div>
            </div>

            <!-- Í≥µÏú† ÏΩîÎìúÎ°ú Ï†ëÏÜç -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">üîë Í≥µÏú† ÏΩîÎìúÎ°ú Ï†ëÏÜç</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Í≥µÏú† ÏΩîÎìú ÏûÖÎ†•</label>
                        <div class="flex space-x-2">
                            <input type="text" id="inputShareCode" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-center text-lg font-mono" placeholder="Ïòà: ABC123">
                            <button onclick="connectWithCode()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors">
                                üîó Ïó∞Í≤∞
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÌôúÏÑ± Í≥µÏú† Î™©Î°ù -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">üìã ÌôúÏÑ± Í≥µÏú† Î™©Î°ù</h3>
                <div id="activeShares" class="space-y-3">
                    <!-- ÌôúÏÑ± Í≥µÏú† Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            </div>
        </div>
    </div>

    <!-- ÌéòÏù¥ÏßÄ 6: ÏÑ§Ï†ï -->
    <div id="settings" class="page">
        <div class="max-w-4xl mx-auto p-6">
            <h2 class="text-2xl font-semibold mb-6 text-gray-800">‚öôÔ∏è Í∞ÄÍ≥ÑÎ∂Ä ÏÑ§Ï†ï</h2>

            <!-- Í∏∞Î≥∏ ÏÑ§Ï†ï -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">üìÖ Í∏∞Î≥∏ ÏÑ§Ï†ï</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Í∞ÄÍ≥ÑÎ∂Ä ÏãúÏûëÏùº</label>
                        <input type="date" id="startDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Í∏∞Î≥∏ ÌÜµÌôî</label>
                        <select id="currency" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="KRW">Ïõê (KRW)</option>
                            <option value="USD">Îã¨Îü¨ (USD)</option>
                            <option value="EUR">Ïú†Î°ú (EUR)</option>
                        </select>
                    </div>
                </div>
                <button onclick="saveBasicSettings()" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                    üíæ Ï†ÄÏû•
                </button>
            </div>

            <!-- ÏòàÏÇ∞ ÏÑ§Ï†ï -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">üéØ ÏõîÎ≥Ñ ÏòàÏÇ∞ Î™©Ìëú</h3>
                <div id="budgetSettings" class="space-y-4">
                    <!-- ÏòàÏÇ∞ ÏÑ§Ï†ïÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
                <button onclick="addBudgetGoal()" class="mt-4 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                    ‚ûï ÏòàÏÇ∞ Î™©Ìëú Ï∂îÍ∞Ä
                </button>
            </div>

            <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ Í¥ÄÎ¶¨ -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-700">üí∞ ÏàòÏûÖ Ïπ¥ÌÖåÍ≥†Î¶¨</h3>
                    <div id="incomeCategories" class="space-y-2 mb-4">
                        <!-- ÏàòÏûÖ Ïπ¥ÌÖåÍ≥†Î¶¨ Î™©Î°ù -->
                    </div>
                    <div class="flex space-x-2">
                        <input type="text" id="newIncomeCategory" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="ÏÉà Ïπ¥ÌÖåÍ≥†Î¶¨">
                        <button onclick="addCategory('income')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-sm transition-colors">Ï∂îÍ∞Ä</button>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-blue-700">üè¶ Ï†ÄÏ∂ï Ïπ¥ÌÖåÍ≥†Î¶¨</h3>
                    <div id="savingsCategories" class="space-y-2 mb-4">
                        <!-- Ï†ÄÏ∂ï Ïπ¥ÌÖåÍ≥†Î¶¨ Î™©Î°ù -->
                    </div>
                    <div class="flex space-x-2">
                        <input type="text" id="newSavingsCategory" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="ÏÉà Ïπ¥ÌÖåÍ≥†Î¶¨">
                        <button onclick="addCategory('savings')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm transition-colors">Ï∂îÍ∞Ä</button>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-red-700">üí∏ ÏßÄÏ∂ú Ïπ¥ÌÖåÍ≥†Î¶¨</h3>
                    <div id="expenseCategories" class="space-y-2 mb-4">
                        <!-- ÏßÄÏ∂ú Ïπ¥ÌÖåÍ≥†Î¶¨ Î™©Î°ù -->
                    </div>
                    <div class="flex space-x-2">
                        <input type="text" id="newExpenseCategory" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="ÏÉà Ïπ¥ÌÖåÍ≥†Î¶¨">
                        <button onclick="addCategory('expense')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm transition-colors">Ï∂îÍ∞Ä</button>
                    </div>
                </div>
            </div>

            <!-- Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨ -->
            <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">üíæ Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</h3>
                <div class="flex flex-wrap gap-4">
                    <button onclick="exportData()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                        üì§ Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞
                    </button>
                    <button onclick="importData()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                        üì• Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                    </button>
                    <button onclick="resetData()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                        üóëÔ∏è Î™®Îì† Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÏùºÎ≥Ñ ÎÇ¥Ïó≠ ÌåùÏóÖ Î™®Îã¨ -->
    <div id="dayModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle" class="text-lg font-semibold text-gray-800"></h3>
                <span class="close" onclick="closeDayModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="modalEntries" class="space-y-3">
                    <!-- ÏùºÎ≥Ñ ÎÇ¥Ïó≠Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
                
                <!-- ÏΩîÎ©òÌä∏ ÏÑπÏÖò -->
                <div class="comment-section">
                    <h4 class="font-medium text-gray-800 mb-3">üí¨ ÏΩîÎ©òÌä∏</h4>
                    <div id="modalComments" class="space-y-2 mb-4">
                        <!-- ÏΩîÎ©òÌä∏Í∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                    </div>
                    
                    <div class="flex space-x-2">
                        <input type="text" id="commentInput" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ÏΩîÎ©òÌä∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...">
                        <button onclick="addComment()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                            üí¨ Ï∂îÍ∞Ä
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let entries = JSON.parse(localStorage.getItem('entries') || '[]');
        let assets = JSON.parse(localStorage.getItem('assets') || '[]');
        let categories = JSON.parse(localStorage.getItem('categories') || JSON.stringify({
            income: ['Í∏âÏó¨', 'Î∂ÄÏóÖ', 'Ìà¨ÏûêÏàòÏùµ', 'Í∏∞ÌÉÄÏàòÏûÖ'],
            savings: ['Ï†ÅÍ∏à', 'ÏòàÍ∏à', 'Ìà¨Ïûê', 'Ïó∞Í∏à'],
            expense: ['ÏãùÎπÑ', 'ÍµêÌÜµÎπÑ', 'Ï£ºÍ±∞ÎπÑ', 'ÏùòÎ£åÎπÑ', 'ÏáºÌïë', 'Î¨∏ÌôîÏÉùÌôú', 'Í∏∞ÌÉÄÏßÄÏ∂ú']
        }));
        let budgetGoals = JSON.parse(localStorage.getItem('budgetGoals') || '{}');
        let settings = JSON.parse(localStorage.getItem('settings') || JSON.stringify({
            startDate: new Date().toISOString().split('T')[0],
            currency: 'KRW'
        }));
        let shareData = JSON.parse(localStorage.getItem('shareData') || '{}');
        let activeShares = JSON.parse(localStorage.getItem('activeShares') || '[]');
        let connectedShares = JSON.parse(localStorage.getItem('connectedShares') || '[]');
        let comments = JSON.parse(localStorage.getItem('comments') || '{}');
        let currentModalDate = null;

        // ÌÜµÌôî Ìè¨Îß∑ Ìï®Ïàò
        function formatCurrencyDisplay(amount, currency = 'KRW') {
            const formattedAmount = amount.toLocaleString();
            if (currency === 'USD') {
                return `$${formattedAmount}`;
            } else {
                return `${formattedAmount}Ïõê`;
            }
        }

        // Í∏àÏï° ÏûÖÎ†• Ìè¨Îß∑ÌåÖ Ìï®Ïàò
        function formatAmountInput(input) {
            let value = input.value.replace(/[^\d]/g, '');
            if (value) {
                value = parseInt(value).toLocaleString();
            }
            input.value = value;
        }

        // ÏûêÏÇ∞ Ïπ¥ÌÖåÍ≥†Î¶¨
        const assetCategories = {
            asset: ['ÌòÑÍ∏à', 'ÏòàÍ∏à', 'Ï†ÅÍ∏à', 'Ï£ºÏãù', 'Î∂ÄÎèôÏÇ∞', 'Í∏∞ÌÉÄÏûêÏÇ∞'],
            liability: ['Ïã†Ïö©Ïπ¥Îìú', 'ÎåÄÏ∂ú', 'Í∏∞ÌÉÄÎ∂ÄÏ±Ñ']
        };

        // ÌéòÏù¥ÏßÄ Ï†ÑÌôò
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            document.getElementById(pageId).classList.add('active');
            event.target.classList.add('active');
            
            // ÌéòÏù¥ÏßÄÎ≥Ñ Ï¥àÍ∏∞Ìôî
            if (pageId === 'monthly') {
                initMonthlyView();
            } else if (pageId === 'yearly') {
                initYearlyView();
            } else if (pageId === 'assets') {
                updateAssetsView();
            } else if (pageId === 'settings') {
                initSettingsView();
            } else if (pageId === 'entry') {
                updateRecentEntries();
            } else if (pageId === 'share') {
                initShareView();
            }
        }

        // Ï¥àÍ∏∞Ìôî
        function init() {
            // Ïò§Îäò ÎÇ†Ïßú ÏÑ§Ï†ï
            document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];
            
            // Ìèº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
            document.getElementById('entryForm').addEventListener('submit', addEntry);
            document.getElementById('assetEntryForm').addEventListener('submit', addAsset);
            
            // Ï¥àÍ∏∞ Î∑∞ ÏóÖÎç∞Ïù¥Ìä∏
            updateRecentEntries();
            initMonthlyView();
            initYearlyView();
            updateAssetsView();
            initSettingsView();
        }

        // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏóÖÎç∞Ïù¥Ìä∏
        function updateCategories() {
            const type = document.getElementById('entryType').value;
            const categorySelect = document.getElementById('entryCategory');
            const memoTextarea = document.getElementById('entryMemo');
            const receiptSection = document.getElementById('receiptSection');
            
            categorySelect.innerHTML = '<option value="">Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù</option>';
            
            if (type && categories[type]) {
                categories[type].forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
            }
            
            // Ïú†ÌòïÎ≥Ñ Î©îÎ™® ÏòàÏãú Î≥ÄÍ≤Ω
            const memoPlaceholders = {
                income: 'Ïòà: ÌöåÏÇ¨ Í∏âÏó¨, ÌîÑÎ¶¨ÎûúÏÑú ÏàòÏûÖ, Ìà¨Ïûê ÏàòÏùµ Îì±\nÏÉÅÏÑ∏Ìïú ÏàòÏûÖ ÎÇ¥Ïö©ÏùÑ Í∏∞Î°ùÌï¥Î≥¥ÏÑ∏Ïöî.',
                savings: 'Ïòà: Ïã†ÌïúÏùÄÌñâ Ï†ÅÍ∏à ÎÇ©ÏûÖ, Ï£ºÏãù Ìà¨Ïûê, Ïó∞Í∏à Ï†ÄÏ∂ï Îì±\nÏ†ÄÏ∂ï Î™©Ï†ÅÍ≥º Í≥ÑÌöçÏùÑ Í∏∞Î°ùÌï¥Î≥¥ÏÑ∏Ïöî.',
                expense: 'Ïòà: Ïù¥ÎßàÌä∏ÏóêÏÑú Ïû•Î≥¥Í∏∞ - ÏÇ¨Í≥º 3Í∞ú, Ïö∞Ïú† 2Ìå©, Í≥ÑÎûÄ 1Ìåê\nÏπ¥ÌéòÏóêÏÑú ÏïÑÎ©îÎ¶¨Ïπ¥ÎÖ∏ 2Ïûî, ÏÉåÎìúÏúÑÏπò 1Í∞ú\nÏÉÅÏÑ∏Ìïú ÏßÄÏ∂ú ÎÇ¥Ïö©ÏùÑ Í∏∞Î°ùÌï¥Î≥¥ÏÑ∏Ïöî.'
            };
            
            memoTextarea.placeholder = memoPlaceholders[type] || 'Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ ÏòàÏãúÍ∞Ä ÌëúÏãúÎê©ÎãàÎã§';
            
            // ÏòÅÏàòÏ¶ù Ï†ïÎ≥¥Îäî ÏßÄÏ∂úÏùº ÎïåÎßå ÌëúÏãú
            if (type === 'expense') {
                receiptSection.style.display = 'block';
            } else {
                receiptSection.style.display = 'none';
                // ÏòÅÏàòÏ¶ù Ï†ïÎ≥¥ Ï¥àÍ∏∞Ìôî
                document.getElementById('receiptStore').value = '';
                document.getElementById('receiptPayment').value = '';
                document.getElementById('receiptItems').value = '';
            }
            
            // Î©îÎ™®ÏôÄ Í∏∞Î∂Ñ ÏÑπÏÖòÏùÄ Ïú†ÌòïÏù¥ ÏÑ†ÌÉùÎêòÎ©¥ ÌëúÏãú
            const memoMoodSection = document.getElementById('memoMoodSection');
            if (type) {
                memoMoodSection.style.display = 'block';
            } else {
                memoMoodSection.style.display = 'none';
                // Í∏∞Î∂Ñ ÏÑ†ÌÉù Ï¥àÍ∏∞Ìôî
                document.getElementById('entryMemo').value = '';
                document.getElementById('entryMood').value = '';
                document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('selected'));
            }
        }

        // ÎÇ¥Ïó≠ Ï∂îÍ∞Ä
        function addEntry(e) {
            e.preventDefault();
            
            const amountValue = document.getElementById('entryAmount').value.replace(/,/g, '');
            
            const entry = {
                id: Date.now(),
                date: document.getElementById('entryDate').value,
                type: document.getElementById('entryType').value,
                category: document.getElementById('entryCategory').value,
                amount: parseInt(amountValue),
                currency: document.getElementById('entryCurrency').value,
                memo: document.getElementById('entryMemo').value,
                mood: document.getElementById('entryMood').value,
                receipt: {
                    store: document.getElementById('receiptStore').value,
                    payment: document.getElementById('receiptPayment').value,
                    items: document.getElementById('receiptItems').value
                }
            };
            
            entries.unshift(entry);
            localStorage.setItem('entries', JSON.stringify(entries));
            
            // Ìèº Ï¥àÍ∏∞Ìôî
            document.getElementById('entryForm').reset();
            document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('entryCategory').innerHTML = '<option value="">Ïú†ÌòïÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>';
            document.getElementById('entryMood').value = '';
            document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('memoMoodSection').style.display = 'none';
            document.getElementById('receiptSection').style.display = 'none';
            
            updateRecentEntries();
            
            // ÏÑ±Í≥µ Î©îÏãúÏßÄ
            alert('ÎÇ¥Ïó≠Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§! üí∞');
        }

        // ÏµúÍ∑º ÎÇ¥Ïó≠ ÏóÖÎç∞Ïù¥Ìä∏
        function updateRecentEntries() {
            const container = document.getElementById('recentEntries');
            const recentEntries = entries.slice(0, 10);
            
            if (recentEntries.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">ÏïÑÏßÅ ÏûÖÎ†•Îêú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            container.innerHTML = recentEntries.map(entry => {
                const typeColors = {
                    income: 'text-green-600 bg-green-50',
                    savings: 'text-blue-600 bg-blue-50',
                    expense: 'text-red-600 bg-red-50'
                };
                
                const typeNames = {
                    income: 'ÏàòÏûÖ',
                    savings: 'Ï†ÄÏ∂ï',
                    expense: 'ÏßÄÏ∂ú'
                };

                // ÏòÅÏàòÏ¶ù Ï†ïÎ≥¥ ÌëúÏãú
                let receiptInfo = '';
                if (entry.receipt && (entry.receipt.store || entry.receipt.payment || entry.receipt.items)) {
                    receiptInfo = '<div class="mt-2 p-2 bg-gray-50 rounded text-xs">';
                    if (entry.receipt.store) receiptInfo += `<div><strong>üè™ ${entry.receipt.store}</strong></div>`;
                    if (entry.receipt.payment) receiptInfo += `<div>üí≥ ${entry.receipt.payment}</div>`;
                    if (entry.receipt.items) {
                        receiptInfo += '<div class="mt-1"><strong>üõí Íµ¨Îß§ÌíàÎ™©:</strong></div>';
                        receiptInfo += `<div class="whitespace-pre-line text-gray-600">${entry.receipt.items}</div>`;
                    }
                    receiptInfo += '</div>';
                }
                
                return `
                    <div class="border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                        <div class="flex items-center justify-between p-3">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${typeColors[entry.type]}">
                                        ${typeNames[entry.type]}
                                    </span>
                                    <span class="text-sm font-medium text-gray-800">${entry.category}</span>
                                    ${entry.mood ? `<span class="text-lg">${entry.mood}</span>` : ''}
                                </div>
                                <p class="text-sm text-gray-600 mt-1">${entry.memo || 'Î©îÎ™® ÏóÜÏùå'}</p>
                                ${receiptInfo}
                            </div>
                            <div class="text-right">
                                <p class="font-semibold ${entry.type === 'income' ? 'text-green-600' : entry.type === 'savings' ? 'text-blue-600' : 'text-red-600'}">
                                    ${formatCurrencyDisplay(entry.amount, entry.currency || 'KRW')}
                                </p>
                                <p class="text-xs text-gray-500">${entry.date}</p>
                            </div>
                            <button onclick="deleteEntry(${entry.id})" class="ml-3 text-red-500 hover:text-red-700 transition-colors">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ÎÇ¥Ïó≠ ÏÇ≠Ï†ú
        function deleteEntry(id) {
            if (confirm('Ïù¥ ÎÇ¥Ïó≠ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                entries = entries.filter(entry => entry.id !== id);
                localStorage.setItem('entries', JSON.stringify(entries));
                updateRecentEntries();
            }
        }

        // ÏõîÎ≥Ñ Î∑∞ Ï¥àÍ∏∞Ìôî
        function initMonthlyView() {
            const yearSelect = document.getElementById('monthlyYear');
            const monthSelect = document.getElementById('monthlyMonth');
            
            // Ïó∞ÎèÑ ÏòµÏÖò ÏÉùÏÑ±
            const currentYear = new Date().getFullYear();
            const years = [...new Set(entries.map(entry => new Date(entry.date).getFullYear()))];
            if (years.length === 0) years.push(currentYear);
            
            yearSelect.innerHTML = years.sort((a, b) => b - a).map(year => 
                `<option value="${year}" ${year === currentYear ? 'selected' : ''}>${year}ÎÖÑ</option>`
            ).join('');
            
            // ÌòÑÏû¨ Ïõî ÏÑ†ÌÉù
            monthSelect.value = new Date().getMonth() + 1;
            
            updateMonthlyView();
        }

        // ÏõîÎ≥Ñ Î∑∞ ÏóÖÎç∞Ïù¥Ìä∏
        function updateMonthlyView() {
            const year = parseInt(document.getElementById('monthlyYear').value);
            const month = parseInt(document.getElementById('monthlyMonth').value);
            
            const monthlyEntries = entries.filter(entry => {
                const entryDate = new Date(entry.date);
                return entryDate.getFullYear() === year && entryDate.getMonth() + 1 === month;
            });
            
            // Ï†ÑÏõî Îç∞Ïù¥ÌÑ∞ Í≥ÑÏÇ∞
            let prevYear = year;
            let prevMonth = month - 1;
            if (prevMonth === 0) {
                prevMonth = 12;
                prevYear = year - 1;
            }
            
            const prevMonthEntries = entries.filter(entry => {
                const entryDate = new Date(entry.date);
                return entryDate.getFullYear() === prevYear && entryDate.getMonth() + 1 === prevMonth;
            });
            
            // ÏõîÎ≥Ñ ÏöîÏïΩ Í≥ÑÏÇ∞
            const summary = {
                income: monthlyEntries.filter(e => e.type === 'income').reduce((sum, e) => sum + e.amount, 0),
                savings: monthlyEntries.filter(e => e.type === 'savings').reduce((sum, e) => sum + e.amount, 0),
                expense: monthlyEntries.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.amount, 0)
            };
            
            const prevSummary = {
                income: prevMonthEntries.filter(e => e.type === 'income').reduce((sum, e) => sum + e.amount, 0),
                savings: prevMonthEntries.filter(e => e.type === 'savings').reduce((sum, e) => sum + e.amount, 0),
                expense: prevMonthEntries.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.amount, 0)
            };
            
            summary.net = summary.income - summary.savings - summary.expense;
            prevSummary.net = prevSummary.income - prevSummary.savings - prevSummary.expense;
            
            // ÏöîÏïΩ ÌëúÏãú (Í∏∞Î≥∏ ÌÜµÌôîÎ°ú ÌëúÏãú)
            document.getElementById('monthlyIncome').textContent = formatCurrencyDisplay(summary.income, settings.currency);
            document.getElementById('monthlySavings').textContent = formatCurrencyDisplay(summary.savings, settings.currency);
            document.getElementById('monthlyExpense').textContent = formatCurrencyDisplay(summary.expense, settings.currency);
            document.getElementById('monthlyNet').textContent = formatCurrencyDisplay(summary.net, settings.currency);
            
            // Ï†ÑÏõî ÎåÄÎπÑ Î≥ÄÌôî ÌëúÏãú
            updateMonthlyChanges(summary, prevSummary, prevYear, prevMonth);
            
            // ÏòàÏÇ∞ ÏßÑÌñâÎ•† ÏóÖÎç∞Ïù¥Ìä∏
            updateBudgetProgress(year, month, summary);
            
            // ÏßÄÏ∂ú Î∂ÑÏÑù ÏóÖÎç∞Ïù¥Ìä∏
            updateExpenseAnalysis(monthlyEntries);
            
            // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏÉÅÏÑ∏ ÏóÖÎç∞Ïù¥Ìä∏
            updateMonthlyCategoryDetails(monthlyEntries);
            
            // Îã¨Î†• ÏóÖÎç∞Ïù¥Ìä∏
            updateMonthlyCalendar(year, month, monthlyEntries);
        }

        // Ï†ÑÏõî ÎåÄÎπÑ Î≥ÄÌôî ÌëúÏãú
        function updateMonthlyChanges(summary, prevSummary, prevYear, prevMonth) {
            const types = ['income', 'savings', 'expense', 'net'];
            const typeNames = {
                income: 'ÏàòÏûÖ',
                savings: 'Ï†ÄÏ∂ï', 
                expense: 'ÏßÄÏ∂ú',
                net: 'ÏàúÏûêÏÇ∞'
            };
            
            types.forEach(type => {
                const current = summary[type];
                const previous = prevSummary[type];
                const change = current - previous;
                const changeElement = document.getElementById(`${type}Change`);
                
                if (previous === 0 && current === 0) {
                    changeElement.innerHTML = '<span class="text-gray-500">Ï†ÑÏõî Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</span>';
                    return;
                }
                
                if (previous === 0) {
                    changeElement.innerHTML = `<span class="text-blue-600">üìà ${prevYear}ÎÖÑ ${prevMonth}Ïõî ÎåÄÎπÑ Ïã†Í∑ú</span>`;
                    return;
                }
                
                const percentage = ((change / previous) * 100).toFixed(1);
                const isPositive = change > 0;
                const isNegative = change < 0;
                
                let icon = '‚ûñ';
                let colorClass = 'text-gray-500';
                let message = '';
                
                if (type === 'expense') {
                    // ÏßÄÏ∂úÏùò Í≤ΩÏö∞ Í∞êÏÜåÍ∞Ä Ï¢ãÏùå
                    if (isNegative) {
                        icon = 'üí∞';
                        colorClass = 'text-green-600';
                        message = `${Math.abs(change).toLocaleString()}Ïõê Ï†àÏïΩ! (${Math.abs(percentage)}% Í∞êÏÜå)`;
                    } else if (isPositive) {
                        icon = 'üìà';
                        colorClass = 'text-red-600';
                        message = `${change.toLocaleString()}Ïõê Ï¶ùÍ∞Ä (${percentage}% Ï¶ùÍ∞Ä)`;
                    } else {
                        message = 'Ï†ÑÏõîÍ≥º ÎèôÏùº';
                    }
                } else {
                    // ÏàòÏûÖ, Ï†ÄÏ∂ï, ÏàúÏûêÏÇ∞Ïùò Í≤ΩÏö∞ Ï¶ùÍ∞ÄÍ∞Ä Ï¢ãÏùå
                    if (isPositive) {
                        icon = 'üìà';
                        colorClass = 'text-green-600';
                        message = `${change.toLocaleString()}Ïõê Ï¶ùÍ∞Ä (${percentage}% Ï¶ùÍ∞Ä)`;
                    } else if (isNegative) {
                        icon = 'üìâ';
                        colorClass = 'text-red-600';
                        message = `${Math.abs(change).toLocaleString()}Ïõê Í∞êÏÜå (${Math.abs(percentage)}% Í∞êÏÜå)`;
                    } else {
                        message = 'Ï†ÑÏõîÍ≥º ÎèôÏùº';
                    }
                }
                
                changeElement.innerHTML = `<span class="${colorClass}">${icon} ${prevYear}ÎÖÑ ${prevMonth}Ïõî ÎåÄÎπÑ ${message}</span>`;
            });
        }

        // ÏòàÏÇ∞ ÏßÑÌñâÎ•† ÏóÖÎç∞Ïù¥Ìä∏
        function updateBudgetProgress(year, month, summary) {
            const container = document.getElementById('budgetProgress');
            const monthKey = `${year}-${month.toString().padStart(2, '0')}`;
            
            if (!budgetGoals[monthKey] || Object.keys(budgetGoals[monthKey]).length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center">ÏÑ§Ï†ïÎêú ÏòàÏÇ∞ Î™©ÌëúÍ∞Ä ÏóÜÏäµÎãàÎã§. ÏÑ§Ï†ï ÌéòÏù¥ÏßÄÏóêÏÑú ÏòàÏÇ∞ÏùÑ ÏÑ§Ï†ïÌï¥Î≥¥ÏÑ∏Ïöî.</p>';
                return;
            }
            
            const goals = budgetGoals[monthKey];
            let html = '';
            
            Object.entries(goals).forEach(([type, goal]) => {
                const actual = summary[type] || 0;
                const percentage = goal > 0 ? Math.min((actual / goal) * 100, 100) : 0;
                const isOver = actual > goal;
                
                const typeNames = {
                    income: 'ÏàòÏûÖ',
                    savings: 'Ï†ÄÏ∂ï',
                    expense: 'ÏßÄÏ∂ú'
                };
                
                const colors = {
                    income: isOver ? 'bg-green-500' : 'bg-green-300',
                    savings: isOver ? 'bg-blue-500' : 'bg-blue-300',
                    expense: isOver ? 'bg-red-500' : 'bg-red-300'
                };
                
                html += `
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-sm font-medium">${typeNames[type]} Î™©Ìëú</span>
                            <span class="text-sm ${isOver ? 'text-red-600' : 'text-gray-600'}">
                                ${actual.toLocaleString()}Ïõê / ${goal.toLocaleString()}Ïõê
                            </span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="${colors[type]} h-2 rounded-full transition-all duration-300" style="width: ${percentage}%"></div>
                        </div>
                        <div class="text-xs text-gray-500">
                            ${percentage.toFixed(1)}% Îã¨ÏÑ± ${isOver ? '(Î™©Ìëú Ï¥àÍ≥º)' : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ÏßÄÏ∂ú Î∂ÑÏÑù ÏóÖÎç∞Ïù¥Ìä∏
        function updateExpenseAnalysis(monthlyEntries) {
            const container = document.getElementById('expenseAnalysis');
            const expenseEntries = monthlyEntries.filter(e => e.type === 'expense');
            
            if (expenseEntries.length === 0) {
                container.innerHTML = '<p class="text-gray-500">Ïù¥Î≤à Îã¨ ÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏßÄÏ∂ú Ìï©Í≥Ñ Í≥ÑÏÇ∞
            const categoryTotals = {};
            expenseEntries.forEach(entry => {
                categoryTotals[entry.category] = (categoryTotals[entry.category] || 0) + entry.amount;
            });
            
            // Ï†ïÎ†¨ (Í∏àÏï° Ïàú)
            const sortedCategories = Object.entries(categoryTotals)
                .sort(([,a], [,b]) => b - a);
            
            const totalExpense = Object.values(categoryTotals).reduce((sum, amount) => sum + amount, 0);
            const topCategory = sortedCategories[0];
            const topCategoryPercentage = totalExpense > 0 ? (topCategory[1] / totalExpense * 100).toFixed(1) : 0;
            
            // Í∞ÄÏû• ÎßéÏù¥ ÏßÄÏ∂úÌïú Ïπ¥ÌÖåÍ≥†Î¶¨Ïùò ÏÉÅÏÑ∏ ÎÇ¥Ïó≠
            const topCategoryEntries = expenseEntries
                .filter(e => e.category === topCategory[0])
                .sort((a, b) => b.amount - a.amount)
                .slice(0, 5);
            
            let html = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-3">
                        <h4 class="font-medium text-gray-800">üí∏ Í∞ÄÏû• ÎßéÏù¥ ÏßÄÏ∂úÌïú Ïπ¥ÌÖåÍ≥†Î¶¨</h4>
                        <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-lg font-semibold text-red-700">${topCategory[0]}</span>
                                <span class="text-lg font-bold text-red-700">${topCategory[1].toLocaleString()}Ïõê</span>
                            </div>
                            <div class="text-sm text-red-600">
                                Ï†ÑÏ≤¥ ÏßÄÏ∂úÏùò ${topCategoryPercentage}% (${sortedCategories.length}Í∞ú Ïπ¥ÌÖåÍ≥†Î¶¨ Ï§ë 1ÏúÑ)
                            </div>
                            <div class="w-full bg-red-200 rounded-full h-2 mt-2">
                                <div class="bg-red-500 h-2 rounded-full" style="width: ${topCategoryPercentage}%"></div>
                            </div>
                        </div>
                        
                        <div class="space-y-2">
                            <h5 class="text-sm font-medium text-gray-700">üìä Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏßÄÏ∂ú ÏàúÏúÑ</h5>
                            ${sortedCategories.slice(0, 5).map((category, index) => {
                                const percentage = totalExpense > 0 ? (category[1] / totalExpense * 100).toFixed(1) : 0;
                                const medals = ['ü•á', 'ü•à', 'ü•â', '4Ô∏è‚É£', '5Ô∏è‚É£'];
                                return `
                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                        <div class="flex items-center space-x-2">
                                            <span>${medals[index]}</span>
                                            <span class="text-sm">${category[0]}</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-sm font-medium">${category[1].toLocaleString()}Ïõê</div>
                                            <div class="text-xs text-gray-500">${percentage}%</div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <h4 class="font-medium text-gray-800">üîç ${topCategory[0]} ÏÉÅÏÑ∏ ÎÇ¥Ïó≠</h4>
                        <div class="space-y-2 max-h-64 overflow-y-auto">
                            ${topCategoryEntries.map(entry => {
                                let receiptInfo = '';
                                if (entry.receipt && entry.receipt.store) {
                                    receiptInfo = `<div class="text-xs text-gray-500">üè™ ${entry.receipt.store}</div>`;
                                }
                                return `
                                    <div class="p-3 border border-gray-200 rounded-lg">
                                        <div class="flex justify-between items-start">
                                            <div class="flex-1">
                                                <div class="text-sm font-medium">${entry.amount.toLocaleString()}Ïõê</div>
                                                <div class="text-xs text-gray-600 mt-1">${entry.memo || 'Î©îÎ™® ÏóÜÏùå'}</div>
                                                ${receiptInfo}
                                            </div>
                                            <div class="text-xs text-gray-500">${entry.date}</div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        
                        <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <div class="text-sm text-blue-700">
                                üí° <strong>Ï†àÏïΩ ÌåÅ:</strong> ${topCategory[0]} ÏßÄÏ∂úÏùÑ Ï§ÑÏù¥Î©¥ Ïõî ÏòàÏÇ∞ÏùÑ ÌÅ¨Í≤å Í∞úÏÑ†Ìï† Ïàò ÏûàÏñ¥Ïöî!
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // ÏõîÎ≥Ñ Îã¨Î†• ÏóÖÎç∞Ïù¥Ìä∏
        function updateMonthlyCalendar(year, month, monthlyEntries) {
            const container = document.getElementById('monthlyCalendar');
            
            // Îã¨Î†• Ìó§Îçî ÏÉùÏÑ±
            const weekdays = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
            let calendarHTML = '';
            
            // ÏöîÏùº Ìó§Îçî
            weekdays.forEach(day => {
                calendarHTML += `<div class="calendar-header">${day}</div>`;
            });
            
            // Ìï¥Îãπ ÏõîÏùò Ï≤´ Î≤àÏß∏ ÎÇ†Í≥º ÎßàÏßÄÎßâ ÎÇ†
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            // Ïù¥Ï†Ñ Îã¨Ïùò ÎßàÏßÄÎßâ ÎÇ†Îì§
            const prevMonth = month === 1 ? 12 : month - 1;
            const prevYear = month === 1 ? year - 1 : year;
            const prevMonthLastDay = new Date(prevYear, prevMonth, 0).getDate();
            
            // Ïù¥Ï†Ñ Îã¨ ÎÇ†ÏßúÎì§
            for (let i = startingDayOfWeek - 1; i >= 0; i--) {
                const day = prevMonthLastDay - i;
                calendarHTML += `<div class="calendar-day other-month">
                    <div class="calendar-day-number">${day}</div>
                </div>`;
            }
            
            // ÌòÑÏû¨ Îã¨ ÎÇ†ÏßúÎì§
            const today = new Date();
            const isCurrentMonth = today.getFullYear() === year && today.getMonth() + 1 === month;
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                const dayEntries = monthlyEntries.filter(entry => entry.date === dateStr);
                
                // Ïò§Îäò ÎÇ†Ïßú ÌôïÏù∏
                const isToday = isCurrentMonth && today.getDate() === day;
                
                // Î¨¥ÏßÄÏ∂ú ÎÇ†Ïßú ÌôïÏù∏ (ÏßÄÏ∂úÏù¥ ÏóÜÎäî ÎÇ† - ÎÇ¥Ïó≠Ïù¥ ÏóÜÏñ¥ÎèÑ Î¨¥ÏßÄÏ∂úÎ°ú ÌëúÏãú)
                const hasExpense = dayEntries.some(entry => entry.type === 'expense');
                const isNoSpendDay = !hasExpense;
                
                // ÌÅ¥ÎûòÏä§ ÏÑ§Ï†ï
                let dayClasses = 'calendar-day';
                if (isToday) dayClasses += ' today';
                if (isNoSpendDay) dayClasses += ' no-spend';
                
                // ÎÇ¥Ïó≠Î≥Ñ Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ ÏÉùÏÑ±
                let indicators = '';
                const entryTypes = [...new Set(dayEntries.map(entry => entry.type))];
                entryTypes.forEach(type => {
                    indicators += `<div class="calendar-indicator ${type}"></div>`;
                });
                
                // Î¨¥ÏßÄÏ∂ú ÏïÑÏù¥ÏΩò
                let noSpendIcon = '';
                if (isNoSpendDay) {
                    noSpendIcon = '<div class="no-spend-icon">üéâ</div>';
                }
                
                calendarHTML += `
                    <div class="${dayClasses}" onclick="openDayModal('${dateStr}')">
                        <div class="calendar-day-number">${day}</div>
                        <div class="calendar-indicators">${indicators}</div>
                        ${noSpendIcon}
                    </div>
                `;
            }
            
            // Îã§Ïùå Îã¨ ÎÇ†ÏßúÎì§ (Îã¨Î†•ÏùÑ 6Ï£ºÎ°ú ÎßûÏ∂îÍ∏∞ ÏúÑÌï¥)
            const totalCells = 42; // 6Ï£º √ó 7Ïùº
            const currentCells = startingDayOfWeek + daysInMonth;
            const remainingCells = totalCells - currentCells;
            
            for (let day = 1; day <= remainingCells; day++) {
                calendarHTML += `<div class="calendar-day other-month">
                    <div class="calendar-day-number">${day}</div>
                </div>`;
            }
            
            container.innerHTML = calendarHTML;
        }

        // ÏõîÎ≥Ñ Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÉÅÏÑ∏ ÏóÖÎç∞Ïù¥Ìä∏
        function updateMonthlyCategoryDetails(monthlyEntries) {
            const types = ['income', 'savings', 'expense'];
            
            types.forEach(type => {
                const container = document.getElementById(`monthly${type.charAt(0).toUpperCase() + type.slice(1)}Details`);
                const typeEntries = monthlyEntries.filter(e => e.type === type);
                
                if (typeEntries.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-sm">ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</p>';
                    return;
                }
                
                // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Ìï©Í≥Ñ Í≥ÑÏÇ∞
                const categoryTotals = {};
                typeEntries.forEach(entry => {
                    categoryTotals[entry.category] = (categoryTotals[entry.category] || 0) + entry.amount;
                });
                
                // Ï†ïÎ†¨ (Í∏àÏï° Ïàú)
                const sortedCategories = Object.entries(categoryTotals)
                    .sort(([,a], [,b]) => b - a);
                
                container.innerHTML = sortedCategories.map(([category, amount]) => `
                    <div class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                        <span class="text-sm text-gray-700">${category}</span>
                        <span class="text-sm font-medium">${amount.toLocaleString()}Ïõê</span>
                    </div>
                `).join('');
            });
        }

        // Ïó∞ÎèÑÎ≥Ñ Î∑∞ Ï¥àÍ∏∞Ìôî
        function initYearlyView() {
            const yearSelect = document.getElementById('yearlyYear');
            
            // Ïó∞ÎèÑ ÏòµÏÖò ÏÉùÏÑ±
            const currentYear = new Date().getFullYear();
            const years = [...new Set(entries.map(entry => new Date(entry.date).getFullYear()))];
            if (years.length === 0) years.push(currentYear);
            
            yearSelect.innerHTML = years.sort((a, b) => b - a).map(year => 
                `<option value="${year}" ${year === currentYear ? 'selected' : ''}>${year}ÎÖÑ</option>`
            ).join('');
            
            updateYearlyView();
        }

        // Ïó∞ÎèÑÎ≥Ñ Î∑∞ ÏóÖÎç∞Ïù¥Ìä∏
        function updateYearlyView() {
            const year = parseInt(document.getElementById('yearlyYear').value);
            
            const yearlyEntries = entries.filter(entry => {
                return new Date(entry.date).getFullYear() === year;
            });
            
            // Ïó∞ÎèÑÎ≥Ñ ÏöîÏïΩ Í≥ÑÏÇ∞
            const summary = {
                income: yearlyEntries.filter(e => e.type === 'income').reduce((sum, e) => sum + e.amount, 0),
                savings: yearlyEntries.filter(e => e.type === 'savings').reduce((sum, e) => sum + e.amount, 0),
                expense: yearlyEntries.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.amount, 0)
            };
            
            summary.net = summary.income - summary.savings - summary.expense;
            
            // ÏöîÏïΩ ÌëúÏãú (Í∏∞Î≥∏ ÌÜµÌôîÎ°ú ÌëúÏãú)
            document.getElementById('yearlyIncome').textContent = formatCurrencyDisplay(summary.income, settings.currency);
            document.getElementById('yearlySavings').textContent = formatCurrencyDisplay(summary.savings, settings.currency);
            document.getElementById('yearlyExpense').textContent = formatCurrencyDisplay(summary.expense, settings.currency);
            document.getElementById('yearlyNet').textContent = formatCurrencyDisplay(summary.net, settings.currency);
            
            // ÏõîÎ≥Ñ Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            updateYearlyChart(year, yearlyEntries);
            
            // ÏõîÎ≥Ñ ÏßÄÏ∂ú Î∂ÑÏÑù ÏóÖÎç∞Ïù¥Ìä∏
            updateMonthlyExpenseBreakdown(year, yearlyEntries);
            
            // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Ïó∞Í∞Ñ Î∂ÑÏÑù ÏóÖÎç∞Ïù¥Ìä∏
            updateYearlyCategoryAnalysis(yearlyEntries);
        }

        // Ïó∞ÎèÑÎ≥Ñ Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ (Í∞ÑÎã®Ìïú Î∞î Ï∞®Ìä∏)
        function updateYearlyChart(year, yearlyEntries) {
            const canvas = document.getElementById('yearlyChart');
            const ctx = canvas.getContext('2d');
            
            // Ï∫îÎ≤ÑÏä§ ÌÅ¨Í∏∞ ÏÑ§Ï†ï
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // ÏõîÎ≥Ñ Îç∞Ïù¥ÌÑ∞ Í≥ÑÏÇ∞
            const monthlyData = Array.from({length: 12}, (_, i) => {
                const month = i + 1;
                const monthEntries = yearlyEntries.filter(entry => {
                    return new Date(entry.date).getMonth() + 1 === month;
                });
                
                return {
                    month: month,
                    income: monthEntries.filter(e => e.type === 'income').reduce((sum, e) => sum + e.amount, 0),
                    savings: monthEntries.filter(e => e.type === 'savings').reduce((sum, e) => sum + e.amount, 0),
                    expense: monthEntries.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.amount, 0)
                };
            });
            
            // Ï∞®Ìä∏ Í∑∏Î¶¨Í∏∞
            const maxValue = Math.max(...monthlyData.flatMap(d => [d.income, d.savings, d.expense]));
            if (maxValue === 0) {
                ctx.fillStyle = '#6b7280';
                ctx.font = '16px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            const barWidth = canvas.width / 12;
            const chartHeight = canvas.height - 60;
            
            monthlyData.forEach((data, index) => {
                const x = index * barWidth;
                const incomeHeight = (data.income / maxValue) * chartHeight;
                const savingsHeight = (data.savings / maxValue) * chartHeight;
                const expenseHeight = (data.expense / maxValue) * chartHeight;
                
                // ÏàòÏûÖ (ÎÖπÏÉâ)
                ctx.fillStyle = '#10b981';
                ctx.fillRect(x + 5, canvas.height - 40 - incomeHeight, barWidth / 3 - 2, incomeHeight);
                
                // Ï†ÄÏ∂ï (ÌååÎûÄÏÉâ)
                ctx.fillStyle = '#3b82f6';
                ctx.fillRect(x + barWidth / 3 + 3, canvas.height - 40 - savingsHeight, barWidth / 3 - 2, savingsHeight);
                
                // ÏßÄÏ∂ú (Îπ®Í∞ÑÏÉâ)
                ctx.fillStyle = '#ef4444';
                ctx.fillRect(x + (barWidth / 3) * 2 + 1, canvas.height - 40 - expenseHeight, barWidth / 3 - 2, expenseHeight);
                
                // Ïõî ÎùºÎ≤®
                ctx.fillStyle = '#374151';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`${data.month}Ïõî`, x + barWidth / 2, canvas.height - 10);
            });
            
            // Î≤îÎ°Ä
            ctx.fillStyle = '#10b981';
            ctx.fillRect(10, 10, 15, 15);
            ctx.fillStyle = '#374151';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('ÏàòÏûÖ', 30, 22);
            
            ctx.fillStyle = '#3b82f6';
            ctx.fillRect(80, 10, 15, 15);
            ctx.fillText('Ï†ÄÏ∂ï', 100, 22);
            
            ctx.fillStyle = '#ef4444';
            ctx.fillRect(150, 10, 15, 15);
            ctx.fillText('ÏßÄÏ∂ú', 170, 22);
        }

        // ÏõîÎ≥Ñ ÏßÄÏ∂ú Î∂ÑÏÑù ÏóÖÎç∞Ïù¥Ìä∏
        function updateMonthlyExpenseBreakdown(year, yearlyEntries) {
            const container = document.getElementById('monthlyExpenseBreakdown');
            
            // ÏõîÎ≥Ñ ÏßÄÏ∂ú Îç∞Ïù¥ÌÑ∞ Í≥ÑÏÇ∞
            const monthlyData = Array.from({length: 12}, (_, i) => {
                const month = i + 1;
                const monthEntries = yearlyEntries.filter(entry => {
                    const entryDate = new Date(entry.date);
                    return entryDate.getMonth() + 1 === month && entry.type === 'expense';
                });
                
                // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏßÄÏ∂ú Í≥ÑÏÇ∞
                const categoryTotals = {};
                monthEntries.forEach(entry => {
                    categoryTotals[entry.category] = (categoryTotals[entry.category] || 0) + entry.amount;
                });
                
                const totalExpense = Object.values(categoryTotals).reduce((sum, amount) => sum + amount, 0);
                const topCategory = Object.entries(categoryTotals).sort(([,a], [,b]) => b - a)[0];
                
                return {
                    month: month,
                    monthName: `${month}Ïõî`,
                    totalExpense: totalExpense,
                    categoryTotals: categoryTotals,
                    topCategory: topCategory ? {
                        name: topCategory[0],
                        amount: topCategory[1],
                        percentage: totalExpense > 0 ? (topCategory[1] / totalExpense * 100).toFixed(1) : 0
                    } : null,
                    entryCount: monthEntries.length
                };
            }).filter(data => data.totalExpense > 0);
            
            if (monthlyData.length === 0) {
                container.innerHTML = '<p class="text-gray-500">Ïù¥ Ïó∞ÎèÑÏóê ÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            // Í∞ÄÏû• ÎßéÏù¥ ÏßÄÏ∂úÌïú Ïõî Ï∞æÍ∏∞
            const maxExpenseMonth = monthlyData.reduce((max, current) => 
                current.totalExpense > max.totalExpense ? current : max
            );
            
            // Ïó∞Í∞Ñ Ï¥ù ÏßÄÏ∂ú
            const yearlyTotalExpense = monthlyData.reduce((sum, data) => sum + data.totalExpense, 0);
            
            let html = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                        <h4 class="font-medium text-red-700 mb-2">üí∏ Í∞ÄÏû• ÎßéÏù¥ ÏßÄÏ∂úÌïú Îã¨</h4>
                        <div class="text-2xl font-bold text-red-700">${maxExpenseMonth.monthName}</div>
                        <div class="text-lg text-red-600">${maxExpenseMonth.totalExpense.toLocaleString()}Ïõê</div>
                        <div class="text-sm text-red-500 mt-1">
                            Ïó∞Í∞Ñ ÏßÄÏ∂úÏùò ${(maxExpenseMonth.totalExpense / yearlyTotalExpense * 100).toFixed(1)}%
                        </div>
                        ${maxExpenseMonth.topCategory ? `
                            <div class="text-xs text-red-600 mt-2">
                                Ï£ºÏöî ÏßÄÏ∂ú: ${maxExpenseMonth.topCategory.name} (${maxExpenseMonth.topCategory.percentage}%)
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h4 class="font-medium text-blue-700 mb-2">üìä ÏõîÌèâÍ∑† ÏßÄÏ∂ú</h4>
                        <div class="text-2xl font-bold text-blue-700">${Math.round(yearlyTotalExpense / monthlyData.length).toLocaleString()}Ïõê</div>
                        <div class="text-sm text-blue-600 mt-1">
                            Ï¥ù ${monthlyData.length}Í∞úÏõî Îç∞Ïù¥ÌÑ∞ Í∏∞Ï§Ä
                        </div>
                        <div class="text-xs text-blue-500 mt-2">
                            ÏµúÍ≥†: ${maxExpenseMonth.totalExpense.toLocaleString()}Ïõê | 
                            ÏµúÏ†Ä: ${Math.min(...monthlyData.map(d => d.totalExpense)).toLocaleString()}Ïõê
                        </div>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <h4 class="font-medium text-gray-800">üìÖ ÏõîÎ≥Ñ ÏßÄÏ∂ú ÏÉÅÏÑ∏</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            `;
            
            monthlyData.forEach(data => {
                const isMaxMonth = data.month === maxExpenseMonth.month;
                const monthPercentage = (data.totalExpense / yearlyTotalExpense * 100).toFixed(1);
                
                html += `
                    <div class="p-4 border rounded-lg ${isMaxMonth ? 'border-red-300 bg-red-50' : 'border-gray-200 bg-white'} hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between mb-2">
                            <span class="font-medium ${isMaxMonth ? 'text-red-700' : 'text-gray-800'}">${data.monthName}</span>
                            ${isMaxMonth ? '<span class="text-red-500 text-sm">üëë ÏµúÍ≥†</span>' : ''}
                        </div>
                        <div class="text-lg font-semibold ${isMaxMonth ? 'text-red-600' : 'text-gray-700'}">
                            ${data.totalExpense.toLocaleString()}Ïõê
                        </div>
                        <div class="text-xs text-gray-500 mb-2">
                            Ïó∞Í∞Ñ ÎπÑÏ§ë: ${monthPercentage}% | ${data.entryCount}Í±¥
                        </div>
                        
                        ${data.topCategory ? `
                            <div class="space-y-1">
                                <div class="text-xs text-gray-600">Ï£ºÏöî ÏßÄÏ∂ú Ïπ¥ÌÖåÍ≥†Î¶¨:</div>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs font-medium">${data.topCategory.name}</span>
                                    <span class="text-xs">${data.topCategory.percentage}%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-1">
                                    <div class="bg-red-400 h-1 rounded-full" style="width: ${data.topCategory.percentage}%"></div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
                
                <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <div class="text-sm text-yellow-700">
                        üí° <strong>Î∂ÑÏÑù Ïù∏ÏÇ¨Ïù¥Ìä∏:</strong> 
                        ${maxExpenseMonth.monthName}Ïóê Í∞ÄÏû• ÎßéÏùÄ ÏßÄÏ∂úÏù¥ Î∞úÏÉùÌñàÏäµÎãàÎã§. 
                        ${maxExpenseMonth.topCategory ? `Ï£ºÎ°ú ${maxExpenseMonth.topCategory.name} Ìï≠Î™©ÏóêÏÑú ÏßÄÏ∂úÏù¥ ÎßéÏïòÏúºÎãà, Ìï¥Îãπ Ïπ¥ÌÖåÍ≥†Î¶¨Ïùò ÏßÄÏ∂ú Ìå®ÌÑ¥ÏùÑ Ï†êÍ≤ÄÌï¥Î≥¥ÏÑ∏Ïöî.` : ''}
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // Ïó∞Í∞Ñ Ïπ¥ÌÖåÍ≥†Î¶¨ Î∂ÑÏÑù ÏóÖÎç∞Ïù¥Ìä∏
        function updateYearlyCategoryAnalysis(yearlyEntries) {
            const types = ['income', 'savings', 'expense'];
            
            types.forEach(type => {
                const container = document.getElementById(`yearly${type.charAt(0).toUpperCase() + type.slice(1)}Analysis`);
                const typeEntries = yearlyEntries.filter(e => e.type === type);
                
                if (typeEntries.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-sm">ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</p>';
                    return;
                }
                
                // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Ìï©Í≥Ñ Í≥ÑÏÇ∞
                const categoryTotals = {};
                typeEntries.forEach(entry => {
                    categoryTotals[entry.category] = (categoryTotals[entry.category] || 0) + entry.amount;
                });
                
                const total = Object.values(categoryTotals).reduce((sum, amount) => sum + amount, 0);
                
                // Ï†ïÎ†¨ (Í∏àÏï° Ïàú)
                const sortedCategories = Object.entries(categoryTotals)
                    .sort(([,a], [,b]) => b - a);
                
                container.innerHTML = sortedCategories.map(([category, amount]) => {
                    const percentage = total > 0 ? (amount / total * 100).toFixed(1) : 0;
                    return `
                        <div class="space-y-1">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-700">${category}</span>
                                <span class="text-sm font-medium">${amount.toLocaleString()}Ïõê</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-${type === 'income' ? 'green' : type === 'savings' ? 'blue' : 'red'}-500 h-2 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                            <div class="text-xs text-gray-500">${percentage}%</div>
                        </div>
                    `;
                }).join('');
            });
        }

        // ÏûêÏÇ∞ Ìèº ÌëúÏãú/Ïà®ÍπÄ
        function showAssetForm() {
            document.getElementById('assetForm').style.display = 'block';
            updateAssetCategories();
        }

        function hideAssetForm() {
            document.getElementById('assetForm').style.display = 'none';
            document.getElementById('assetEntryForm').reset();
        }

        // ÏûêÏÇ∞ Ïπ¥ÌÖåÍ≥†Î¶¨ ÏóÖÎç∞Ïù¥Ìä∏
        function updateAssetCategories() {
            const type = document.getElementById('assetType').value;
            const categorySelect = document.getElementById('assetCategory');
            
            categorySelect.innerHTML = '<option value="">Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù</option>';
            
            if (type && assetCategories[type]) {
                assetCategories[type].forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
            }
        }

        // ÏûêÏÇ∞ Ï∂îÍ∞Ä
        function addAsset(e) {
            e.preventDefault();
            
            const amountValue = document.getElementById('assetAmount').value.replace(/,/g, '');
            
            const asset = {
                id: Date.now(),
                type: document.getElementById('assetType').value,
                category: document.getElementById('assetCategory').value,
                name: document.getElementById('assetName').value,
                amount: parseInt(amountValue),
                currency: document.getElementById('assetCurrency').value,
                memo: document.getElementById('assetMemo').value,
                date: new Date().toISOString().split('T')[0]
            };
            
            assets.push(asset);
            localStorage.setItem('assets', JSON.stringify(assets));
            
            hideAssetForm();
            updateAssetsView();
            
            alert('ÏûêÏÇ∞Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§! üíé');
        }

        // ÏûêÏÇ∞ Î∑∞ ÏóÖÎç∞Ïù¥Ìä∏
        function updateAssetsView() {
            const assetsList = assets.filter(a => a.type === 'asset');
            const liabilitiesList = assets.filter(a => a.type === 'liability');
            
            const totalAssets = assetsList.reduce((sum, a) => sum + a.amount, 0);
            const totalLiabilities = liabilitiesList.reduce((sum, a) => sum + a.amount, 0);
            const netWorth = totalAssets - totalLiabilities;
            
            // ÏöîÏïΩ ÏóÖÎç∞Ïù¥Ìä∏ (Í∏∞Î≥∏ ÌÜµÌôîÎ°ú ÌëúÏãú)
            document.getElementById('totalAssets').textContent = formatCurrencyDisplay(totalAssets, settings.currency);
            document.getElementById('totalLiabilities').textContent = formatCurrencyDisplay(totalLiabilities, settings.currency);
            document.getElementById('netWorth').textContent = formatCurrencyDisplay(netWorth, settings.currency);
            
            // ÏûêÏÇ∞ Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
            updateAssetList('assetsList', assetsList, 'asset');
            updateAssetList('liabilitiesList', liabilitiesList, 'liability');
        }

        // ÏûêÏÇ∞ Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
        function updateAssetList(containerId, list, type) {
            const container = document.getElementById(containerId);
            
            if (list.length === 0) {
                container.innerHTML = `<p class="text-gray-500 text-sm">${type === 'asset' ? 'ÏûêÏÇ∞' : 'Î∂ÄÏ±Ñ'}Ïù¥ ÏóÜÏäµÎãàÎã§.</p>`;
                return;
            }
            
            container.innerHTML = list.map(item => `
                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                    <div class="flex-1">
                        <div class="flex items-center space-x-2">
                            <span class="px-2 py-1 text-xs font-medium rounded-full ${type === 'asset' ? 'text-green-600 bg-green-50' : 'text-red-600 bg-red-50'}">
                                ${item.category}
                            </span>
                        </div>
                        <p class="font-medium text-gray-800 mt-1">${item.name}</p>
                        <p class="text-sm text-gray-600">${item.memo || 'Î©îÎ™® ÏóÜÏùå'}</p>
                    </div>
                    <div class="text-right">
                        <p class="font-semibold ${type === 'asset' ? 'text-green-600' : 'text-red-600'}">
                            ${formatCurrencyDisplay(item.amount, item.currency || settings.currency)}
                        </p>
                        <p class="text-xs text-gray-500">${item.date}</p>
                    </div>
                    <button onclick="deleteAsset(${item.id})" class="ml-3 text-red-500 hover:text-red-700 transition-colors">
                        üóëÔ∏è
                    </button>
                </div>
            `).join('');
        }

        // ÏûêÏÇ∞ ÏÇ≠Ï†ú
        function deleteAsset(id) {
            if (confirm('Ïù¥ Ìï≠Î™©ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                assets = assets.filter(asset => asset.id !== id);
                localStorage.setItem('assets', JSON.stringify(assets));
                updateAssetsView();
            }
        }

        // ÏÑ§Ï†ï Î∑∞ Ï¥àÍ∏∞Ìôî
        function initSettingsView() {
            // Í∏∞Î≥∏ ÏÑ§Ï†ï Î°úÎìú
            document.getElementById('startDate').value = settings.startDate;
            document.getElementById('currency').value = settings.currency;
            
            // Ïπ¥ÌÖåÍ≥†Î¶¨ Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
            updateCategoryLists();
            
            // ÏòàÏÇ∞ ÏÑ§Ï†ï ÏóÖÎç∞Ïù¥Ìä∏
            updateBudgetSettings();
        }

        // Ïπ¥ÌÖåÍ≥†Î¶¨ Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
        function updateCategoryLists() {
            const types = ['income', 'savings', 'expense'];
            
            types.forEach(type => {
                const container = document.getElementById(`${type}Categories`);
                const typeCategories = categories[type] || [];
                
                container.innerHTML = typeCategories.map(category => `
                    <div class="flex items-center justify-between p-2 border border-gray-200 rounded-lg">
                        <span class="text-sm">${category}</span>
                        <button onclick="deleteCategory('${type}', '${category}')" class="text-red-500 hover:text-red-700 text-sm">
                            üóëÔ∏è
                        </button>
                    </div>
                `).join('');
            });
        }

        // Ïπ¥ÌÖåÍ≥†Î¶¨ Ï∂îÍ∞Ä
        function addCategory(type) {
            const input = document.getElementById(`new${type.charAt(0).toUpperCase() + type.slice(1)}Category`);
            const newCategory = input.value.trim();
            
            if (!newCategory) {
                alert('Ïπ¥ÌÖåÍ≥†Î¶¨ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            if (categories[type].includes(newCategory)) {
                alert('Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäî Ïπ¥ÌÖåÍ≥†Î¶¨ÏûÖÎãàÎã§.');
                return;
            }
            
            categories[type].push(newCategory);
            localStorage.setItem('categories', JSON.stringify(categories));
            
            input.value = '';
            updateCategoryLists();
        }

        // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÇ≠Ï†ú
        function deleteCategory(type, category) {
            if (confirm(`'${category}' Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                categories[type] = categories[type].filter(c => c !== category);
                localStorage.setItem('categories', JSON.stringify(categories));
                updateCategoryLists();
            }
        }

        // Í∏∞Î≥∏ ÏÑ§Ï†ï Ï†ÄÏû•
        function saveBasicSettings() {
            settings.startDate = document.getElementById('startDate').value;
            settings.currency = document.getElementById('currency').value;
            
            localStorage.setItem('settings', JSON.stringify(settings));
            alert('ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§! ‚úÖ');
        }

        // ÏòàÏÇ∞ ÏÑ§Ï†ï ÏóÖÎç∞Ïù¥Ìä∏
        function updateBudgetSettings() {
            const container = document.getElementById('budgetSettings');
            const currentMonth = new Date().toISOString().slice(0, 7);
            
            if (!budgetGoals[currentMonth]) {
                container.innerHTML = '<p class="text-gray-500">ÏÑ§Ï†ïÎêú ÏòàÏÇ∞ Î™©ÌëúÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            const goals = budgetGoals[currentMonth];
            const typeNames = {
                income: 'ÏàòÏûÖ',
                savings: 'Ï†ÄÏ∂ï',
                expense: 'ÏßÄÏ∂ú'
            };
            
            container.innerHTML = Object.entries(goals).map(([type, amount]) => `
                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
                    <span class="text-sm font-medium">${typeNames[type]} Î™©Ìëú</span>
                    <div class="flex items-center space-x-2">
                        <span class="text-sm">${amount.toLocaleString()}Ïõê</span>
                        <button onclick="deleteBudgetGoal('${type}')" class="text-red-500 hover:text-red-700 text-sm">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ÏòàÏÇ∞ Î™©Ìëú Ï∂îÍ∞Ä
        function addBudgetGoal() {
            const type = prompt('ÏòàÏÇ∞ Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî:\n1. income (ÏàòÏûÖ)\n2. savings (Ï†ÄÏ∂ï)\n3. expense (ÏßÄÏ∂ú)');
            if (!type || !['income', 'savings', 'expense'].includes(type)) {
                alert('Ïò¨Î∞îÎ•∏ Ïú†ÌòïÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const amount = prompt('Î™©Ìëú Í∏àÏï°ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (Ïõê):');
            if (!amount || isNaN(amount) || parseInt(amount) <= 0) {
                alert('Ïò¨Î∞îÎ•∏ Í∏àÏï°ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const currentMonth = new Date().toISOString().slice(0, 7);
            if (!budgetGoals[currentMonth]) {
                budgetGoals[currentMonth] = {};
            }
            
            budgetGoals[currentMonth][type] = parseInt(amount);
            localStorage.setItem('budgetGoals', JSON.stringify(budgetGoals));
            
            updateBudgetSettings();
            alert('ÏòàÏÇ∞ Î™©ÌëúÍ∞Ä ÏÑ§Ï†ïÎêòÏóàÏäµÎãàÎã§! üéØ');
        }

        // ÏòàÏÇ∞ Î™©Ìëú ÏÇ≠Ï†ú
        function deleteBudgetGoal(type) {
            const currentMonth = new Date().toISOString().slice(0, 7);
            if (budgetGoals[currentMonth] && budgetGoals[currentMonth][type]) {
                delete budgetGoals[currentMonth][type];
                localStorage.setItem('budgetGoals', JSON.stringify(budgetGoals));
                updateBudgetSettings();
            }
        }

        // Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞
        function exportData() {
            const data = {
                entries,
                assets,
                categories,
                budgetGoals,
                settings,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Í∞ÄÍ≥ÑÎ∂Ä_Î∞±ÏóÖ_${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (confirm('Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Î•º Î™®Îëê ÎçÆÏñ¥Ïì∞ÏãúÍ≤†ÏäµÎãàÍπå?')) {
                            entries = data.entries || [];
                            assets = data.assets || [];
                            categories = data.categories || categories;
                            budgetGoals = data.budgetGoals || {};
                            settings = data.settings || settings;
                            
                            // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•
                            localStorage.setItem('entries', JSON.stringify(entries));
                            localStorage.setItem('assets', JSON.stringify(assets));
                            localStorage.setItem('categories', JSON.stringify(categories));
                            localStorage.setItem('budgetGoals', JSON.stringify(budgetGoals));
                            localStorage.setItem('settings', JSON.stringify(settings));
                            
                            // Î∑∞ ÏóÖÎç∞Ïù¥Ìä∏
                            updateRecentEntries();
                            updateAssetsView();
                            initSettingsView();
                            
                            alert('Îç∞Ïù¥ÌÑ∞Î•º ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Í∞ÄÏ†∏ÏôîÏäµÎãàÎã§! üì•');
                        }
                    } catch (error) {
                        alert('ÌååÏùºÏùÑ ÏùΩÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
        function resetData() {
            if (confirm('Ï†ïÎßêÎ°ú Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.')) {
                if (confirm('Ìïú Î≤à Îçî ÌôïÏù∏Ìï©ÎãàÎã§. Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎê©ÎãàÎã§.')) {
                    localStorage.clear();
                    location.reload();
                }
            }
        }

        // ÏûêÏÇ∞ Ïú†Ìòï Î≥ÄÍ≤Ω Ïãú Ïπ¥ÌÖåÍ≥†Î¶¨ ÏóÖÎç∞Ïù¥Ìä∏
        document.getElementById('assetType').addEventListener('change', updateAssetCategories);

        // Í≥µÏú† Î∑∞ Ï¥àÍ∏∞Ìôî
        function initShareView() {
            updateShareStatus();
            updateActiveSharesList();
        }

        // Í≥µÏú† ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        function updateShareStatus() {
            const container = document.getElementById('shareStatus');
            
            if (activeShares.length === 0 && connectedShares.length === 0) {
                container.innerHTML = '<p class="text-gray-500">ÌòÑÏû¨ ÌôúÏÑ±ÌôîÎêú Í≥µÏú†Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            let html = '';
            
            if (activeShares.length > 0) {
                html += `<div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                    <p class="text-blue-700 font-medium">üì§ ÎÇ¥Í∞Ä Í≥µÏú†Ìïú Í∞ÄÍ≥ÑÎ∂Ä: ${activeShares.length}Í∞ú</p>
                </div>`;
            }
            
            if (connectedShares.length > 0) {
                html += `<div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                    <p class="text-green-700 font-medium">üì• Ïó∞Í≤∞Îêú Í∞ÄÍ≥ÑÎ∂Ä: ${connectedShares.length}Í∞ú</p>
                </div>`;
            }
            
            container.innerHTML = html;
        }

        // Í≥µÏú† ÎßÅÌÅ¨ ÏÉùÏÑ±
        function generateShareLink() {
            const shareType = document.getElementById('shareType').value;
            const shareEntries = document.getElementById('shareEntries').checked;
            const shareAssets = document.getElementById('shareAssets').checked;
            const shareBudgets = document.getElementById('shareBudgets').checked;
            const shareExpiry = document.getElementById('shareExpiry').value;
            
            if (!shareEntries && !shareAssets && !shareBudgets) {
                alert('Í≥µÏú†Ìï† Îç∞Ïù¥ÌÑ∞Î•º ÏµúÏÜå ÌïòÎÇòÎäî ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            // Í≥µÏú† ÏΩîÎìú ÏÉùÏÑ± (6ÏûêÎ¶¨ ÎûúÎç§)
            const shareCode = Math.random().toString(36).substring(2, 8).toUpperCase();
            
            // Í≥µÏú† Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑ
            const sharedData = {
                entries: shareEntries ? entries : [],
                assets: shareAssets ? assets : [],
                budgetGoals: shareBudgets ? budgetGoals : {},
                categories: categories,
                settings: settings
            };
            
            // ÎßåÎ£åÏùº Í≥ÑÏÇ∞
            let expiryDate = null;
            if (shareExpiry) {
                expiryDate = new Date();
                expiryDate.setDate(expiryDate.getDate() + parseInt(shareExpiry));
            }
            
            // Í≥µÏú† Ï†ïÎ≥¥ Ï†ÄÏû•
            const shareInfo = {
                id: Date.now(),
                code: shareCode,
                type: shareType,
                data: sharedData,
                createdAt: new Date().toISOString(),
                expiryDate: expiryDate ? expiryDate.toISOString() : null,
                accessCount: 0
            };
            
            activeShares.push(shareInfo);
            shareData[shareCode] = shareInfo;
            
            localStorage.setItem('activeShares', JSON.stringify(activeShares));
            localStorage.setItem('shareData', JSON.stringify(shareData));
            
            // Í≥µÏú† ÎßÅÌÅ¨ ÌëúÏãú
            const shareUrl = `${window.location.origin}${window.location.pathname}?share=${shareCode}`;
            document.getElementById('shareUrl').value = shareUrl;
            document.getElementById('shareCode').value = shareCode;
            document.getElementById('generatedLink').style.display = 'block';
            
            updateActiveSharesList();
            updateShareStatus();
            
            alert('Í≥µÏú† ÎßÅÌÅ¨Í∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§! üéâ');
        }

        // Í≥µÏú† ÎßÅÌÅ¨ Î≥µÏÇ¨
        function copyShareLink() {
            const shareUrl = document.getElementById('shareUrl');
            shareUrl.select();
            document.execCommand('copy');
            alert('Í≥µÏú† ÎßÅÌÅ¨Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§! üìã');
        }

        // Í≥µÏú† ÏΩîÎìú Î≥µÏÇ¨
        function copyShareCode() {
            const shareCode = document.getElementById('shareCode');
            shareCode.select();
            document.execCommand('copy');
            alert('Í≥µÏú† ÏΩîÎìúÍ∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§! üìã');
        }

        // Í≥µÏú† ÏΩîÎìúÎ°ú Ïó∞Í≤∞
        function connectWithCode() {
            const inputCode = document.getElementById('inputShareCode').value.trim().toUpperCase();
            
            if (!inputCode) {
                alert('Í≥µÏú† ÏΩîÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            // ÏãúÎÆ¨Î†àÏù¥ÏÖò: Ïã§Ï†úÎ°úÎäî ÏÑúÎ≤ÑÏóêÏÑú ÌôïÏù∏Ìï¥Ïïº Ìï®
            // Ïó¨Í∏∞ÏÑúÎäî Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏùò shareDataÏóêÏÑú ÌôïÏù∏
            if (!shareData[inputCode]) {
                alert('Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Í≥µÏú† ÏΩîÎìúÏûÖÎãàÎã§.');
                return;
            }
            
            const sharedInfo = shareData[inputCode];
            
            // ÎßåÎ£å ÌôïÏù∏
            if (sharedInfo.expiryDate && new Date() > new Date(sharedInfo.expiryDate)) {
                alert('ÎßåÎ£åÎêú Í≥µÏú† ÏΩîÎìúÏûÖÎãàÎã§.');
                return;
            }
            
            // Ïù¥ÎØ∏ Ïó∞Í≤∞Îêú ÏΩîÎìúÏù∏ÏßÄ ÌôïÏù∏
            if (connectedShares.some(share => share.code === inputCode)) {
                alert('Ïù¥ÎØ∏ Ïó∞Í≤∞Îêú Í∞ÄÍ≥ÑÎ∂ÄÏûÖÎãàÎã§.');
                return;
            }
            
            // Ïó∞Í≤∞ Ï†ïÎ≥¥ Ï†ÄÏû•
            const connectionInfo = {
                code: inputCode,
                type: sharedInfo.type,
                connectedAt: new Date().toISOString(),
                ownerName: `ÏÇ¨Ïö©Ïûê_${inputCode.substring(0, 3)}`
            };
            
            connectedShares.push(connectionInfo);
            localStorage.setItem('connectedShares', JSON.stringify(connectedShares));
            
            // Ï†ëÍ∑º ÌöüÏàò Ï¶ùÍ∞Ä
            sharedInfo.accessCount++;
            shareData[inputCode] = sharedInfo;
            localStorage.setItem('shareData', JSON.stringify(shareData));
            
            document.getElementById('inputShareCode').value = '';
            updateShareStatus();
            updateActiveSharesList();
            
            alert(`Í∞ÄÍ≥ÑÎ∂ÄÏóê ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ïó∞Í≤∞ÎêòÏóàÏäµÎãàÎã§! (${sharedInfo.type === 'view' ? 'Î≥¥Í∏∞ Ï†ÑÏö©' : 'Ìé∏Ïßë Í∞ÄÎä•'}) üéâ`);
        }

        // ÌôúÏÑ± Í≥µÏú† Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
        function updateActiveSharesList() {
            const container = document.getElementById('activeShares');
            
            if (activeShares.length === 0 && connectedShares.length === 0) {
                container.innerHTML = '<p class="text-gray-500">ÌôúÏÑ±ÌôîÎêú Í≥µÏú†Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            let html = '';
            
            // ÎÇ¥Í∞Ä Í≥µÏú†Ìïú Î™©Î°ù
            if (activeShares.length > 0) {
                html += '<h4 class="font-medium text-gray-800 mb-3">üì§ ÎÇ¥Í∞Ä Í≥µÏú†Ìïú Í∞ÄÍ≥ÑÎ∂Ä</h4>';
                activeShares.forEach(share => {
                    const isExpired = share.expiryDate && new Date() > new Date(share.expiryDate);
                    html += `
                        <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg ${isExpired ? 'bg-gray-50' : 'bg-white'}">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${share.type === 'view' ? 'text-blue-600 bg-blue-50' : 'text-green-600 bg-green-50'}">
                                        ${share.type === 'view' ? 'Î≥¥Í∏∞ Ï†ÑÏö©' : 'Ìé∏Ïßë Í∞ÄÎä•'}
                                    </span>
                                    <span class="text-sm font-mono font-medium">${share.code}</span>
                                    ${isExpired ? '<span class="text-xs text-red-500">(ÎßåÎ£åÎê®)</span>' : ''}
                                </div>
                                <p class="text-xs text-gray-500 mt-1">
                                    ÏÉùÏÑ±Ïùº: ${new Date(share.createdAt).toLocaleDateString()} | 
                                    Ï†ëÍ∑º ÌöüÏàò: ${share.accessCount}Ìöå
                                    ${share.expiryDate ? ` | ÎßåÎ£åÏùº: ${new Date(share.expiryDate).toLocaleDateString()}` : ''}
                                </p>
                            </div>
                            <button onclick="deleteShare('${share.code}')" class="text-red-500 hover:text-red-700 transition-colors">
                                üóëÔ∏è
                            </button>
                        </div>
                    `;
                });
            }
            
            // Ïó∞Í≤∞Îêú Í∞ÄÍ≥ÑÎ∂Ä Î™©Î°ù
            if (connectedShares.length > 0) {
                if (activeShares.length > 0) html += '<div class="my-4 border-t border-gray-200"></div>';
                html += '<h4 class="font-medium text-gray-800 mb-3">üì• Ïó∞Í≤∞Îêú Í∞ÄÍ≥ÑÎ∂Ä</h4>';
                connectedShares.forEach(connection => {
                    html += `
                        <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg bg-white">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${connection.type === 'view' ? 'text-blue-600 bg-blue-50' : 'text-green-600 bg-green-50'}">
                                        ${connection.type === 'view' ? 'Î≥¥Í∏∞ Ï†ÑÏö©' : 'Ìé∏Ïßë Í∞ÄÎä•'}
                                    </span>
                                    <span class="text-sm font-medium">${connection.ownerName}Ïùò Í∞ÄÍ≥ÑÎ∂Ä</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">
                                    Ïó∞Í≤∞Ïùº: ${new Date(connection.connectedAt).toLocaleDateString()} | 
                                    ÏΩîÎìú: ${connection.code}
                                </p>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="viewSharedData('${connection.code}')" class="text-blue-500 hover:text-blue-700 transition-colors text-sm">
                                    üëÅÔ∏è Î≥¥Í∏∞
                                </button>
                                <button onclick="disconnectShare('${connection.code}')" class="text-red-500 hover:text-red-700 transition-colors">
                                    üîå
                                </button>
                            </div>
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html;
        }

        // Í≥µÏú† ÏÇ≠Ï†ú
        function deleteShare(code) {
            if (confirm('Ïù¥ Í≥µÏú†Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                activeShares = activeShares.filter(share => share.code !== code);
                delete shareData[code];
                
                localStorage.setItem('activeShares', JSON.stringify(activeShares));
                localStorage.setItem('shareData', JSON.stringify(shareData));
                
                updateActiveSharesList();
                updateShareStatus();
            }
        }

        // Í≥µÏú† Ïó∞Í≤∞ Ìï¥Ï†ú
        function disconnectShare(code) {
            if (confirm('Ïù¥ Í∞ÄÍ≥ÑÎ∂Ä Ïó∞Í≤∞ÏùÑ Ìï¥Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                connectedShares = connectedShares.filter(connection => connection.code !== code);
                localStorage.setItem('connectedShares', JSON.stringify(connectedShares));
                
                updateActiveSharesList();
                updateShareStatus();
            }
        }

        // Í≥µÏú†Îêú Îç∞Ïù¥ÌÑ∞ Î≥¥Í∏∞
        function viewSharedData(code) {
            if (!shareData[code]) {
                alert('Í≥µÏú† Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            const sharedInfo = shareData[code];
            const data = sharedInfo.data;
            
            // ÏÉà Ï∞ΩÏóêÏÑú Í≥µÏú† Îç∞Ïù¥ÌÑ∞ ÌëúÏãú (Í∞ÑÎã®Ìïú ÏöîÏïΩ)
            let summary = `=== Í≥µÏú†Îêú Í∞ÄÍ≥ÑÎ∂Ä Îç∞Ïù¥ÌÑ∞ ===\n\n`;
            
            if (data.entries && data.entries.length > 0) {
                const totalIncome = data.entries.filter(e => e.type === 'income').reduce((sum, e) => sum + e.amount, 0);
                const totalSavings = data.entries.filter(e => e.type === 'savings').reduce((sum, e) => sum + e.amount, 0);
                const totalExpense = data.entries.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.amount, 0);
                
                summary += `üìä ÏàòÏûÖ/ÏßÄÏ∂ú ÏöîÏïΩ:\n`;
                summary += `- Ï¥ù ÏàòÏûÖ: ${totalIncome.toLocaleString()}Ïõê\n`;
                summary += `- Ï¥ù Ï†ÄÏ∂ï: ${totalSavings.toLocaleString()}Ïõê\n`;
                summary += `- Ï¥ù ÏßÄÏ∂ú: ${totalExpense.toLocaleString()}Ïõê\n`;
                summary += `- Ïàú ÏûêÏÇ∞ Î≥ÄÌôî: ${(totalIncome - totalSavings - totalExpense).toLocaleString()}Ïõê\n\n`;
            }
            
            if (data.assets && data.assets.length > 0) {
                const totalAssets = data.assets.filter(a => a.type === 'asset').reduce((sum, a) => sum + a.amount, 0);
                const totalLiabilities = data.assets.filter(a => a.type === 'liability').reduce((sum, a) => sum + a.amount, 0);
                
                summary += `üíé ÏûêÏÇ∞ ÏöîÏïΩ:\n`;
                summary += `- Ï¥ù ÏûêÏÇ∞: ${totalAssets.toLocaleString()}Ïõê\n`;
                summary += `- Ï¥ù Î∂ÄÏ±Ñ: ${totalLiabilities.toLocaleString()}Ïõê\n`;
                summary += `- Ïàú ÏûêÏÇ∞: ${(totalAssets - totalLiabilities).toLocaleString()}Ïõê\n\n`;
            }
            
            summary += `üìÖ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±Ïùº: ${new Date(sharedInfo.createdAt).toLocaleString()}\n`;
            summary += `üîí Í∂åÌïú: ${sharedInfo.type === 'view' ? 'Î≥¥Í∏∞ Ï†ÑÏö©' : 'Ìé∏Ïßë Í∞ÄÎä•'}`;
            
            alert(summary);
        }

        // URLÏóêÏÑú Í≥µÏú† ÏΩîÎìú ÌôïÏù∏ (ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú)
        function checkShareCode() {
            const urlParams = new URLSearchParams(window.location.search);
            const shareCode = urlParams.get('share');
            
            if (shareCode) {
                document.getElementById('inputShareCode').value = shareCode;
                showPage('share');
                
                // ÏûêÎèôÏúºÎ°ú Ïó∞Í≤∞ ÏãúÎèÑ
                setTimeout(() => {
                    if (confirm(`Í≥µÏú† ÏΩîÎìú "${shareCode}"Î°ú Í∞ÄÍ≥ÑÎ∂ÄÏóê Ïó∞Í≤∞ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                        connectWithCode();
                    }
                }, 500);
            }
        }

        // ÏùºÎ≥Ñ Î™®Îã¨ Ïó¥Í∏∞
        function openDayModal(dateStr) {
            currentModalDate = dateStr;
            const dayEntries = entries.filter(entry => entry.date === dateStr);
            
            // ÎÇ†Ïßú Ìè¨Îß∑ÌåÖ
            const date = new Date(dateStr);
            const formattedDate = `${date.getFullYear()}ÎÖÑ ${date.getMonth() + 1}Ïõî ${date.getDate()}Ïùº`;
            const dayOfWeek = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'][date.getDay()];
            
            document.getElementById('modalTitle').textContent = `üìÖ ${formattedDate} (${dayOfWeek})`;
            
            // ÎÇ¥Ïó≠ ÌëúÏãú
            const modalEntries = document.getElementById('modalEntries');
            if (dayEntries.length === 0) {
                modalEntries.innerHTML = '<p class="text-gray-500 text-center py-4">Ïù¥ ÎÇ†ÏóêÎäî ÏûÖÎ†•Îêú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</p>';
            } else {
                modalEntries.innerHTML = dayEntries.map(entry => {
                    const typeColors = {
                        income: 'text-green-600 bg-green-50 border-green-200',
                        savings: 'text-blue-600 bg-blue-50 border-blue-200',
                        expense: 'text-red-600 bg-red-50 border-red-200'
                    };
                    
                    const typeNames = {
                        income: 'üí∞ ÏàòÏûÖ',
                        savings: 'üè¶ Ï†ÄÏ∂ï',
                        expense: 'üí∏ ÏßÄÏ∂ú'
                    };
                    
                    // ÏòÅÏàòÏ¶ù Ï†ïÎ≥¥ ÌëúÏãú
                    let receiptInfo = '';
                    if (entry.receipt && (entry.receipt.store || entry.receipt.payment || entry.receipt.items)) {
                        receiptInfo = '<div class="mt-3 p-3 bg-gray-50 rounded-lg text-sm">';
                        if (entry.receipt.store) receiptInfo += `<div class="font-medium">üè™ ${entry.receipt.store}</div>`;
                        if (entry.receipt.payment) receiptInfo += `<div class="text-gray-600">üí≥ ${entry.receipt.payment}</div>`;
                        if (entry.receipt.items) {
                            receiptInfo += '<div class="mt-2"><strong>üõí Íµ¨Îß§ÌíàÎ™©:</strong></div>';
                            receiptInfo += `<div class="whitespace-pre-line text-gray-600 mt-1">${entry.receipt.items}</div>`;
                        }
                        receiptInfo += '</div>';
                    }
                    
                    return `
                        <div class="border rounded-lg p-4 ${typeColors[entry.type]}">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center space-x-2">
                                    <span class="font-medium">${typeNames[entry.type]}</span>
                                    ${entry.mood ? `<span class="text-xl">${entry.mood}</span>` : ''}
                                </div>
                                <span class="font-bold text-lg">${formatCurrencyDisplay(entry.amount, entry.currency || 'KRW')}</span>
                            </div>
                            <div class="text-sm mb-1">
                                <strong>Ïπ¥ÌÖåÍ≥†Î¶¨:</strong> ${entry.category}
                            </div>
                            <div class="text-sm">
                                <strong>Î©îÎ™®:</strong> ${entry.memo || 'Î©îÎ™® ÏóÜÏùå'}
                            </div>
                            ${receiptInfo}
                        </div>
                    `;
                }).join('');
            }
            
            // ÏΩîÎ©òÌä∏ ÌëúÏãú
            updateModalComments(dateStr);
            
            // Î™®Îã¨ ÌëúÏãú
            document.getElementById('dayModal').style.display = 'block';
        }

        // Î™®Îã¨ Îã´Í∏∞
        function closeDayModal() {
            document.getElementById('dayModal').style.display = 'none';
            currentModalDate = null;
            document.getElementById('commentInput').value = '';
        }

        // Î™®Îã¨ ÏΩîÎ©òÌä∏ ÏóÖÎç∞Ïù¥Ìä∏
        function updateModalComments(dateStr) {
            const modalComments = document.getElementById('modalComments');
            const dayComments = comments[dateStr] || [];
            
            if (dayComments.length === 0) {
                modalComments.innerHTML = '<p class="text-gray-500 text-sm">ÏïÑÏßÅ ÏΩîÎ©òÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
            } else {
                modalComments.innerHTML = dayComments.map(comment => `
                    <div class="comment-item">
                        <div class="comment-author">${comment.author}</div>
                        <div class="comment-text">${comment.text}</div>
                        <div class="comment-date">${new Date(comment.timestamp).toLocaleString()}</div>
                    </div>
                `).join('');
            }
        }

        // ÏΩîÎ©òÌä∏ Ï∂îÍ∞Ä
        function addComment() {
            const commentInput = document.getElementById('commentInput');
            const commentText = commentInput.value.trim();
            
            if (!commentText) {
                alert('ÏΩîÎ©òÌä∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            if (!currentModalDate) {
                alert('ÎÇ†Ïßú Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            // ÏΩîÎ©òÌä∏ Í∞ùÏ≤¥ ÏÉùÏÑ±
            const comment = {
                id: Date.now(),
                author: 'ÎÇò', // Ïã§Ï†úÎ°úÎäî ÏÇ¨Ïö©Ïûê Ïù¥Î¶ÑÏùÑ ÏÇ¨Ïö©
                text: commentText,
                timestamp: new Date().toISOString()
            };
            
            // ÏΩîÎ©òÌä∏ Ï†ÄÏû•
            if (!comments[currentModalDate]) {
                comments[currentModalDate] = [];
            }
            comments[currentModalDate].push(comment);
            localStorage.setItem('comments', JSON.stringify(comments));
            
            // ÏûÖÎ†• ÌïÑÎìú Ï¥àÍ∏∞Ìôî
            commentInput.value = '';
            
            // ÏΩîÎ©òÌä∏ Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
            updateModalComments(currentModalDate);
            
            // ÏÑ±Í≥µ Î©îÏãúÏßÄ
            alert('ÏΩîÎ©òÌä∏Í∞Ä Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§! üí¨');
        }

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
        window.onclick = function(event) {
            const modal = document.getElementById('dayModal');
            if (event.target === modal) {
                closeDayModal();
            }
        }

        // Enter ÌÇ§Î°ú ÏΩîÎ©òÌä∏ Ï∂îÍ∞Ä
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && document.getElementById('commentInput') === document.activeElement) {
                addComment();
            }
        });

        // Í∏∞Î∂Ñ ÏÑ†ÌÉù Ìï®Ïàò
        function selectMood(button, mood) {
            // Î™®Îì† Í∏∞Î∂Ñ Î≤ÑÌäºÏóêÏÑú ÏÑ†ÌÉù ÏÉÅÌÉú Ï†úÍ±∞
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // ÌÅ¥Î¶≠Îêú Î≤ÑÌäºÏóê ÏÑ†ÌÉù ÏÉÅÌÉú Ï∂îÍ∞Ä
            button.classList.add('selected');
            
            // Ïà®Í≤®ÏßÑ ÏûÖÎ†• ÌïÑÎìúÏóê Í∏∞Î∂Ñ Í∞í Ï†ÄÏû•
            document.getElementById('entryMood').value = mood;
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            init();
            checkShareCode();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97d80d2da473ea99',t:'MTc1NzYwMzAwMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
