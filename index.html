<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸ ê°€ê³„ë¶€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .page { display: none; }
        .page.active { display: block; }
        .nav-item.active { background-color: #3b82f6; color: white; }
        .chart-container { position: relative; height: 300px; }
        .chart-bar { transition: all 0.3s ease; }
        .chart-bar:hover { opacity: 0.8; }
        
        .calendar-container {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .calendar-header {
            background-color: #f3f4f6;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            color: #374151;
        }
        
        .calendar-day {
            background-color: white;
            min-height: 80px;
            padding: 8px 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .calendar-day:hover {
            background-color: #f9fafb;
            transform: scale(1.02);
        }
        
        .calendar-day.other-month {
            background-color: #f9fafb;
            color: #9ca3af;
        }
        
        .calendar-day.today {
            background-color: #dbeafe;
            border: 2px solid #3b82f6;
        }
        
        .calendar-day.no-spend {
            background-color: #fef3c7;
        }
        
        .calendar-day-number {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .calendar-indicators {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            justify-content: center;
        }
        
        .calendar-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }
        
        .calendar-indicator.income { background-color: #10b981; }
        .calendar-indicator.savings { background-color: #3b82f6; }
        .calendar-indicator.expense { background-color: #ef4444; }
        
        .no-spend-icon {
            font-size: 16px;
            margin-top: 2px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .close {
            color: #9ca3af;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        
        .close:hover {
            color: #374151;
        }
        
        .comment-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
        }
        
        .comment-item {
            background-color: #f9fafb;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
        }
        
        .comment-author {
            font-weight: 600;
            font-size: 14px;
            color: #374151;
            margin-bottom: 4px;
        }
        
        .comment-text {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 4px;
        }
        
        .comment-date {
            font-size: 12px;
            color: #9ca3af;
        }
        
        .mood-btn.selected {
            background-color: #3b82f6;
            border-color: #3b82f6;
            color: white;
            transform: scale(1.1);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="bg-white shadow-lg border-b">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <h1 class="text-2xl font-bold text-gray-800">ğŸ’° ìŠ¤ë§ˆíŠ¸ ê°€ê³„ë¶€</h1>
                <div class="flex space-x-2">
                    <button onclick="showPage('entry')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-blue-500 text-white">ë‚´ì—­ ì…ë ¥</button>
                    <button onclick="showPage('monthly')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100">ì›”ë³„ ì •ë¦¬</button>
                    <button onclick="showPage('yearly')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100">ì—°ë„ë³„ ì •ë¦¬</button>
                    <button onclick="showPage('assets')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100">ìì‚° ê´€ë¦¬</button>
                    <button onclick="showPage('settings')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100">ì„¤ì •</button>
                    <button onclick="showPage('share')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100">ê³µìœ </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- í˜ì´ì§€ 1: ë‚´ì—­ ì…ë ¥ -->
    <div id="entry" class="page active">
        <div class="max-w-4xl mx-auto p-6">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold mb-6 text-gray-800">ğŸ’³ ìˆ˜ì…/ì§€ì¶œ ë‚´ì—­ ì…ë ¥</h2>
                
                <form id="entryForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ë‚ ì§œ</label>
                        <input type="date" id="entryDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ìœ í˜•</label>
                        <select id="entryType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="updateCategories()" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="income">ìˆ˜ì…</option>
                            <option value="savings">ì €ì¶•</option>
                            <option value="expense">ì§€ì¶œ</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì¹´í…Œê³ ë¦¬</label>
                        <select id="entryCategory" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">ìœ í˜•ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ê¸ˆì•¡</label>
                        <div class="flex space-x-2">
                            <input type="text" id="entryAmount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" required oninput="formatAmountInput(this)" style="min-width: 200px;">
                            <select id="entryCurrency" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent whitespace-nowrap">
                                <option value="KRW">ì› (â‚©)</option>
                                <option value="USD">ë‹¬ëŸ¬ ($)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="memoMoodSection" class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4" style="display: none;">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ìƒì„¸ ë©”ëª¨ ğŸ“</label>
                            <textarea id="entryMemo" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none" placeholder="ìœ í˜•ì„ ì„ íƒí•˜ë©´ ì˜ˆì‹œê°€ í‘œì‹œë©ë‹ˆë‹¤"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì˜¤ëŠ˜ì˜ ê¸°ë¶„ ğŸ˜Š</label>
                            <div class="grid grid-cols-5 gap-2">
                                <button type="button" class="mood-btn p-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-2xl" onclick="selectMood(this, 'ğŸ˜Š')">ğŸ˜Š</button>
                                <button type="button" class="mood-btn p-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-2xl" onclick="selectMood(this, 'ğŸ˜¢')">ğŸ˜¢</button>
                                <button type="button" class="mood-btn p-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-2xl" onclick="selectMood(this, 'ğŸ˜')">ğŸ˜</button>
                                <button type="button" class="mood-btn p-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-2xl" onclick="selectMood(this, 'ğŸ˜¤')">ğŸ˜¤</button>
                                <button type="button" class="mood-btn p-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-2xl" onclick="selectMood(this, 'ğŸ¤”')">ğŸ¤”</button>
                            </div>
                            <input type="hidden" id="entryMood" value="">
                            <p class="text-xs text-gray-500 mt-2">ì§€ì¶œì´ì–´ë„ ê¸°ë¶„ ì¢‹ì€ ì†Œë¹„ê°€ ìˆê³ , ìˆ˜ì…ì´ì–´ë„ ë³µì¡í•œ ê°ì •ì´ ìˆì„ ìˆ˜ ìˆì–´ìš”!</p>
                        </div>
                    </div>
                    
                    <div id="receiptSection" class="md:col-span-2" style="display: none;">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì˜ìˆ˜ì¦ ì •ë³´ ğŸ§¾</label>
                        <div class="space-y-3 p-4 bg-gray-50 rounded-lg">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">ìƒí˜¸ëª…</label>
                                    <input type="text" id="receiptStore" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ì˜ˆ: ì´ë§ˆíŠ¸ ì›”ë“œì»µì ">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">ê²°ì œ ë°©ë²•</label>
                                    <select id="receiptPayment" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">ì„ íƒ</option>
                                        <option value="card">ì‹ ìš©ì¹´ë“œ</option>
                                        <option value="cash">í˜„ê¸ˆ</option>
                                        <option value="transfer">ê³„ì¢Œì´ì²´</option>
                                        <option value="mobile">ëª¨ë°”ì¼í˜ì´</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600 mb-1">êµ¬ë§¤ í’ˆëª© (í•œ ì¤„ì— í•˜ë‚˜ì”©)</label>
                                <textarea id="receiptItems" rows="3" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none" placeholder="ì‚¬ê³¼ 3ê°œ - 4,500ì›
ìš°ìœ  2íŒ© - 3,200ì›
ê³„ë€ 1íŒ - 2,800ì›"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="md:col-span-2">
                        <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            âœ… ë‚´ì—­ ì¶”ê°€
                        </button>
                    </div>
                </form>
            </div>

            <!-- ìµœê·¼ ë‚´ì—­ -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">ğŸ“‹ ìµœê·¼ ë‚´ì—­</h3>
                <div id="recentEntries" class="space-y-3">
                    <!-- ìµœê·¼ ë‚´ì—­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>

    <!-- í˜ì´ì§€ 2: ì›”ë³„ ì •ë¦¬ -->
    <div id="monthly" class="page">
        <div class="max-w-7xl mx-auto p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">ğŸ“Š ì›”ë³„ ê°€ê³„ë¶€</h2>
                <div class="flex items-center space-x-4">
                    <select id="monthlyYear" class="px-3 py-2 border border-gray-300 rounded-lg" onchange="updateMonthlyView()">
                        <!-- ì—°ë„ ì˜µì…˜ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </select>
                    <select id="monthlyMonth" class="px-3 py-2 border border-gray-300 rounded-lg" onchange="updateMonthlyView()">
                        <option value="1">1ì›”</option>
                        <option value="2">2ì›”</option>
                        <option value="3">3ì›”</option>
                        <option value="4">4ì›”</option>
                        <option value="5">5ì›”</option>
                        <option value="6">6ì›”</option>
                        <option value="7">7ì›”</option>
                        <option value="8">8ì›”</option>
                        <option value="9">9ì›”</option>
                        <option value="10">10ì›”</option>
                        <option value="11">11ì›”</option>
                        <option value="12">12ì›”</option>
                    </select>
                </div>
            </div>

            <!-- ì›”ë³„ ë‹¬ë ¥ -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">ğŸ“… ì›”ë³„ ë‹¬ë ¥</h3>
                <div id="monthlyCalendar" class="calendar-container">
                    <!-- ë‹¬ë ¥ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                <div class="flex items-center justify-center space-x-6 mt-4 text-sm">
                    <div class="flex items-center space-x-1">
                        <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                        <span>ìˆ˜ì…</span>
                    </div>
                    <div class="flex items-center space-x-1">
                        <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
                        <span>ì €ì¶•</span>
                    </div>
                    <div class="flex items-center space-x-1">
                        <span class="w-3 h-3 bg-red-500 rounded-full"></span>
                        <span>ì§€ì¶œ</span>
                    </div>
                    <div class="flex items-center space-x-1">
                        <span class="text-lg">ğŸ‰</span>
                        <span>ë¬´ì§€ì¶œ</span>
                    </div>
                </div>
            </div>

            <!-- ì›”ë³„ ìš”ì•½ -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="bg-green-50 border border-green-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-green-600 text-sm font-medium">ì´ ìˆ˜ì…</p>
                            <p id="monthlyIncome" class="text-2xl font-bold text-green-700">0ì›</p>
                            <div id="incomeChange" class="text-xs mt-1"></div>
                        </div>
                        <div class="text-green-500 text-3xl">ğŸ’°</div>
                    </div>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-blue-600 text-sm font-medium">ì´ ì €ì¶•</p>
                            <p id="monthlySavings" class="text-2xl font-bold text-blue-700">0ì›</p>
                            <div id="savingsChange" class="text-xs mt-1"></div>
                        </div>
                        <div class="text-blue-500 text-3xl">ğŸ¦</div>
                    </div>
                </div>
                
                <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-red-600 text-sm font-medium">ì´ ì§€ì¶œ</p>
                            <p id="monthlyExpense" class="text-2xl font-bold text-red-700">0ì›</p>
                            <div id="expenseChange" class="text-xs mt-1"></div>
                        </div>
                        <div class="text-red-500 text-3xl">ğŸ’¸</div>
                    </div>
                </div>
                
                <div class="bg-purple-50 border border-purple-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-purple-600 text-sm font-medium">ìˆœ ìì‚° ë³€í™”</p>
                            <p id="monthlyNet" class="text-2xl font-bold text-purple-700">0ì›</p>
                            <div id="netChange" class="text-xs mt-1"></div>
                        </div>
                        <div class="text-purple-500 text-3xl">ğŸ“ˆ</div>
                    </div>
                </div>
            </div>

            <!-- ì˜ˆì‚° ëŒ€ë¹„ í˜„í™© -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">ğŸ¯ ì˜ˆì‚° ë‹¬ì„± í˜„í™©</h3>
                <div id="budgetProgress" class="space-y-4">
                    <!-- ì˜ˆì‚° ì§„í–‰ë¥ ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ì§€ì¶œ ë¶„ì„ -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-red-700">ğŸ” ì§€ì¶œ ë¶„ì„</h3>
                <div id="expenseAnalysis" class="space-y-4">
                    <!-- ì§€ì¶œ ë¶„ì„ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ì¹´í…Œê³ ë¦¬ë³„ ìƒì„¸ -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-700">ğŸ’° ìˆ˜ì… ë‚´ì—­</h3>
                    <div id="monthlyIncomeDetails" class="space-y-2">
                        <!-- ìˆ˜ì… ìƒì„¸ ë‚´ì—­ -->
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-blue-700">ğŸ¦ ì €ì¶• ë‚´ì—­</h3>
                    <div id="monthlySavingsDetails" class="space-y-2">
                        <!-- ì €ì¶• ìƒì„¸ ë‚´ì—­ -->
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-red-700">ğŸ’¸ ì§€ì¶œ ë‚´ì—­</h3>
                    <div id="monthlyExpenseDetails" class="space-y-2">
                        <!-- ì§€ì¶œ ìƒì„¸ ë‚´ì—­ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- í˜ì´ì§€ 3: ì—°ë„ë³„ ì •ë¦¬ -->
    <div id="yearly" class="page">
        <div class="max-w-6xl mx-auto p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">ğŸ“ˆ ì—°ë„ë³„ ê°€ê³„ë¶€</h2>
                <select id="yearlyYear" class="px-3 py-2 border border-gray-300 rounded-lg" onchange="updateYearlyView()">
                    <!-- ì—°ë„ ì˜µì…˜ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </select>
            </div>

            <!-- ì—°ë„ë³„ ìš”ì•½ -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="bg-green-50 border border-green-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-600 text-sm font-medium">ì—°ê°„ ì´ ìˆ˜ì…</p>
                            <p id="yearlyIncome" class="text-2xl font-bold text-green-700">0ì›</p>
                        </div>
                        <div class="text-green-500 text-3xl">ğŸ’°</div>
                    </div>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-600 text-sm font-medium">ì—°ê°„ ì´ ì €ì¶•</p>
                            <p id="yearlySavings" class="text-2xl font-bold text-blue-700">0ì›</p>
                        </div>
                        <div class="text-blue-500 text-3xl">ğŸ¦</div>
                    </div>
                </div>
                
                <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-600 text-sm font-medium">ì—°ê°„ ì´ ì§€ì¶œ</p>
                            <p id="yearlyExpense" class="text-2xl font-bold text-red-700">0ì›</p>
                        </div>
                        <div class="text-red-500 text-3xl">ğŸ’¸</div>
                    </div>
                </div>
                
                <div class="bg-purple-50 border border-purple-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-600 text-sm font-medium">ì—°ê°„ ìˆœ ìì‚° ë³€í™”</p>
                            <p id="yearlyNet" class="text-2xl font-bold text-purple-700">0ì›</p>
                        </div>
                        <div class="text-purple-500 text-3xl">ğŸ“Š</div>
                    </div>
                </div>
            </div>

            <!-- ì›”ë³„ ì°¨íŠ¸ -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">ğŸ“Š ì›”ë³„ ì¶”ì´</h3>
                <div class="chart-container">
                    <canvas id="yearlyChart" class="w-full h-full"></canvas>
                </div>
            </div>

            <!-- ì›”ë³„ ì§€ì¶œ ë¶„ì„ -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-red-700">ğŸ“Š ì›”ë³„ ì§€ì¶œ ë¶„ì„</h3>
                <div id="monthlyExpenseBreakdown" class="space-y-4">
                    <!-- ì›”ë³„ ì§€ì¶œ ë¶„ì„ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ì¹´í…Œê³ ë¦¬ë³„ ì—°ê°„ í†µê³„ -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-700">ğŸ’° ì—°ê°„ ìˆ˜ì… ë¶„ì„</h3>
                    <div id="yearlyIncomeAnalysis" class="space-y-3">
                        <!-- ì—°ê°„ ìˆ˜ì… ë¶„ì„ -->
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-blue-700">ğŸ¦ ì—°ê°„ ì €ì¶• ë¶„ì„</h3>
                    <div id="yearlySavingsAnalysis" class="space-y-3">
                        <!-- ì—°ê°„ ì €ì¶• ë¶„ì„ -->
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-red-700">ğŸ’¸ ì—°ê°„ ì§€ì¶œ ë¶„ì„</h3>
                    <div id="yearlyExpenseAnalysis" class="space-y-3">
                        <!-- ì—°ê°„ ì§€ì¶œ ë¶„ì„ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- í˜ì´ì§€ 4: ìì‚° ê´€ë¦¬ -->
    <div id="assets" class="page">
        <div class="max-w-6xl mx-auto p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">ğŸ  ìì‚° ê´€ë¦¬</h2>
                <button onclick="showAssetForm()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                    â• ìì‚° ì¶”ê°€
                </button>
            </div>

            <!-- ìì‚° ìš”ì•½ -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="bg-green-50 border border-green-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-600 text-sm font-medium">ì´ ìì‚°</p>
                            <p id="totalAssets" class="text-2xl font-bold text-green-700">0ì›</p>
                        </div>
                        <div class="text-green-500 text-3xl">ğŸ’</div>
                    </div>
                </div>
                
                <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-600 text-sm font-medium">ì´ ë¶€ì±„</p>
                            <p id="totalLiabilities" class="text-2xl font-bold text-red-700">0ì›</p>
                        </div>
                        <div class="text-red-500 text-3xl">ğŸ“‰</div>
                    </div>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-600 text-sm font-medium">ìˆœ ìì‚°</p>
                            <p id="netWorth" class="text-2xl font-bold text-blue-700">0ì›</p>
                        </div>
                        <div class="text-blue-500 text-3xl">ğŸ’°</div>
                    </div>
                </div>
            </div>

            <!-- ìì‚° ì…ë ¥ í¼ (ìˆ¨ê¹€) -->
            <div id="assetForm" class="bg-white rounded-xl shadow-lg p-6 mb-6" style="display: none;">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">ìì‚°/ë¶€ì±„ ì¶”ê°€</h3>
                <form id="assetEntryForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ìœ í˜•</label>
                        <select id="assetType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="asset">ìì‚°</option>
                            <option value="liability">ë¶€ì±„</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì¹´í…Œê³ ë¦¬</label>
                        <select id="assetCategory" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">ìœ í˜•ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">í•­ëª©ëª…</label>
                        <input type="text" id="assetName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ì˜ˆ: ì‹ í•œì€í–‰ ì ê¸ˆ" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ê¸ˆì•¡</label>
                        <div class="flex space-x-2">
                            <input type="text" id="assetAmount" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" required oninput="formatAmountInput(this)">
                            <select id="assetCurrency" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="KRW">ì› (â‚©)</option>
                                <option value="USD">ë‹¬ëŸ¬ ($)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ë©”ëª¨</label>
                        <input type="text" id="assetMemo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ì„ íƒì‚¬í•­">
                    </div>
                    
                    <div class="md:col-span-2 flex space-x-3">
                        <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                            âœ… ì¶”ê°€
                        </button>
                        <button type="button" onclick="hideAssetForm()" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            ì·¨ì†Œ
                        </button>
                    </div>
                </form>
            </div>

            <!-- ìì‚° ëª©ë¡ -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-700">ğŸ’ ìì‚° ëª©ë¡</h3>
                    <div id="assetsList" class="space-y-3">
                        <!-- ìì‚° ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-red-700">ğŸ“‰ ë¶€ì±„ ëª©ë¡</h3>
                    <div id="liabilitiesList" class="space-y-3">
                        <!-- ë¶€ì±„ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- í˜ì´ì§€ 5: ê³µìœ  -->
    <div id="share" class="page">
        <div class="max-w-4xl mx-auto p-6">
            <h2 class="text-2xl font-semibold mb-6 text-gray-800">ğŸ¤ ê°€ê³„ë¶€ ê³µìœ </h2>

            <!-- ê³µìœ  ìƒíƒœ -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">ğŸ“Š í˜„ì¬ ê³µìœ  ìƒíƒœ</h3>
                <div id="shareStatus" class="space-y-3">
                    <!-- ê³µìœ  ìƒíƒœê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ê³µìœ  ë§í¬ ìƒì„± -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">ğŸ”— ê³µìœ  ë§í¬ ìƒì„±</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ê³µìœ  ìœ í˜•</label>
                        <select id="shareType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="view">ë³´ê¸° ì „ìš© (ì½ê¸°ë§Œ ê°€ëŠ¥)</option>
                            <option value="edit">í¸ì§‘ ê°€ëŠ¥ (ìˆ˜ì • ê°€ëŠ¥)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ê³µìœ í•  ë°ì´í„° ì„ íƒ</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="shareEntries" class="mr-2" checked>
                                <span class="text-sm">ìˆ˜ì…/ì§€ì¶œ ë‚´ì—­</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="shareAssets" class="mr-2" checked>
                                <span class="text-sm">ìì‚° ì •ë³´</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="shareBudgets" class="mr-2" checked>
                                <span class="text-sm">ì˜ˆì‚° ëª©í‘œ</span>
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ê³µìœ  ê¸°ê°„ (ì„ íƒì‚¬í•­)</label>
                        <select id="shareExpiry" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">ë¬´ì œí•œ</option>
                            <option value="1">1ì¼</option>
                            <option value="7">7ì¼</option>
                            <option value="30">30ì¼</option>
                            <option value="90">90ì¼</option>
                        </select>
                    </div>
                    
                    <button onclick="generateShareLink()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                        ğŸ”— ê³µìœ  ë§í¬ ìƒì„±
                    </button>
                </div>
            </div>

            <!-- ìƒì„±ëœ ê³µìœ  ë§í¬ -->
            <div id="generatedLink" class="bg-white rounded-xl shadow-lg p-6 mb-6" style="display: none;">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">âœ… ê³µìœ  ë§í¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</h3>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ê³µìœ  ë§í¬</label>
                        <div class="flex space-x-2">
                            <input type="text" id="shareUrl" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                            <button onclick="copyShareLink()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                                ğŸ“‹ ë³µì‚¬
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ê³µìœ  ì½”ë“œ</label>
                        <div class="flex space-x-2">
                            <input type="text" id="shareCode" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-center text-lg font-mono" readonly>
                            <button onclick="copyShareCode()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                                ğŸ“‹ ë³µì‚¬
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">ìƒëŒ€ë°©ì´ ì´ ì½”ë“œë¥¼ ì…ë ¥í•˜ì—¬ ê°€ê³„ë¶€ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>

            <!-- ê³µìœ  ì½”ë“œë¡œ ì ‘ì† -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">ğŸ”‘ ê³µìœ  ì½”ë“œë¡œ ì ‘ì†</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ê³µìœ  ì½”ë“œ ì…ë ¥</label>
                        <div class="flex space-x-2">
                            <input type="text" id="inputShareCode" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-center text-lg font-mono" placeholder="ì˜ˆ: ABC123">
                            <button onclick="connectWithCode()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors">
                                ğŸ”— ì—°ê²°
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- í™œì„± ê³µìœ  ëª©ë¡ -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">ğŸ“‹ í™œì„± ê³µìœ  ëª©ë¡</h3>
                <div id="activeShares" class="space-y-3">
                    <!-- í™œì„± ê³µìœ  ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>

    <!-- í˜ì´ì§€ 6: ì„¤ì • -->
    <div id="settings" class="page">
        <div class="max-w-4xl mx-auto p-6">
            <h2 class="text-2xl font-semibold mb-6 text-gray-800">âš™ï¸ ê°€ê³„ë¶€ ì„¤ì •</h2>

            <!-- ê¸°ë³¸ ì„¤ì • -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">ğŸ“… ê¸°ë³¸ ì„¤ì •</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ê°€ê³„ë¶€ ì‹œì‘ì¼</label>
                        <input type="date" id="startDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ê¸°ë³¸ í†µí™”</label>
                        <select id="currency" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="KRW">ì› (KRW)</option>
                            <option value="USD">ë‹¬ëŸ¬ (USD)</option>
                            <option value="EUR">ìœ ë¡œ (EUR)</option>
                        </select>
                    </div>
                </div>
                <button onclick="saveBasicSettings()" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                    ğŸ’¾ ì €ì¥
                </button>
            </div>

            <!-- ì˜ˆì‚° ì„¤ì • -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">ğŸ¯ ì›”ë³„ ì˜ˆì‚° ëª©í‘œ</h3>
                <div id="budgetSettings" class="space-y-4">
                    <!-- ì˜ˆì‚° ì„¤ì •ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                <button onclick="addBudgetGoal()" class="mt-4 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                    â• ì˜ˆì‚° ëª©í‘œ ì¶”ê°€
                </button>
            </div>

            <!-- ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-700">ğŸ’° ìˆ˜ì… ì¹´í…Œê³ ë¦¬</h3>
                    <div id="incomeCategories" class="space-y-2 mb-4">
                        <!-- ìˆ˜ì… ì¹´í…Œê³ ë¦¬ ëª©ë¡ -->
                    </div>
                    <div class="flex space-x-2">
                        <input type="text" id="newIncomeCategory" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="ìƒˆ ì¹´í…Œê³ ë¦¬">
                        <button onclick="addCategory('income')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-sm transition-colors">ì¶”ê°€</button>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-blue-700">ğŸ¦ ì €ì¶• ì¹´í…Œê³ ë¦¬</h3>
                    <div id="savingsCategories" class="space-y-2 mb-4">
                        <!-- ì €ì¶• ì¹´í…Œê³ ë¦¬ ëª©ë¡ -->
                    </div>
                    <div class="flex space-x-2">
                        <input type="text" id="newSavingsCategory" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="ìƒˆ ì¹´í…Œê³ ë¦¬">
                        <button onclick="addCategory('savings')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm transition-colors">ì¶”ê°€</button>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-red-700">ğŸ’¸ ì§€ì¶œ ì¹´í…Œê³ ë¦¬</h3>
                    <div id="expenseCategories" class="space-y-2 mb-4">
                        <!-- ì§€ì¶œ ì¹´í…Œê³ ë¦¬ ëª©ë¡ -->
                    </div>
                    <div class="flex space-x-2">
                        <input type="text" id="newExpenseCategory" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="ìƒˆ ì¹´í…Œê³ ë¦¬">
                        <button onclick="addCategory('expense')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm transition-colors">ì¶”ê°€</button>
                    </div>
                </div>
            </div>

            <!-- ë°ì´í„° ê´€ë¦¬ -->
            <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h3>
                <div class="flex flex-wrap gap-4">
                    <button onclick="exportData()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                        ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
                    </button>
                    <button onclick="importData()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                        ğŸ“¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                    </button>
                    <button onclick="resetData()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                        ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì¼ë³„ ë‚´ì—­ íŒì—… ëª¨ë‹¬ -->
    <div id="dayModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle" class="text-lg font-semibold text-gray-800"></h3>
                <span class="close" onclick="closeDayModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="modalEntries" class="space-y-3">
                    <!-- ì¼ë³„ ë‚´ì—­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                
                <!-- ì½”ë©˜íŠ¸ ì„¹ì…˜ -->
                <div class="comment-section">
                    <h4 class="font-medium text-gray-800 mb-3">ğŸ’¬ ì½”ë©˜íŠ¸</h4>
                    <div id="modalComments" class="space-y-2 mb-4">
                        <!-- ì½”ë©˜íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                    
                    <div class="flex space-x-2">
                        <input type="text" id="commentInput" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ì½”ë©˜íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
                        <button onclick="addComment()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                            ğŸ’¬ ì¶”ê°€
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let entries = JSON.parse(localStorage.getItem('entries') || '[]');
        let assets = JSON.parse(localStorage.getItem('assets') || '[]');
        let categories = JSON.parse(localStorage.getItem('categories') || JSON.stringify({
            income: ['ê¸‰ì—¬', 'ë¶€ì—…', 'íˆ¬ììˆ˜ìµ', 'ê¸°íƒ€ìˆ˜ì…'],
            savings: ['ì ê¸ˆ', 'ì˜ˆê¸ˆ', 'íˆ¬ì', 'ì—°ê¸ˆ'],
            expense: ['ì‹ë¹„', 'êµí†µë¹„', 'ì£¼ê±°ë¹„', 'ì˜ë£Œë¹„', 'ì‡¼í•‘', 'ë¬¸í™”ìƒí™œ', 'ê¸°íƒ€ì§€ì¶œ']
        }));
        let budgetGoals = JSON.parse(localStorage.getItem('budgetGoals') || '{}');
        let settings = JSON.parse(localStorage.getItem('settings') || JSON.stringify({
            startDate: new Date().toISOString().split('T')[0],
            currency: 'KRW'
        }));
        let shareData = JSON.parse(localStorage.getItem('shareData') || '{}');
        let activeShares = JSON.parse(localStorage.getItem('activeShares') || '[]');
        let connectedShares = JSON.parse(localStorage.getItem('connectedShares') || '[]');
        let comments = JSON.parse(localStorage.getItem('comments') || '{}');
        let currentModalDate = null;

        // í†µí™” í¬ë§· í•¨ìˆ˜
        function formatCurrencyDisplay(amount, currency = 'KRW') {
            const formattedAmount = amount.toLocaleString();
            if (currency === 'USD') {
                return `$${formattedAmount}`;
            } else {
                return `${formattedAmount}ì›`;
            }
        }

        // ê¸ˆì•¡ ì…ë ¥ í¬ë§·íŒ… í•¨ìˆ˜
        function formatAmountInput(input) {
            let value = input.value.replace(/[^\d]/g, '');
            if (value) {
                value = parseInt(value).toLocaleString();
            }
            input.value = value;
        }

        // ìì‚° ì¹´í…Œê³ ë¦¬
        const assetCategories = {
            asset: ['í˜„ê¸ˆ', 'ì˜ˆê¸ˆ', 'ì ê¸ˆ', 'ì£¼ì‹', 'ë¶€ë™ì‚°', 'ê¸°íƒ€ìì‚°'],
            liability: ['ì‹ ìš©ì¹´ë“œ', 'ëŒ€ì¶œ', 'ê¸°íƒ€ë¶€ì±„']
        };

        // í˜ì´ì§€ ì „í™˜
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            document.getElementById(pageId).classList.add('active');
            event.target.classList.add('active');
            
            // í˜ì´ì§€ë³„ ì´ˆê¸°í™”
            if (pageId === 'monthly') {
                initMonthlyView();
            } else if (pageId === 'yearly') {
                initYearlyView();
            } else if (pageId === 'assets') {
                updateAssetsView();
            } else if (pageId === 'settings') {
                initSettingsView();
            } else if (pageId === 'entry') {
                updateRecentEntries();
            } else if (pageId === 'share') {
                initShareView();
            }
        }

        // ì´ˆê¸°í™”
        function init() {
            // ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
            document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];
            
            // í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('entryForm').addEventListener('submit', addEntry);
            document.getElementById('assetEntryForm').addEventListener('submit', addAsset);
            
            // ì´ˆê¸° ë·° ì—…ë°ì´íŠ¸
            updateRecentEntries();
            initMonthlyView();
            initYearlyView();
            updateAssetsView();
            initSettingsView();
        }

        // ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸
        function updateCategories() {
            const type = document.getElementById('entryType').value;
            const categorySelect = document.getElementById('entryCategory');
            const memoTextarea = document.getElementById('entryMemo');
            const receiptSection = document.getElementById('receiptSection');
            
            categorySelect.innerHTML = '<option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>';
            
            if (type && categories[type]) {
                categories[type].forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
            }
            
            // ìœ í˜•ë³„ ë©”ëª¨ ì˜ˆì‹œ ë³€ê²½
            const memoPlaceholders = {
                income: 'ì˜ˆ: íšŒì‚¬ ê¸‰ì—¬, í”„ë¦¬ëœì„œ ìˆ˜ì…, íˆ¬ì ìˆ˜ìµ ë“±\nìƒì„¸í•œ ìˆ˜ì… ë‚´ìš©ì„ ê¸°ë¡í•´ë³´ì„¸ìš”.',
                savings: 'ì˜ˆ: ì‹ í•œì€í–‰ ì ê¸ˆ ë‚©ì…, ì£¼ì‹ íˆ¬ì, ì—°ê¸ˆ ì €ì¶• ë“±\nì €ì¶• ëª©ì ê³¼ ê³„íšì„ ê¸°ë¡í•´ë³´ì„¸ìš”.',
                expense: 'ì˜ˆ: ì´ë§ˆíŠ¸ì—ì„œ ì¥ë³´ê¸° - ì‚¬ê³¼ 3ê°œ, ìš°ìœ  2íŒ©, ê³„ë€ 1íŒ\nì¹´í˜ì—ì„œ ì•„ë©”ë¦¬ì¹´ë…¸ 2ì”, ìƒŒë“œìœ„ì¹˜ 1ê°œ\nìƒì„¸í•œ ì§€ì¶œ ë‚´ìš©ì„ ê¸°ë¡í•´ë³´ì„¸ìš”.'
            };
            
            memoTextarea.placeholder = memoPlaceholders[type] || 'ìœ í˜•ì„ ì„ íƒí•˜ë©´ ì˜ˆì‹œê°€ í‘œì‹œë©ë‹ˆë‹¤';
            
            // ì˜ìˆ˜ì¦ ì •ë³´ëŠ” ì§€ì¶œì¼ ë•Œë§Œ í‘œì‹œ
            if (type === 'expense') {
                receiptSection.style.display = 'block';
            } else {
                receiptSection.style.display = 'none';
                // ì˜ìˆ˜ì¦ ì •ë³´ ì´ˆê¸°í™”
                document.getElementById('receiptStore').value = '';
                document.getElementById('receiptPayment').value = '';
                document.getElementById('receiptItems').value = '';
            }
            
            // ë©”ëª¨ì™€ ê¸°ë¶„ ì„¹ì…˜ì€ ìœ í˜•ì´ ì„ íƒë˜ë©´ í‘œì‹œ
            const memoMoodSection = document.getElementById('memoMoodSection');
            if (type) {
                memoMoodSection.style.display = 'block';
            } else {
                memoMoodSection.style.display = 'none';
                // ê¸°ë¶„ ì„ íƒ ì´ˆê¸°í™”
                document.getElementById('entryMemo').value = '';
                document.getElementById('entryMood').value = '';
                document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('selected'));
            }
        }

        // ë‚´ì—­ ì¶”ê°€
        function addEntry(e) {
            e.preventDefault();
            
            const amountValue = document.getElementById('entryAmount').value.replace(/,/g, '');
            
            const entry = {
                id: Date.now(),
                date: document.getElementById('entryDate').value,
                type: document.getElementById('entryType').value,
                category: document.getElementById('entryCategory').value,
                amount: parseInt(amountValue),
                currency: document.getElementById('entryCurrency').value,
                memo: document.getElementById('entryMemo').value,
                mood: document.getElementById('entryMood').value,
                receipt: {
                    store: document.getElementById('receiptStore').value,
                    payment: document.getElementById('receiptPayment').value,
                    items: document.getElementById('receiptItems').value
                }
            };
            
            entries.unshift(entry);
            localStorage.setItem('entries', JSON.stringify(entries));
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('entryForm').reset();
            document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('entryCategory').innerHTML = '<option value="">ìœ í˜•ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>';
            document.getElementById('entryMood').value = '';
            document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('memoMoodSection').style.display = 'none';
            document.getElementById('receiptSection').style.display = 'none';
            
            updateRecentEntries();
            
            // ì„±ê³µ ë©”ì‹œì§€
            alert('ë‚´ì—­ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ’°');
        }

        // ìµœê·¼ ë‚´ì—­ ì—…ë°ì´íŠ¸
        function updateRecentEntries() {
            const container = document.getElementById('recentEntries');
            const recentEntries = entries.slice(0, 10);
            
            if (recentEntries.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">ì•„ì§ ì…ë ¥ëœ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            container.innerHTML = recentEntries.map(entry => {
                const typeColors = {
                    income: 'text-green-600 bg-green-50',
                    savings: 'text-blue-600 bg-blue-50',
                    expense: 'text-red-600 bg-red-50'
                };
                
                const typeNames = {
                    income: 'ìˆ˜ì…',
                    savings: 'ì €ì¶•',
                    expense: 'ì§€ì¶œ'
                };

                // ì˜ìˆ˜ì¦ ì •ë³´ í‘œì‹œ
                let receiptInfo = '';
                if (entry.receipt && (entry.receipt.store || entry.receipt.payment || entry.receipt.items)) {
                    receiptInfo = '<div class="mt-2 p-2 bg-gray-50 rounded text-xs">';
                    if (entry.receipt.store) receiptInfo += `<div><strong>ğŸª ${entry.receipt.store}</strong></div>`;
                    if (entry.receipt.payment) receiptInfo += `<div>ğŸ’³ ${entry.receipt.payment}</div>`;
                    if (entry.receipt.items) {
                        receiptInfo += '<div class="mt-1"><strong>ğŸ›’ êµ¬ë§¤í’ˆëª©:</strong></div>';
                        receiptInfo += `<div class="whitespace-pre-line text-gray-600">${entry.receipt.items}</div>`;
                    }
                    receiptInfo += '</div>';
                }
                
                return `
                    <div class="border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                        <div class="flex items-center justify-between p-3">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${typeColors[entry.type]}">
                                        ${typeNames[entry.type]}
                                    </span>
                                    <span class="text-sm font-medium text-gray-800">${entry.category}</span>
                                    ${entry.mood ? `<span class="text-lg">${entry.mood}</span>` : ''}
                                </div>
                                <p class="text-sm text-gray-600 mt-1">${entry.memo || 'ë©”ëª¨ ì—†ìŒ'}</p>
                                ${receiptInfo}
                            </div>
                            <div class="text-right">
                                <p class="font-semibold ${entry.type === 'income' ? 'text-green-600' : entry.type === 'savings' ? 'text-blue-600' : 'text-red-600'}">
                                    ${formatCurrencyDisplay(entry.amount, entry.currency || 'KRW')}
                                </p>
                                <p class="text-xs text-gray-500">${entry.date}</p>
                            </div>
                            <button onclick="deleteEntry(${entry.id})" class="ml-3 text-red-500 hover:text-red-700 transition-colors">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ë‚´ì—­ ì‚­ì œ
        function deleteEntry(id) {
            if (confirm('ì´ ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                entries = entries.filter(entry => entry.id !== id);
                localStorage.setItem('entries', JSON.stringify(entries));
                updateRecentEntries();
            }
        }

        // ì›”ë³„ ë·° ì´ˆê¸°í™”
        function initMonthlyView() {
            const yearSelect = document.getElementById('monthlyYear');
            const monthSelect = document.getElementById('monthlyMonth');
            
            // ì—°ë„ ì˜µì…˜ ìƒì„±
            const currentYear = new Date().getFullYear();
            const years = [...new Set(entries.map(entry => new Date(entry.date).getFullYear()))];
            if (years.length === 0) years.push(currentYear);
            
            yearSelect.innerHTML = years.sort((a, b) => b - a).map(year => 
                `<option value="${year}" ${year === currentYear ? 'selected' : ''}>${year}ë…„</option>`
            ).join('');
            
            // í˜„ì¬ ì›” ì„ íƒ
            monthSelect.value = new Date().getMonth() + 1;
            
            updateMonthlyView();
        }

        // ì›”ë³„ ë·° ì—…ë°ì´íŠ¸
        function updateMonthlyView() {
            const year = parseInt(document.getElementById('monthlyYear').value);
            const month = parseInt(document.getElementById('monthlyMonth').value);
            
            const monthlyEntries = entries.filter(entry => {
                const entryDate = new Date(entry.date);
                return entryDate.getFullYear() === year && entryDate.getMonth() + 1 === month;
            });
            
            // ì „ì›” ë°ì´í„° ê³„ì‚°
            let prevYear = year;
            let prevMonth = month - 1;
            if (prevMonth === 0) {
                prevMonth = 12;
                prevYear = year - 1;
            }
            
            const prevMonthEntries = entries.filter(entry => {
                const entryDate = new Date(entry.date);
                return entryDate.getFullYear() === prevYear && entryDate.getMonth() + 1 === prevMonth;
            });
            
            // ì›”ë³„ ìš”ì•½ ê³„ì‚°
            const summary = {
                income: monthlyEntries.filter(e => e.type === 'income').reduce((sum, e) => sum + e.amount, 0),
                savings: monthlyEntries.filter(e => e.type === 'savings').reduce((sum, e) => sum + e.amount, 0),
                expense: monthlyEntries.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.amount, 0)
            };
            
            const prevSummary = {
                income: prevMonthEntries.filter(e => e.type === 'income').reduce((sum, e) => sum + e.amount, 0),
                savings: prevMonthEntries.filter(e => e.type === 'savings').reduce((sum, e) => sum + e.amount, 0),
                expense: prevMonthEntries.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.amount, 0)
            };
            
            summary.net = summary.income - summary.savings - summary.expense;
            prevSummary.net = prevSummary.income - prevSummary.savings - prevSummary.expense;
            
            // ìš”ì•½ í‘œì‹œ (ê¸°ë³¸ í†µí™”ë¡œ í‘œì‹œ)
            document.getElementById('monthlyIncome').textContent = formatCurrencyDisplay(summary.income, settings.currency);
            document.getElementById('monthlySavings').textContent = formatCurrencyDisplay(summary.savings, settings.currency);
            document.getElementById('monthlyExpense').textContent = formatCurrencyDisplay(summary.expense, settings.currency);
            document.getElementById('monthlyNet').textContent = formatCurrencyDisplay(summary.net, settings.currency);
            
            // ì „ì›” ëŒ€ë¹„ ë³€í™” í‘œì‹œ
            updateMonthlyChanges(summary, prevSummary, prevYear, prevMonth);
            
            // ì˜ˆì‚° ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            updateBudgetProgress(year, month, summary);
            
            // ì§€ì¶œ ë¶„ì„ ì—…ë°ì´íŠ¸
            updateExpenseAnalysis(monthlyEntries);
            
            // ì¹´í…Œê³ ë¦¬ë³„ ìƒì„¸ ì—…ë°ì´íŠ¸
            updateMonthlyCategoryDetails(monthlyEntries);
            
            // ë‹¬ë ¥ ì—…ë°ì´íŠ¸
            updateMonthlyCalendar(year, month, monthlyEntries);
        }

        // ì „ì›” ëŒ€ë¹„ ë³€í™” í‘œì‹œ
        function updateMonthlyChanges(summary, prevSummary, prevYear, prevMonth) {
            const types = ['income', 'savings', 'expense', 'net'];
            const typeNames = {
                income: 'ìˆ˜ì…',
                savings: 'ì €ì¶•', 
                expense: 'ì§€ì¶œ',
                net: 'ìˆœìì‚°'
            };
            
            types.forEach(type => {
                const current = summary[type];
                const previous = prevSummary[type];
                const change = current - previous;
                const changeElement = document.getElementById(`${type}Change`);
                
                if (previous === 0 && current === 0) {
                    changeElement.innerHTML = '<span class="text-gray-500">ì „ì›” ë°ì´í„° ì—†ìŒ</span>';
                    return;
                }
                
                if (previous === 0) {
                    changeElement.innerHTML = `<span class="text-blue-600">ğŸ“ˆ ${prevYear}ë…„ ${prevMonth}ì›” ëŒ€ë¹„ ì‹ ê·œ</span>`;
                    return;
                }
                
                const percentage = ((change / previous) * 100).toFixed(1);
                const isPositive = change > 0;
                const isNegative = change < 0;
                
                let icon = 'â–';
                let colorClass = 'text-gray-500';
                let message = '';
                
                if (type === 'expense') {
                    // ì§€ì¶œì˜ ê²½ìš° ê°ì†Œê°€ ì¢‹ìŒ
                    if (isNegative) {
                        icon = 'ğŸ’°';
                        colorClass = 'text-green-600';
                        message = `${Math.abs(change).toLocaleString()}ì› ì ˆì•½! (${Math.abs(percentage)}% ê°ì†Œ)`;
                    } else if (isPositive) {
                        icon = 'ğŸ“ˆ';
                        colorClass = 'text-red-600';
                        message = `${change.toLocaleString()}ì› ì¦ê°€ (${percentage}% ì¦ê°€)`;
                    } else {
                        message = 'ì „ì›”ê³¼ ë™ì¼';
                    }
                } else {
                    // ìˆ˜ì…, ì €ì¶•, ìˆœìì‚°ì˜ ê²½ìš° ì¦ê°€ê°€ ì¢‹ìŒ
                    if (isPositive) {
                        icon = 'ğŸ“ˆ';
                        colorClass = 'text-green-600';
                        message = `${change.toLocaleString()}ì› ì¦ê°€ (${percentage}% ì¦ê°€)`;
                    } else if (isNegative) {
                        icon = 'ğŸ“‰';
                        colorClass = 'text-red-600';
                        message = `${Math.abs(change).toLocaleString()}ì› ê°ì†Œ (${Math.abs(percentage)}% ê°ì†Œ)`;
                    } else {
                        message = 'ì „ì›”ê³¼ ë™ì¼';
                    }
                }
                
                changeElement.innerHTML = `<span class="${colorClass}">${icon} ${prevYear}ë…„ ${prevMonth}ì›” ëŒ€ë¹„ ${message}</span>`;
            });
        }

        // ì˜ˆì‚° ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateBudgetProgress(year, month, summary) {
            const container = document.getElementById('budgetProgress');
            const monthKey = `${year}-${month.toString().padStart(2, '0')}`;
            
            if (!budgetGoals[monthKey] || Object.keys(budgetGoals[monthKey]).length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center">ì„¤ì •ëœ ì˜ˆì‚° ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤. ì„¤ì • í˜ì´ì§€ì—ì„œ ì˜ˆì‚°ì„ ì„¤ì •í•´ë³´ì„¸ìš”.</p>';
                return;
            }
            
            const goals = budgetGoals[monthKey];
            let html = '';
            
            Object.entries(goals).forEach(([type, goal]) => {
                const actual = summary[type] || 0;
                const percentage = goal > 0 ? Math.min((actual / goal) * 100, 100) : 0;
                const isOver = actual > goal;
                
                const typeNames = {
                    income: 'ìˆ˜ì…',
                    savings: 'ì €ì¶•',
                    expense: 'ì§€ì¶œ'
                };
                
                const colors = {
                    income: isOver ? 'bg-green-500' : 'bg-green-300',
                    savings: isOver ? 'bg-blue-500' : 'bg-blue-300',
                    expense: isOver ? 'bg-red-500' : 'bg-red-300'
                };
                
                html += `
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-sm font-medium">${typeNames[type]} ëª©í‘œ</span>
                            <span class="text-sm ${isOver ? 'text-red-600' : 'text-gray-600'}">
                                ${actual.toLocaleString()}ì› / ${goal.toLocaleString()}ì›
                            </span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="${colors[type]} h-2 rounded-full transition-all duration-300" style="width: ${percentage}%"></div>
                        </div>
                        <div class="text-xs text-gray-500">
                            ${percentage.toFixed(1)}% ë‹¬ì„± ${isOver ? '(ëª©í‘œ ì´ˆê³¼)' : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ì§€ì¶œ ë¶„ì„ ì—…ë°ì´íŠ¸
        function updateExpenseAnalysis(monthlyEntries) {
            const container = document.getElementById('expenseAnalysis');
            const expenseEntries = monthlyEntries.filter(e => e.type === 'expense');
            
            if (expenseEntries.length === 0) {
                container.innerHTML = '<p class="text-gray-500">ì´ë²ˆ ë‹¬ ì§€ì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ í•©ê³„ ê³„ì‚°
            const categoryTotals = {};
            expenseEntries.forEach(entry => {
                categoryTotals[entry.category] = (categoryTotals[entry.category] || 0) + entry.amount;
            });
            
            // ì •ë ¬ (ê¸ˆì•¡ ìˆœ)
            const sortedCategories = Object.entries(categoryTotals)
                .sort(([,a], [,b]) => b - a);
            
            const totalExpense = Object.values(categoryTotals).reduce((sum, amount) => sum + amount, 0);
            const topCategory = sortedCategories[0];
            const topCategoryPercentage = totalExpense > 0 ? (topCategory[1] / totalExpense * 100).toFixed(1) : 0;
            
            // ê°€ì¥ ë§ì´ ì§€ì¶œí•œ ì¹´í…Œê³ ë¦¬ì˜ ìƒì„¸ ë‚´ì—­
            const topCategoryEntries = expenseEntries
                .filter(e => e.category === topCategory[0])
                .sort((a, b) => b.amount - a.amount)
                .slice(0, 5);
            
            let html = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-3">
                        <h4 class="font-medium text-gray-800">ğŸ’¸ ê°€ì¥ ë§ì´ ì§€ì¶œí•œ ì¹´í…Œê³ ë¦¬</h4>
                        <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-lg font-semibold text-red-700">${topCategory[0]}</span>
                                <span class="text-lg font-bold text-red-700">${topCategory[1].toLocaleString()}ì›</span>
                            </div>
                            <div class="text-sm text-red-600">
                                ì „ì²´ ì§€ì¶œì˜ ${topCategoryPercentage}% (${sortedCategories.length}ê°œ ì¹´í…Œê³ ë¦¬ ì¤‘ 1ìœ„)
                            </div>
                            <div class="w-full bg-red-200 rounded-full h-2 mt-2">
                                <div class="bg-red-500 h-2 rounded-full" style="width: ${topCategoryPercentage}%"></div>
                            </div>
                        </div>
                        
                        <div class="space-y-2">
                            <h5 class="text-sm font-medium text-gray-700">ğŸ“Š ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ ìˆœìœ„</h5>
                            ${sortedCategories.slice(0, 5).map((category, index) => {
                                const percentage = totalExpense > 0 ? (category[1] / totalExpense * 100).toFixed(1) : 0;
                                const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', '4ï¸âƒ£', '5ï¸âƒ£'];
                                return `
                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                        <div class="flex items-center space-x-2">
                                            <span>${medals[index]}</span>
                                            <span class="text-sm">${category[0]}</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-sm font-medium">${category[1].toLocaleString()}ì›</div>
                                            <div class="text-xs text-gray-500">${percentage}%</div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <h4 class="font-medium text-gray-800">ğŸ” ${topCategory[0]} ìƒì„¸ ë‚´ì—­</h4>
                        <div class="space-y-2 max-h-64 overflow-y-auto">
                            ${topCategoryEntries.map(entry => {
                                let receiptInfo = '';
                                if (entry.receipt && entry.receipt.store) {
                                    receiptInfo = `<div class="text-xs text-gray-500">ğŸª ${entry.receipt.store}</div>`;
                                }
                                return `
                                    <div class="p-3 border border-gray-200 rounded-lg">
                                        <div class="flex justify-between items-start">
                                            <div class="flex-1">
                                                <div class="text-sm font-medium">${entry.amount.toLocaleString()}ì›</div>
                                                <div class="text-xs text-gray-600 mt-1">${entry.memo || 'ë©”ëª¨ ì—†ìŒ'}</div>
                                                ${receiptInfo}
                                            </div>
                                            <div class="text-xs text-gray-500">${entry.date}</div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        
                        <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <div class="text-sm text-blue-700">
                                ğŸ’¡ <strong>ì ˆì•½ íŒ:</strong> ${topCategory[0]} ì§€ì¶œì„ ì¤„ì´ë©´ ì›” ì˜ˆì‚°ì„ í¬ê²Œ ê°œì„ í•  ìˆ˜ ìˆì–´ìš”!
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // ì›”ë³„ ë‹¬ë ¥ ì—…ë°ì´íŠ¸
        function updateMonthlyCalendar(year, month, monthlyEntries) {
            const container = document.getElementById('monthlyCalendar');
            
            // ë‹¬ë ¥ í—¤ë” ìƒì„±
            const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            let calendarHTML = '';
            
            // ìš”ì¼ í—¤ë”
            weekdays.forEach(day => {
                calendarHTML += `<div class="calendar-header">${day}</div>`;
            });
            
            // í•´ë‹¹ ì›”ì˜ ì²« ë²ˆì§¸ ë‚ ê³¼ ë§ˆì§€ë§‰ ë‚ 
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            // ì´ì „ ë‹¬ì˜ ë§ˆì§€ë§‰ ë‚ ë“¤
            const prevMonth = month === 1 ? 12 : month - 1;
            const prevYear = month === 1 ? year - 1 : year;
            const prevMonthLastDay = new Date(prevYear, prevMonth, 0).getDate();
            
            // ì´ì „ ë‹¬ ë‚ ì§œë“¤
            for (let i = startingDayOfWeek - 1; i >= 0; i--) {
                const day = prevMonthLastDay - i;
                calendarHTML += `<div class="calendar-day other-month">
                    <div class="calendar-day-number">${day}</div>
                </div>`;
            }
            
            // í˜„ì¬ ë‹¬ ë‚ ì§œë“¤
            const today = new Date();
            const isCurrentMonth = today.getFullYear() === year && today.getMonth() + 1 === month;
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                const dayEntries = monthlyEntries.filter(entry => entry.date === dateStr);
                
                // ì˜¤ëŠ˜ ë‚ ì§œ í™•ì¸
                const isToday = isCurrentMonth && today.getDate() === day;
                
                // ë¬´ì§€ì¶œ ë‚ ì§œ í™•ì¸ (ì§€ì¶œì´ ì—†ëŠ” ë‚  - ë‚´ì—­ì´ ì—†ì–´ë„ ë¬´ì§€ì¶œë¡œ í‘œì‹œ)
                const hasExpense = dayEntries.some(entry => entry.type === 'expense');
                const isNoSpendDay = !hasExpense;
                
                // í´ë˜ìŠ¤ ì„¤ì •
                let dayClasses = 'calendar-day';
                if (isToday) dayClasses += ' today';
                if (isNoSpendDay) dayClasses += ' no-spend';
                
                // ë‚´ì—­ë³„ ì¸ë””ì¼€ì´í„° ìƒì„±
                let indicators = '';
                const entryTypes = [...new Set(dayEntries.map(entry => entry.type))];
                entryTypes.forEach(type => {
                    indicators += `<div class="calendar-indicator ${type}"></div>`;
                });
                
                // ë¬´ì§€ì¶œ ì•„ì´ì½˜
                let noSpendIcon = '';
                if (isNoSpendDay) {
                    noSpendIcon = '<div class="no-spend-icon">ğŸ‰</div>';
                }
                
                calendarHTML += `
                    <div class="${dayClasses}" onclick="openDayModal('${dateStr}')">
                        <div class="calendar-day-number">${day}</div>
                        <div class="calendar-indicators">${indicators}</div>
                        ${noSpendIcon}
                    </div>
                `;
            }
            
            // ë‹¤ìŒ ë‹¬ ë‚ ì§œë“¤ (ë‹¬ë ¥ì„ 6ì£¼ë¡œ ë§ì¶”ê¸° ìœ„í•´)
            const totalCells = 42; // 6ì£¼ Ã— 7ì¼
            const currentCells = startingDayOfWeek + daysInMonth;
            const remainingCells = totalCells - currentCells;
            
            for (let day = 1; day <= remainingCells; day++) {
                calendarHTML += `<div class="calendar-day other-month">
                    <div class="calendar-day-number">${day}</div>
                </div>`;
            }
            
            container.innerHTML = calendarHTML;
        }

        // ì›”ë³„ ì¹´í…Œê³ ë¦¬ ìƒì„¸ ì—…ë°ì´íŠ¸
        function updateMonthlyCategoryDetails(monthlyEntries) {
            const types = ['income', 'savings', 'expense'];
            
            types.forEach(type => {
                const container = document.getElementById(`monthly${type.charAt(0).toUpperCase() + type.slice(1)}Details`);
                const typeEntries = monthlyEntries.filter(e => e.type === type);
                
                if (typeEntries.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-sm">ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }
                
                // ì¹´í…Œê³ ë¦¬ë³„ í•©ê³„ ê³„ì‚°
                const categoryTotals = {};
                typeEntries.forEach(entry => {
                    categoryTotals[entry.category] = (categoryTotals[entry.category] || 0) + entry.amount;
                });
                
                // ì •ë ¬ (ê¸ˆì•¡ ìˆœ)
                const sortedCategories = Object.entries(categoryTotals)
                    .sort(([,a], [,b]) => b - a);
                
                container.innerHTML = sortedCategories.map(([category, amount]) => `
                    <div class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                        <span class="text-sm text-gray-700">${category}</span>
                        <span class="text-sm font-medium">${amount.toLocaleString()}ì›</span>
                    </div>
                `).join('');
            });
        }

        // ì—°ë„ë³„ ë·° ì´ˆê¸°í™”
        function initYearlyView() {
            const yearSelect = document.getElementById('yearlyYear');
            
            // ì—°ë„ ì˜µì…˜ ìƒì„±
            const currentYear = new Date().getFullYear();
            const years = [...new Set(entries.map(entry => new Date(entry.date).getFullYear()))];
            if (years.length === 0) years.push(currentYear);
            
            yearSelect.innerHTML = years.sort((a, b) => b - a).map(year => 
                `<option value="${year}" ${year === currentYear ? 'selected' : ''}>${year}ë…„</option>`
            ).join('');
            
            updateYearlyView();
        }

        // ì—°ë„ë³„ ë·° ì—…ë°ì´íŠ¸
        function updateYearlyView() {
            const year = parseInt(document.getElementById('yearlyYear').value);
            
            const yearlyEntries = entries.filter(entry => {
                return new Date(entry.date).getFullYear() === year;
            });
            
            // ì—°ë„ë³„ ìš”ì•½ ê³„ì‚°
            const summary = {
                income: yearlyEntries.filter(e => e.type === 'income').reduce((sum, e) => sum + e.amount, 0),
                savings: yearlyEntries.filter(e => e.type === 'savings').reduce((sum, e) => sum + e.amount, 0),
                expense: yearlyEntries.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.amount, 0)
            };
            
            summary.net = summary.income - summary.savings - summary.expense;
            
            // ìš”ì•½ í‘œì‹œ (ê¸°ë³¸ í†µí™”ë¡œ í‘œì‹œ)
            document.getElementById('yearlyIncome').textContent = formatCurrencyDisplay(summary.income, settings.currency);
            document.getElementById('yearlySavings').textContent = formatCurrencyDisplay(summary.savings, settings.currency);
            document.getElementById('yearlyExpense').textContent = formatCurrencyDisplay(summary.expense, settings.currency);
            document.getElementById('yearlyNet').textContent = formatCurrencyDisplay(summary.net, settings.currency);
            
            // ì›”ë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateYearlyChart(year, yearlyEntries);
            
            // ì›”ë³„ ì§€ì¶œ ë¶„ì„ ì—…ë°ì´íŠ¸
            updateMonthlyExpenseBreakdown(year, yearlyEntries);
            
            // ì¹´í…Œê³ ë¦¬ë³„ ì—°ê°„ ë¶„ì„ ì—…ë°ì´íŠ¸
            updateYearlyCategoryAnalysis(yearlyEntries);
        }

        // ì—°ë„ë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ê°„ë‹¨í•œ ë°” ì°¨íŠ¸)
        function updateYearlyChart(year, yearlyEntries) {
            const canvas = document.getElementById('yearlyChart');
            const ctx = canvas.getContext('2d');
            
            // ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // ì›”ë³„ ë°ì´í„° ê³„ì‚°
            const monthlyData = Array.from({length: 12}, (_, i) => {
                const month = i + 1;
                const monthEntries = yearlyEntries.filter(entry => {
                    return new Date(entry.date).getMonth() + 1 === month;
                });
                
                return {
                    month: month,
                    income: monthEntries.filter(e => e.type === 'income').reduce((sum, e) => sum + e.amount, 0),
                    savings: monthEntries.filter(e => e.type === 'savings').reduce((sum, e) => sum + e.amount, 0),
                    expense: monthEntries.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.amount, 0)
                };
            });
            
            // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            const maxValue = Math.max(...monthlyData.flatMap(d => [d.income, d.savings, d.expense]));
            if (maxValue === 0) {
                ctx.fillStyle = '#6b7280';
                ctx.font = '16px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            const barWidth = canvas.width / 12;
            const chartHeight = canvas.height - 60;
            
            monthlyData.forEach((data, index) => {
                const x = index * barWidth;
                const incomeHeight = (data.income / maxValue) * chartHeight;
                const savingsHeight = (data.savings / maxValue) * chartHeight;
                const expenseHeight = (data.expense / maxValue) * chartHeight;
                
                // ìˆ˜ì… (ë…¹ìƒ‰)
                ctx.fillStyle = '#10b981';
                ctx.fillRect(x + 5, canvas.height - 40 - incomeHeight, barWidth / 3 - 2, incomeHeight);
                
                // ì €ì¶• (íŒŒë€ìƒ‰)
                ctx.fillStyle = '#3b82f6';
                ctx.fillRect(x + barWidth / 3 + 3, canvas.height - 40 - savingsHeight, barWidth / 3 - 2, savingsHeight);
                
                // ì§€ì¶œ (ë¹¨ê°„ìƒ‰)
                ctx.fillStyle = '#ef4444';
                ctx.fillRect(x + (barWidth / 3) * 2 + 1, canvas.height - 40 - expenseHeight, barWidth / 3 - 2, expenseHeight);
                
                // ì›” ë¼ë²¨
                ctx.fillStyle = '#374151';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`${data.month}ì›”`, x + barWidth / 2, canvas.height - 10);
            });
            
            // ë²”ë¡€
            ctx.fillStyle = '#10b981';
            ctx.fillRect(10, 10, 15, 15);
            ctx.fillStyle = '#374151';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('ìˆ˜ì…', 30, 22);
            
            ctx.fillStyle = '#3b82f6';
            ctx.fillRect(80, 10, 15, 15);
            ctx.fillText('ì €ì¶•', 100, 22);
            
            ctx.fillStyle = '#ef4444';
            ctx.fillRect(150, 10, 15, 15);
            ctx.fillText('ì§€ì¶œ', 170, 22);
        }

        // ì›”ë³„ ì§€ì¶œ ë¶„ì„ ì—…ë°ì´íŠ¸
        function updateMonthlyExpenseBreakdown(year, yearlyEntries) {
            const container = document.getElementById('monthlyExpenseBreakdown');
            
            // ì›”ë³„ ì§€ì¶œ ë°ì´í„° ê³„ì‚°
            const monthlyData = Array.from({length: 12}, (_, i) => {
                const month = i + 1;
                const monthEntries = yearlyEntries.filter(entry => {
                    const entryDate = new Date(entry.date);
                    return entryDate.getMonth() + 1 === month && entry.type === 'expense';
                });
                
                // ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ ê³„ì‚°
                const categoryTotals = {};
                monthEntries.forEach(entry => {
                    categoryTotals[entry.category] = (categoryTotals[entry.category] || 0) + entry.amount;
                });
                
                const totalExpense = Object.values(categoryTotals).reduce((sum, amount) => sum + amount, 0);
                const topCategory = Object.entries(categoryTotals).sort(([,a], [,b]) => b - a)[0];
                
                return {
                    month: month,
                    monthName: `${month}ì›”`,
                    totalExpense: totalExpense,
                    categoryTotals: categoryTotals,
                    topCategory: topCategory ? {
                        name: topCategory[0],
                        amount: topCategory[1],
                        percentage: totalExpense > 0 ? (topCategory[1] / totalExpense * 100).toFixed(1) : 0
                    } : null,
                    entryCount: monthEntries.length
                };
            }).filter(data => data.totalExpense > 0);
            
            if (monthlyData.length === 0) {
                container.innerHTML = '<p class="text-gray-500">ì´ ì—°ë„ì— ì§€ì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // ê°€ì¥ ë§ì´ ì§€ì¶œí•œ ì›” ì°¾ê¸°
            const maxExpenseMonth = monthlyData.reduce((max, current) => 
                current.totalExpense > max.totalExpense ? current : max
            );
            
            // ì—°ê°„ ì´ ì§€ì¶œ
            const yearlyTotalExpense = monthlyData.reduce((sum, data) => sum + data.totalExpense, 0);
            
            let html = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                        <h4 class="font-medium text-red-700 mb-2">ğŸ’¸ ê°€ì¥ ë§ì´ ì§€ì¶œí•œ ë‹¬</h4>
                        <div class="text-2xl font-bold text-red-700">${maxExpenseMonth.monthName}</div>
                        <div class="text-lg text-red-600">${maxExpenseMonth.totalExpense.toLocaleString()}ì›</div>
                        <div class="text-sm text-red-500 mt-1">
                            ì—°ê°„ ì§€ì¶œì˜ ${(maxExpenseMonth.totalExpense / yearlyTotalExpense * 100).toFixed(1)}%
                        </div>
                        ${maxExpenseMonth.topCategory ? `
                            <div class="text-xs text-red-600 mt-2">
                                ì£¼ìš” ì§€ì¶œ: ${maxExpenseMonth.topCategory.name} (${maxExpenseMonth.topCategory.percentage}%)
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h4 class="font-medium text-blue-700 mb-2">ğŸ“Š ì›”í‰ê·  ì§€ì¶œ</h4>
                        <div class="text-2xl font-bold text-blue-700">${Math.round(yearlyTotalExpense / monthlyData.length).toLocaleString()}ì›</div>
                        <div class="text-sm text-blue-600 mt-1">
                            ì´ ${monthlyData.length}ê°œì›” ë°ì´í„° ê¸°ì¤€
                        </div>
                        <div class="text-xs text-blue-500 mt-2">
                            ìµœê³ : ${maxExpenseMonth.totalExpense.toLocaleString()}ì› | 
                            ìµœì €: ${Math.min(...monthlyData.map(d => d.totalExpense)).toLocaleString()}ì›
                        </div>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <h4 class="font-medium text-gray-800">ğŸ“… ì›”ë³„ ì§€ì¶œ ìƒì„¸</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            `;
            
            monthlyData.forEach(data => {
                const isMaxMonth = data.month === maxExpenseMonth.month;
                const monthPercentage = (data.totalExpense / yearlyTotalExpense * 100).toFixed(1);
                
                html += `
                    <div class="p-4 border rounded-lg ${isMaxMonth ? 'border-red-300 bg-red-50' : 'border-gray-200 bg-white'} hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between mb-2">
                            <span class="font-medium ${isMaxMonth ? 'text-red-700' : 'text-gray-800'}">${data.monthName}</span>
                            ${isMaxMonth ? '<span class="text-red-500 text-sm">ğŸ‘‘ ìµœê³ </span>' : ''}
                        </div>
                        <div class="text-lg font-semibold ${isMaxMonth ? 'text-red-600' : 'text-gray-700'}">
                            ${data.totalExpense.toLocaleString()}ì›
                        </div>
                        <div class="text-xs text-gray-500 mb-2">
                            ì—°ê°„ ë¹„ì¤‘: ${monthPercentage}% | ${data.entryCount}ê±´
                        </div>
                        
                        ${data.topCategory ? `
                            <div class="space-y-1">
                                <div class="text-xs text-gray-600">ì£¼ìš” ì§€ì¶œ ì¹´í…Œê³ ë¦¬:</div>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs font-medium">${data.topCategory.name}</span>
                                    <span class="text-xs">${data.topCategory.percentage}%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-1">
                                    <div class="bg-red-400 h-1 rounded-full" style="width: ${data.topCategory.percentage}%"></div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
                
                <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <div class="text-sm text-yellow-700">
                        ğŸ’¡ <strong>ë¶„ì„ ì¸ì‚¬ì´íŠ¸:</strong> 
                        ${maxExpenseMonth.monthName}ì— ê°€ì¥ ë§ì€ ì§€ì¶œì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤. 
                        ${maxExpenseMonth.topCategory ? `ì£¼ë¡œ ${maxExpenseMonth.topCategory.name} í•­ëª©ì—ì„œ ì§€ì¶œì´ ë§ì•˜ìœ¼ë‹ˆ, í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ì§€ì¶œ íŒ¨í„´ì„ ì ê²€í•´ë³´ì„¸ìš”.` : ''}
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // ì—°ê°„ ì¹´í…Œê³ ë¦¬ ë¶„ì„ ì—…ë°ì´íŠ¸
        function updateYearlyCategoryAnalysis(yearlyEntries) {
            const types = ['income', 'savings', 'expense'];
            
            types.forEach(type => {
                const container = document.getElementById(`yearly${type.charAt(0).toUpperCase() + type.slice(1)}Analysis`);
                const typeEntries = yearlyEntries.filter(e => e.type === type);
                
                if (typeEntries.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-sm">ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }
                
                // ì¹´í…Œê³ ë¦¬ë³„ í•©ê³„ ê³„ì‚°
                const categoryTotals = {};
                typeEntries.forEach(entry => {
                    categoryTotals[entry.category] = (categoryTotals[entry.category] || 0) + entry.amount;
                });
                
                const total = Object.values(categoryTotals).reduce((sum, amount) => sum + amount, 0);
                
                // ì •ë ¬ (ê¸ˆì•¡ ìˆœ)
                const sortedCategories = Object.entries(categoryTotals)
                    .sort(([,a], [,b]) => b - a);
                
                container.innerHTML = sortedCategories.map(([category, amount]) => {
                    const percentage = total > 0 ? (amount / total * 100).toFixed(1) : 0;
                    return `
                        <div class="space-y-1">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-700">${category}</span>
                                <span class="text-sm font-medium">${amount.toLocaleString()}ì›</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-${type === 'income' ? 'green' : type === 'savings' ? 'blue' : 'red'}-500 h-2 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                            <div class="text-xs text-gray-500">${percentage}%</div>
                        </div>
                    `;
                }).join('');
            });
        }

        // ìì‚° í¼ í‘œì‹œ/ìˆ¨ê¹€
        function showAssetForm() {
            document.getElementById('assetForm').style.display = 'block';
            updateAssetCategories();
        }

        function hideAssetForm() {
            document.getElementById('assetForm').style.display = 'none';
            document.getElementById('assetEntryForm').reset();
        }

        // ìì‚° ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸
        function updateAssetCategories() {
            const type = document.getElementById('assetType').value;
            const categorySelect = document.getElementById('assetCategory');
            
            categorySelect.innerHTML = '<option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>';
            
            if (type && assetCategories[type]) {
                assetCategories[type].forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
            }
        }

        // ìì‚° ì¶”ê°€
        function addAsset(e) {
            e.preventDefault();
            
            const amountValue = document.getElementById('assetAmount').value.replace(/,/g, '');
            
            const asset = {
                id: Date.now(),
                type: document.getElementById('assetType').value,
                category: document.getElementById('assetCategory').value,
                name: document.getElementById('assetName').value,
                amount: parseInt(amountValue),
                currency: document.getElementById('assetCurrency').value,
                memo: document.getElementById('assetMemo').value,
                date: new Date().toISOString().split('T')[0]
            };
            
            assets.push(asset);
            localStorage.setItem('assets', JSON.stringify(assets));
            
            hideAssetForm();
            updateAssetsView();
            
            alert('ìì‚°ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ’');
        }

        // ìì‚° ë·° ì—…ë°ì´íŠ¸
        function updateAssetsView() {
            const assetsList = assets.filter(a => a.type === 'asset');
            const liabilitiesList = assets.filter(a => a.type === 'liability');
            
            const totalAssets = assetsList.reduce((sum, a) => sum + a.amount, 0);
            const totalLiabilities = liabilitiesList.reduce((sum, a) => sum + a.amount, 0);
            const netWorth = totalAssets - totalLiabilities;
            
            // ìš”ì•½ ì—…ë°ì´íŠ¸ (ê¸°ë³¸ í†µí™”ë¡œ í‘œì‹œ)
            document.getElementById('totalAssets').textContent = formatCurrencyDisplay(totalAssets, settings.currency);
            document.getElementById('totalLiabilities').textContent = formatCurrencyDisplay(totalLiabilities, settings.currency);
            document.getElementById('netWorth').textContent = formatCurrencyDisplay(netWorth, settings.currency);
            
            // ìì‚° ëª©ë¡ ì—…ë°ì´íŠ¸
            updateAssetList('assetsList', assetsList, 'asset');
            updateAssetList('liabilitiesList', liabilitiesList, 'liability');
        }

        // ìì‚° ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateAssetList(containerId, list, type) {
            const container = document.getElementById(containerId);
            
            if (list.length === 0) {
                container.innerHTML = `<p class="text-gray-500 text-sm">${type === 'asset' ? 'ìì‚°' : 'ë¶€ì±„'}ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
                return;
            }
            
            container.innerHTML = list.map(item => `
                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                    <div class="flex-1">
                        <div class="flex items-center space-x-2">
                            <span class="px-2 py-1 text-xs font-medium rounded-full ${type === 'asset' ? 'text-green-600 bg-green-50' : 'text-red-600 bg-red-50'}">
                                ${item.category}
                            </span>
                        </div>
                        <p class="font-medium text-gray-800 mt-1">${item.name}</p>
                        <p class="text-sm text-gray-600">${item.memo || 'ë©”ëª¨ ì—†ìŒ'}</p>
                    </div>
                    <div class="text-right">
                        <p class="font-semibold ${type === 'asset' ? 'text-green-600' : 'text-red-600'}">
                            ${formatCurrencyDisplay(item.amount, item.currency || settings.currency)}
                        </p>
                        <p class="text-xs text-gray-500">${item.date}</p>
                    </div>
                    <button onclick="deleteAsset(${item.id})" class="ml-3 text-red-500 hover:text-red-700 transition-colors">
                        ğŸ—‘ï¸
                    </button>
                </div>
            `).join('');
        }

        // ìì‚° ì‚­ì œ
        function deleteAsset(id) {
            if (confirm('ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                assets = assets.filter(asset => asset.id !== id);
                localStorage.setItem('assets', JSON.stringify(assets));
                updateAssetsView();
            }
        }

        // ì„¤ì • ë·° ì´ˆê¸°í™”
        function initSettingsView() {
            // ê¸°ë³¸ ì„¤ì • ë¡œë“œ
            document.getElementById('startDate').value = settings.startDate;
            document.getElementById('currency').value = settings.currency;
            
            // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì—…ë°ì´íŠ¸
            updateCategoryLists();
            
            // ì˜ˆì‚° ì„¤ì • ì—…ë°ì´íŠ¸
            updateBudgetSettings();
        }

        // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateCategoryLists() {
            const types = ['income', 'savings', 'expense'];
            
            types.forEach(type => {
                const container = document.getElementById(`${type}Categories`);
                const typeCategories = categories[type] || [];
                
                container.innerHTML = typeCategories.map(category => `
                    <div class="flex items-center justify-between p-2 border border-gray-200 rounded-lg">
                        <span class="text-sm">${category}</span>
                        <button onclick="deleteCategory('${type}', '${category}')" class="text-red-500 hover:text-red-700 text-sm">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                `).join('');
            });
        }

        // ì¹´í…Œê³ ë¦¬ ì¶”ê°€
        function addCategory(type) {
            const input = document.getElementById(`new${type.charAt(0).toUpperCase() + type.slice(1)}Category`);
            const newCategory = input.value.trim();
            
            if (!newCategory) {
                alert('ì¹´í…Œê³ ë¦¬ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (categories[type].includes(newCategory)) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì¹´í…Œê³ ë¦¬ì…ë‹ˆë‹¤.');
                return;
            }
            
            categories[type].push(newCategory);
            localStorage.setItem('categories', JSON.stringify(categories));
            
            input.value = '';
            updateCategoryLists();
        }

        // ì¹´í…Œê³ ë¦¬ ì‚­ì œ
        function deleteCategory(type, category) {
            if (confirm(`'${category}' ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                categories[type] = categories[type].filter(c => c !== category);
                localStorage.setItem('categories', JSON.stringify(categories));
                updateCategoryLists();
            }
        }

        // ê¸°ë³¸ ì„¤ì • ì €ì¥
        function saveBasicSettings() {
            settings.startDate = document.getElementById('startDate').value;
            settings.currency = document.getElementById('currency').value;
            
            localStorage.setItem('settings', JSON.stringify(settings));
            alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! âœ…');
        }

        // ì˜ˆì‚° ì„¤ì • ì—…ë°ì´íŠ¸
        function updateBudgetSettings() {
            const container = document.getElementById('budgetSettings');
            const currentMonth = new Date().toISOString().slice(0, 7);
            
            if (!budgetGoals[currentMonth]) {
                container.innerHTML = '<p class="text-gray-500">ì„¤ì •ëœ ì˜ˆì‚° ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            const goals = budgetGoals[currentMonth];
            const typeNames = {
                income: 'ìˆ˜ì…',
                savings: 'ì €ì¶•',
                expense: 'ì§€ì¶œ'
            };
            
            container.innerHTML = Object.entries(goals).map(([type, amount]) => `
                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
                    <span class="text-sm font-medium">${typeNames[type]} ëª©í‘œ</span>
                    <div class="flex items-center space-x-2">
                        <span class="text-sm">${amount.toLocaleString()}ì›</span>
                        <button onclick="deleteBudgetGoal('${type}')" class="text-red-500 hover:text-red-700 text-sm">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ì˜ˆì‚° ëª©í‘œ ì¶”ê°€
        function addBudgetGoal() {
            const type = prompt('ì˜ˆì‚° ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”:\n1. income (ìˆ˜ì…)\n2. savings (ì €ì¶•)\n3. expense (ì§€ì¶œ)');
            if (!type || !['income', 'savings', 'expense'].includes(type)) {
                alert('ì˜¬ë°”ë¥¸ ìœ í˜•ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const amount = prompt('ëª©í‘œ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš” (ì›):');
            if (!amount || isNaN(amount) || parseInt(amount) <= 0) {
                alert('ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const currentMonth = new Date().toISOString().slice(0, 7);
            if (!budgetGoals[currentMonth]) {
                budgetGoals[currentMonth] = {};
            }
            
            budgetGoals[currentMonth][type] = parseInt(amount);
            localStorage.setItem('budgetGoals', JSON.stringify(budgetGoals));
            
            updateBudgetSettings();
            alert('ì˜ˆì‚° ëª©í‘œê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ¯');
        }

        // ì˜ˆì‚° ëª©í‘œ ì‚­ì œ
        function deleteBudgetGoal(type) {
            const currentMonth = new Date().toISOString().slice(0, 7);
            if (budgetGoals[currentMonth] && budgetGoals[currentMonth][type]) {
                delete budgetGoals[currentMonth][type];
                localStorage.setItem('budgetGoals', JSON.stringify(budgetGoals));
                updateBudgetSettings();
            }
        }

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportData() {
            const data = {
                entries,
                assets,
                categories,
                budgetGoals,
                settings,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ê°€ê³„ë¶€_ë°±ì—…_${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (confirm('ê¸°ì¡´ ë°ì´í„°ë¥¼ ëª¨ë‘ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            entries = data.entries || [];
                            assets = data.assets || [];
                            categories = data.categories || categories;
                            budgetGoals = data.budgetGoals || {};
                            settings = data.settings || settings;
                            
                            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                            localStorage.setItem('entries', JSON.stringify(entries));
                            localStorage.setItem('assets', JSON.stringify(assets));
                            localStorage.setItem('categories', JSON.stringify(categories));
                            localStorage.setItem('budgetGoals', JSON.stringify(budgetGoals));
                            localStorage.setItem('settings', JSON.stringify(settings));
                            
                            // ë·° ì—…ë°ì´íŠ¸
                            updateRecentEntries();
                            updateAssetsView();
                            initSettingsView();
                            
                            alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤! ğŸ“¥');
                        }
                    } catch (error) {
                        alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // ë°ì´í„° ì´ˆê¸°í™”
        function resetData() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                if (confirm('í•œ ë²ˆ ë” í™•ì¸í•©ë‹ˆë‹¤. ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.')) {
                    localStorage.clear();
                    location.reload();
                }
            }
        }

        // ìì‚° ìœ í˜• ë³€ê²½ ì‹œ ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸
        document.getElementById('assetType').addEventListener('change', updateAssetCategories);

        // ê³µìœ  ë·° ì´ˆê¸°í™”
        function initShareView() {
            updateShareStatus();
            updateActiveSharesList();
        }

        // ê³µìœ  ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateShareStatus() {
            const container = document.getElementById('shareStatus');
            
            if (activeShares.length === 0 && connectedShares.length === 0) {
                container.innerHTML = '<p class="text-gray-500">í˜„ì¬ í™œì„±í™”ëœ ê³µìœ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let html = '';
            
            if (activeShares.length > 0) {
                html += `<div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                    <p class="text-blue-700 font-medium">ğŸ“¤ ë‚´ê°€ ê³µìœ í•œ ê°€ê³„ë¶€: ${activeShares.length}ê°œ</p>
                </div>`;
            }
            
            if (connectedShares.length > 0) {
                html += `<div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                    <p class="text-green-700 font-medium">ğŸ“¥ ì—°ê²°ëœ ê°€ê³„ë¶€: ${connectedShares.length}ê°œ</p>
                </div>`;
            }
            
            container.innerHTML = html;
        }

        // ê³µìœ  ë§í¬ ìƒì„±
        function generateShareLink() {
            const shareType = document.getElementById('shareType').value;
            const shareEntries = document.getElementById('shareEntries').checked;
            const shareAssets = document.getElementById('shareAssets').checked;
            const shareBudgets = document.getElementById('shareBudgets').checked;
            const shareExpiry = document.getElementById('shareExpiry').value;
            
            if (!shareEntries && !shareAssets && !shareBudgets) {
                alert('ê³µìœ í•  ë°ì´í„°ë¥¼ ìµœì†Œ í•˜ë‚˜ëŠ” ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ê³µìœ  ì½”ë“œ ìƒì„± (6ìë¦¬ ëœë¤)
            const shareCode = Math.random().toString(36).substring(2, 8).toUpperCase();
            
            // ê³µìœ  ë°ì´í„° ì¤€ë¹„
            const sharedData = {
                entries: shareEntries ? entries : [],
                assets: shareAssets ? assets : [],
                budgetGoals: shareBudgets ? budgetGoals : {},
                categories: categories,
                settings: settings
            };
            
            // ë§Œë£Œì¼ ê³„ì‚°
            let expiryDate = null;
            if (shareExpiry) {
                expiryDate = new Date();
                expiryDate.setDate(expiryDate.getDate() + parseInt(shareExpiry));
            }
            
            // ê³µìœ  ì •ë³´ ì €ì¥
            const shareInfo = {
                id: Date.now(),
                code: shareCode,
                type: shareType,
                data: sharedData,
                createdAt: new Date().toISOString(),
                expiryDate: expiryDate ? expiryDate.toISOString() : null,
                accessCount: 0
            };
            
            activeShares.push(shareInfo);
            shareData[shareCode] = shareInfo;
            
            localStorage.setItem('activeShares', JSON.stringify(activeShares));
            localStorage.setItem('shareData', JSON.stringify(shareData));
            
            // ê³µìœ  ë§í¬ í‘œì‹œ
            const shareUrl = `${window.location.origin}${window.location.pathname}?share=${shareCode}`;
            document.getElementById('shareUrl').value = shareUrl;
            document.getElementById('shareCode').value = shareCode;
            document.getElementById('generatedLink').style.display = 'block';
            
            updateActiveSharesList();
            updateShareStatus();
            
            alert('ê³µìœ  ë§í¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰');
        }

        // ê³µìœ  ë§í¬ ë³µì‚¬
        function copyShareLink() {
            const shareUrl = document.getElementById('shareUrl');
            shareUrl.select();
            document.execCommand('copy');
            alert('ê³µìœ  ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹');
        }

        // ê³µìœ  ì½”ë“œ ë³µì‚¬
        function copyShareCode() {
            const shareCode = document.getElementById('shareCode');
            shareCode.select();
            document.execCommand('copy');
            alert('ê³µìœ  ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹');
        }

        // ê³µìœ  ì½”ë“œë¡œ ì—°ê²°
        function connectWithCode() {
            const inputCode = document.getElementById('inputShareCode').value.trim().toUpperCase();
            
            if (!inputCode) {
                alert('ê³µìœ  ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì‹œë®¬ë ˆì´ì…˜: ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ í™•ì¸í•´ì•¼ í•¨
            // ì—¬ê¸°ì„œëŠ” ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì˜ shareDataì—ì„œ í™•ì¸
            if (!shareData[inputCode]) {
                alert('ìœ íš¨í•˜ì§€ ì•Šì€ ê³µìœ  ì½”ë“œì…ë‹ˆë‹¤.');
                return;
            }
            
            const sharedInfo = shareData[inputCode];
            
            // ë§Œë£Œ í™•ì¸
            if (sharedInfo.expiryDate && new Date() > new Date(sharedInfo.expiryDate)) {
                alert('ë§Œë£Œëœ ê³µìœ  ì½”ë“œì…ë‹ˆë‹¤.');
                return;
            }
            
            // ì´ë¯¸ ì—°ê²°ëœ ì½”ë“œì¸ì§€ í™•ì¸
            if (connectedShares.some(share => share.code === inputCode)) {
                alert('ì´ë¯¸ ì—°ê²°ëœ ê°€ê³„ë¶€ì…ë‹ˆë‹¤.');
                return;
            }
            
            // ì—°ê²° ì •ë³´ ì €ì¥
            const connectionInfo = {
                code: inputCode,
                type: sharedInfo.type,
                connectedAt: new Date().toISOString(),
                ownerName: `ì‚¬ìš©ì_${inputCode.substring(0, 3)}`
            };
            
            connectedShares.push(connectionInfo);
            localStorage.setItem('connectedShares', JSON.stringify(connectedShares));
            
            // ì ‘ê·¼ íšŸìˆ˜ ì¦ê°€
            sharedInfo.accessCount++;
            shareData[inputCode] = sharedInfo;
            localStorage.setItem('shareData', JSON.stringify(shareData));
            
            document.getElementById('inputShareCode').value = '';
            updateShareStatus();
            updateActiveSharesList();
            
            alert(`ê°€ê³„ë¶€ì— ì„±ê³µì ìœ¼ë¡œ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤! (${sharedInfo.type === 'view' ? 'ë³´ê¸° ì „ìš©' : 'í¸ì§‘ ê°€ëŠ¥'}) ğŸ‰`);
        }

        // í™œì„± ê³µìœ  ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateActiveSharesList() {
            const container = document.getElementById('activeShares');
            
            if (activeShares.length === 0 && connectedShares.length === 0) {
                container.innerHTML = '<p class="text-gray-500">í™œì„±í™”ëœ ê³µìœ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let html = '';
            
            // ë‚´ê°€ ê³µìœ í•œ ëª©ë¡
            if (activeShares.length > 0) {
                html += '<h4 class="font-medium text-gray-800 mb-3">ğŸ“¤ ë‚´ê°€ ê³µìœ í•œ ê°€ê³„ë¶€</h4>';
                activeShares.forEach(share => {
                    const isExpired = share.expiryDate && new Date() > new Date(share.expiryDate);
                    html += `
                        <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg ${isExpired ? 'bg-gray-50' : 'bg-white'}">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${share.type === 'view' ? 'text-blue-600 bg-blue-50' : 'text-green-600 bg-green-50'}">
                                        ${share.type === 'view' ? 'ë³´ê¸° ì „ìš©' : 'í¸ì§‘ ê°€ëŠ¥'}
                                    </span>
                                    <span class="text-sm font-mono font-medium">${share.code}</span>
                                    ${isExpired ? '<span class="text-xs text-red-500">(ë§Œë£Œë¨)</span>' : ''}
                                </div>
                                <p class="text-xs text-gray-500 mt-1">
                                    ìƒì„±ì¼: ${new Date(share.createdAt).toLocaleDateString()} | 
                                    ì ‘ê·¼ íšŸìˆ˜: ${share.accessCount}íšŒ
                                    ${share.expiryDate ? ` | ë§Œë£Œì¼: ${new Date(share.expiryDate).toLocaleDateString()}` : ''}
                                </p>
                            </div>
                            <button onclick="deleteShare('${share.code}')" class="text-red-500 hover:text-red-700 transition-colors">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    `;
                });
            }
            
            // ì—°ê²°ëœ ê°€ê³„ë¶€ ëª©ë¡
            if (connectedShares.length > 0) {
                if (activeShares.length > 0) html += '<div class="my-4 border-t border-gray-200"></div>';
                html += '<h4 class="font-medium text-gray-800 mb-3">ğŸ“¥ ì—°ê²°ëœ ê°€ê³„ë¶€</h4>';
                connectedShares.forEach(connection => {
                    html += `
                        <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg bg-white">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${connection.type === 'view' ? 'text-blue-600 bg-blue-50' : 'text-green-600 bg-green-50'}">
                                        ${connection.type === 'view' ? 'ë³´ê¸° ì „ìš©' : 'í¸ì§‘ ê°€ëŠ¥'}
                                    </span>
                                    <span class="text-sm font-medium">${connection.ownerName}ì˜ ê°€ê³„ë¶€</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">
                                    ì—°ê²°ì¼: ${new Date(connection.connectedAt).toLocaleDateString()} | 
                                    ì½”ë“œ: ${connection.code}
                                </p>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="viewSharedData('${connection.code}')" class="text-blue-500 hover:text-blue-700 transition-colors text-sm">
                                    ğŸ‘ï¸ ë³´ê¸°
                                </button>
                                <button onclick="disconnectShare('${connection.code}')" class="text-red-500 hover:text-red-700 transition-colors">
                                    ğŸ”Œ
                                </button>
                            </div>
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html;
        }

        // ê³µìœ  ì‚­ì œ
        function deleteShare(code) {
            if (confirm('ì´ ê³µìœ ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                activeShares = activeShares.filter(share => share.code !== code);
                delete shareData[code];
                
                localStorage.setItem('activeShares', JSON.stringify(activeShares));
                localStorage.setItem('shareData', JSON.stringify(shareData));
                
                updateActiveSharesList();
                updateShareStatus();
            }
        }

        // ê³µìœ  ì—°ê²° í•´ì œ
        function disconnectShare(code) {
            if (confirm('ì´ ê°€ê³„ë¶€ ì—°ê²°ì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                connectedShares = connectedShares.filter(connection => connection.code !== code);
                localStorage.setItem('connectedShares', JSON.stringify(connectedShares));
                
                updateActiveSharesList();
                updateShareStatus();
            }
        }

        // ê³µìœ ëœ ë°ì´í„° ë³´ê¸°
        function viewSharedData(code) {
            if (!shareData[code]) {
                alert('ê³µìœ  ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const sharedInfo = shareData[code];
            const data = sharedInfo.data;
            
            // ìƒˆ ì°½ì—ì„œ ê³µìœ  ë°ì´í„° í‘œì‹œ (ê°„ë‹¨í•œ ìš”ì•½)
            let summary = `=== ê³µìœ ëœ ê°€ê³„ë¶€ ë°ì´í„° ===\n\n`;
            
            if (data.entries && data.entries.length > 0) {
                const totalIncome = data.entries.filter(e => e.type === 'income').reduce((sum, e) => sum + e.amount, 0);
                const totalSavings = data.entries.filter(e => e.type === 'savings').reduce((sum, e) => sum + e.amount, 0);
                const totalExpense = data.entries.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.amount, 0);
                
                summary += `ğŸ“Š ìˆ˜ì…/ì§€ì¶œ ìš”ì•½:\n`;
                summary += `- ì´ ìˆ˜ì…: ${totalIncome.toLocaleString()}ì›\n`;
                summary += `- ì´ ì €ì¶•: ${totalSavings.toLocaleString()}ì›\n`;
                summary += `- ì´ ì§€ì¶œ: ${totalExpense.toLocaleString()}ì›\n`;
                summary += `- ìˆœ ìì‚° ë³€í™”: ${(totalIncome - totalSavings - totalExpense).toLocaleString()}ì›\n\n`;
            }
            
            if (data.assets && data.assets.length > 0) {
                const totalAssets = data.assets.filter(a => a.type === 'asset').reduce((sum, a) => sum + a.amount, 0);
                const totalLiabilities = data.assets.filter(a => a.type === 'liability').reduce((sum, a) => sum + a.amount, 0);
                
                summary += `ğŸ’ ìì‚° ìš”ì•½:\n`;
                summary += `- ì´ ìì‚°: ${totalAssets.toLocaleString()}ì›\n`;
                summary += `- ì´ ë¶€ì±„: ${totalLiabilities.toLocaleString()}ì›\n`;
                summary += `- ìˆœ ìì‚°: ${(totalAssets - totalLiabilities).toLocaleString()}ì›\n\n`;
            }
            
            summary += `ğŸ“… ë°ì´í„° ìƒì„±ì¼: ${new Date(sharedInfo.createdAt).toLocaleString()}\n`;
            summary += `ğŸ”’ ê¶Œí•œ: ${sharedInfo.type === 'view' ? 'ë³´ê¸° ì „ìš©' : 'í¸ì§‘ ê°€ëŠ¥'}`;
            
            alert(summary);
        }

        // URLì—ì„œ ê³µìœ  ì½”ë“œ í™•ì¸ (í˜ì´ì§€ ë¡œë“œ ì‹œ)
        function checkShareCode() {
            const urlParams = new URLSearchParams(window.location.search);
            const shareCode = urlParams.get('share');
            
            if (shareCode) {
                document.getElementById('inputShareCode').value = shareCode;
                showPage('share');
                
                // ìë™ìœ¼ë¡œ ì—°ê²° ì‹œë„
                setTimeout(() => {
                    if (confirm(`ê³µìœ  ì½”ë“œ "${shareCode}"ë¡œ ê°€ê³„ë¶€ì— ì—°ê²°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                        connectWithCode();
                    }
                }, 500);
            }
        }

        // ì¼ë³„ ëª¨ë‹¬ ì—´ê¸°
        function openDayModal(dateStr) {
            currentModalDate = dateStr;
            const dayEntries = entries.filter(entry => entry.date === dateStr);
            
            // ë‚ ì§œ í¬ë§·íŒ…
            const date = new Date(dateStr);
            const formattedDate = `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›” ${date.getDate()}ì¼`;
            const dayOfWeek = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][date.getDay()];
            
            document.getElementById('modalTitle').textContent = `ğŸ“… ${formattedDate} (${dayOfWeek})`;
            
            // ë‚´ì—­ í‘œì‹œ
            const modalEntries = document.getElementById('modalEntries');
            if (dayEntries.length === 0) {
                modalEntries.innerHTML = '<p class="text-gray-500 text-center py-4">ì´ ë‚ ì—ëŠ” ì…ë ¥ëœ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                modalEntries.innerHTML = dayEntries.map(entry => {
                    const typeColors = {
                        income: 'text-green-600 bg-green-50 border-green-200',
                        savings: 'text-blue-600 bg-blue-50 border-blue-200',
                        expense: 'text-red-600 bg-red-50 border-red-200'
                    };
                    
                    const typeNames = {
                        income: 'ğŸ’° ìˆ˜ì…',
                        savings: 'ğŸ¦ ì €ì¶•',
                        expense: 'ğŸ’¸ ì§€ì¶œ'
                    };
                    
                    // ì˜ìˆ˜ì¦ ì •ë³´ í‘œì‹œ
                    let receiptInfo = '';
                    if (entry.receipt && (entry.receipt.store || entry.receipt.payment || entry.receipt.items)) {
                        receiptInfo = '<div class="mt-3 p-3 bg-gray-50 rounded-lg text-sm">';
                        if (entry.receipt.store) receiptInfo += `<div class="font-medium">ğŸª ${entry.receipt.store}</div>`;
                        if (entry.receipt.payment) receiptInfo += `<div class="text-gray-600">ğŸ’³ ${entry.receipt.payment}</div>`;
                        if (entry.receipt.items) {
                            receiptInfo += '<div class="mt-2"><strong>ğŸ›’ êµ¬ë§¤í’ˆëª©:</strong></div>';
                            receiptInfo += `<div class="whitespace-pre-line text-gray-600 mt-1">${entry.receipt.items}</div>`;
                        }
                        receiptInfo += '</div>';
                    }
                    
                    return `
                        <div class="border rounded-lg p-4 ${typeColors[entry.type]}">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center space-x-2">
                                    <span class="font-medium">${typeNames[entry.type]}</span>
                                    ${entry.mood ? `<span class="text-xl">${entry.mood}</span>` : ''}
                                </div>
                                <span class="font-bold text-lg">${formatCurrencyDisplay(entry.amount, entry.currency || 'KRW')}</span>
                            </div>
                            <div class="text-sm mb-1">
                                <strong>ì¹´í…Œê³ ë¦¬:</strong> ${entry.category}
                            </div>
                            <div class="text-sm">
                                <strong>ë©”ëª¨:</strong> ${entry.memo || 'ë©”ëª¨ ì—†ìŒ'}
                            </div>
                            ${receiptInfo}
                        </div>
                    `;
                }).join('');
            }
            
            // ì½”ë©˜íŠ¸ í‘œì‹œ
            updateModalComments(dateStr);
            
            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('dayModal').style.display = 'block';
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeDayModal() {
            document.getElementById('dayModal').style.display = 'none';
            currentModalDate = null;
            document.getElementById('commentInput').value = '';
        }

        // ëª¨ë‹¬ ì½”ë©˜íŠ¸ ì—…ë°ì´íŠ¸
        function updateModalComments(dateStr) {
            const modalComments = document.getElementById('modalComments');
            const dayComments = comments[dateStr] || [];
            
            if (dayComments.length === 0) {
                modalComments.innerHTML = '<p class="text-gray-500 text-sm">ì•„ì§ ì½”ë©˜íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                modalComments.innerHTML = dayComments.map(comment => `
                    <div class="comment-item">
                        <div class="comment-author">${comment.author}</div>
                        <div class="comment-text">${comment.text}</div>
                        <div class="comment-date">${new Date(comment.timestamp).toLocaleString()}</div>
                    </div>
                `).join('');
            }
        }

        // ì½”ë©˜íŠ¸ ì¶”ê°€
        function addComment() {
            const commentInput = document.getElementById('commentInput');
            const commentText = commentInput.value.trim();
            
            if (!commentText) {
                alert('ì½”ë©˜íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!currentModalDate) {
                alert('ë‚ ì§œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì½”ë©˜íŠ¸ ê°ì²´ ìƒì„±
            const comment = {
                id: Date.now(),
                author: 'ë‚˜', // ì‹¤ì œë¡œëŠ” ì‚¬ìš©ì ì´ë¦„ì„ ì‚¬ìš©
                text: commentText,
                timestamp: new Date().toISOString()
            };
            
            // ì½”ë©˜íŠ¸ ì €ì¥
            if (!comments[currentModalDate]) {
                comments[currentModalDate] = [];
            }
            comments[currentModalDate].push(comment);
            localStorage.setItem('comments', JSON.stringify(comments));
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            commentInput.value = '';
            
            // ì½”ë©˜íŠ¸ ëª©ë¡ ì—…ë°ì´íŠ¸
            updateModalComments(currentModalDate);
            
            // ì„±ê³µ ë©”ì‹œì§€
            alert('ì½”ë©˜íŠ¸ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ’¬');
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const modal = document.getElementById('dayModal');
            if (event.target === modal) {
                closeDayModal();
            }
        }

        // Enter í‚¤ë¡œ ì½”ë©˜íŠ¸ ì¶”ê°€
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && document.getElementById('commentInput') === document.activeElement) {
                addComment();
            }
        });

        // ê¸°ë¶„ ì„ íƒ í•¨ìˆ˜
        function selectMood(button, mood) {
            // ëª¨ë“  ê¸°ë¶„ ë²„íŠ¼ì—ì„œ ì„ íƒ ìƒíƒœ ì œê±°
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // í´ë¦­ëœ ë²„íŠ¼ì— ì„ íƒ ìƒíƒœ ì¶”ê°€
            button.classList.add('selected');
            
            // ìˆ¨ê²¨ì§„ ì…ë ¥ í•„ë“œì— ê¸°ë¶„ ê°’ ì €ì¥
            document.getElementById('entryMood').value = mood;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            init();
            checkShareCode();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97d80d2da473ea99',t:'MTc1NzYwMzAwMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
