<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스마트 가계부</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .page { display: none; }
        .page.active { display: block; }
        .nav-item.active { background-color: #3b82f6; color: white; }
        .chart-container { position: relative; height: 300px; }
        .chart-bar { transition: all 0.3s ease; }
        .chart-bar:hover { opacity: 0.8; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 네비게이션 -->
    <nav class="bg-white shadow-lg border-b">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <h1 class="text-2xl font-bold text-gray-800">💰 스마트 가계부</h1>
                <div class="flex space-x-2">
                    <button onclick="showPage('entry')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-blue-500 text-white">내역 입력</button>
                    <button onclick="showPage('monthly')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100">월별 정리</button>
                    <button onclick="showPage('yearly')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100">연도별 정리</button>
                    <button onclick="showPage('assets')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100">자산 관리</button>
                    <button onclick="showPage('settings')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100">설정</button>
                    <button onclick="showPage('share')" class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100">공유</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 페이지 1: 내역 입력 -->
    <div id="entry" class="page active">
        <div class="max-w-4xl mx-auto p-6">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold mb-6 text-gray-800">💳 수입/지출 내역 입력</h2>
                
                <form id="entryForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">날짜</label>
                        <input type="date" id="entryDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">유형</label>
                        <select id="entryType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="updateCategories()" required>
                            <option value="">선택하세요</option>
                            <option value="income">수입</option>
                            <option value="savings">저축</option>
                            <option value="expense">지출</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">카테고리</label>
                        <select id="entryCategory" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">유형을 먼저 선택하세요</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">금액 (원)</label>
                        <input type="number" id="entryAmount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" required>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">메모</label>
                        <input type="text" id="entryMemo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="선택사항">
                    </div>
                    
                    <div class="md:col-span-2">
                        <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            ✅ 내역 추가
                        </button>
                    </div>
                </form>
            </div>

            <!-- 최근 내역 -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">📋 최근 내역</h3>
                <div id="recentEntries" class="space-y-3">
                    <!-- 최근 내역이 여기에 표시됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 페이지 2: 월별 정리 -->
    <div id="monthly" class="page">
        <div class="max-w-6xl mx-auto p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">📊 월별 가계부</h2>
                <div class="flex items-center space-x-4">
                    <select id="monthlyYear" class="px-3 py-2 border border-gray-300 rounded-lg" onchange="updateMonthlyView()">
                        <!-- 연도 옵션이 동적으로 추가됩니다 -->
                    </select>
                    <select id="monthlyMonth" class="px-3 py-2 border border-gray-300 rounded-lg" onchange="updateMonthlyView()">
                        <option value="1">1월</option>
                        <option value="2">2월</option>
                        <option value="3">3월</option>
                        <option value="4">4월</option>
                        <option value="5">5월</option>
                        <option value="6">6월</option>
                        <option value="7">7월</option>
                        <option value="8">8월</option>
                        <option value="9">9월</option>
                        <option value="10">10월</option>
                        <option value="11">11월</option>
                        <option value="12">12월</option>
                    </select>
                </div>
            </div>

            <!-- 월별 요약 -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="bg-green-50 border border-green-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-600 text-sm font-medium">총 수입</p>
                            <p id="monthlyIncome" class="text-2xl font-bold text-green-700">0원</p>
                        </div>
                        <div class="text-green-500 text-3xl">💰</div>
                    </div>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-600 text-sm font-medium">총 저축</p>
                            <p id="monthlySavings" class="text-2xl font-bold text-blue-700">0원</p>
                        </div>
                        <div class="text-blue-500 text-3xl">🏦</div>
                    </div>
                </div>
                
                <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-600 text-sm font-medium">총 지출</p>
                            <p id="monthlyExpense" class="text-2xl font-bold text-red-700">0원</p>
                        </div>
                        <div class="text-red-500 text-3xl">💸</div>
                    </div>
                </div>
                
                <div class="bg-purple-50 border border-purple-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-600 text-sm font-medium">순 자산 변화</p>
                            <p id="monthlyNet" class="text-2xl font-bold text-purple-700">0원</p>
                        </div>
                        <div class="text-purple-500 text-3xl">📈</div>
                    </div>
                </div>
            </div>

            <!-- 예산 대비 현황 -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">🎯 예산 달성 현황</h3>
                <div id="budgetProgress" class="space-y-4">
                    <!-- 예산 진행률이 여기에 표시됩니다 -->
                </div>
            </div>

            <!-- 카테고리별 상세 -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-700">💰 수입 내역</h3>
                    <div id="monthlyIncomeDetails" class="space-y-2">
                        <!-- 수입 상세 내역 -->
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-blue-700">🏦 저축 내역</h3>
                    <div id="monthlySavingsDetails" class="space-y-2">
                        <!-- 저축 상세 내역 -->
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-red-700">💸 지출 내역</h3>
                    <div id="monthlyExpenseDetails" class="space-y-2">
                        <!-- 지출 상세 내역 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 페이지 3: 연도별 정리 -->
    <div id="yearly" class="page">
        <div class="max-w-6xl mx-auto p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">📈 연도별 가계부</h2>
                <select id="yearlyYear" class="px-3 py-2 border border-gray-300 rounded-lg" onchange="updateYearlyView()">
                    <!-- 연도 옵션이 동적으로 추가됩니다 -->
                </select>
            </div>

            <!-- 연도별 요약 -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="bg-green-50 border border-green-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-600 text-sm font-medium">연간 총 수입</p>
                            <p id="yearlyIncome" class="text-2xl font-bold text-green-700">0원</p>
                        </div>
                        <div class="text-green-500 text-3xl">💰</div>
                    </div>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-600 text-sm font-medium">연간 총 저축</p>
                            <p id="yearlySavings" class="text-2xl font-bold text-blue-700">0원</p>
                        </div>
                        <div class="text-blue-500 text-3xl">🏦</div>
                    </div>
                </div>
                
                <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-600 text-sm font-medium">연간 총 지출</p>
                            <p id="yearlyExpense" class="text-2xl font-bold text-red-700">0원</p>
                        </div>
                        <div class="text-red-500 text-3xl">💸</div>
                    </div>
                </div>
                
                <div class="bg-purple-50 border border-purple-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-600 text-sm font-medium">연간 순 자산 변화</p>
                            <p id="yearlyNet" class="text-2xl font-bold text-purple-700">0원</p>
                        </div>
                        <div class="text-purple-500 text-3xl">📊</div>
                    </div>
                </div>
            </div>

            <!-- 월별 차트 -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">📊 월별 추이</h3>
                <div class="chart-container">
                    <canvas id="yearlyChart" class="w-full h-full"></canvas>
                </div>
            </div>

            <!-- 카테고리별 연간 통계 -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-700">💰 연간 수입 분석</h3>
                    <div id="yearlyIncomeAnalysis" class="space-y-3">
                        <!-- 연간 수입 분석 -->
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-blue-700">🏦 연간 저축 분석</h3>
                    <div id="yearlySavingsAnalysis" class="space-y-3">
                        <!-- 연간 저축 분석 -->
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-red-700">💸 연간 지출 분석</h3>
                    <div id="yearlyExpenseAnalysis" class="space-y-3">
                        <!-- 연간 지출 분석 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 페이지 4: 자산 관리 -->
    <div id="assets" class="page">
        <div class="max-w-6xl mx-auto p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">🏠 자산 관리</h2>
                <button onclick="showAssetForm()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                    ➕ 자산 추가
                </button>
            </div>

            <!-- 자산 요약 -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="bg-green-50 border border-green-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-600 text-sm font-medium">총 자산</p>
                            <p id="totalAssets" class="text-2xl font-bold text-green-700">0원</p>
                        </div>
                        <div class="text-green-500 text-3xl">💎</div>
                    </div>
                </div>
                
                <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-600 text-sm font-medium">총 부채</p>
                            <p id="totalLiabilities" class="text-2xl font-bold text-red-700">0원</p>
                        </div>
                        <div class="text-red-500 text-3xl">📉</div>
                    </div>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-600 text-sm font-medium">순 자산</p>
                            <p id="netWorth" class="text-2xl font-bold text-blue-700">0원</p>
                        </div>
                        <div class="text-blue-500 text-3xl">💰</div>
                    </div>
                </div>
            </div>

            <!-- 자산 입력 폼 (숨김) -->
            <div id="assetForm" class="bg-white rounded-xl shadow-lg p-6 mb-6" style="display: none;">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">자산/부채 추가</h3>
                <form id="assetEntryForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">유형</label>
                        <select id="assetType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">선택하세요</option>
                            <option value="asset">자산</option>
                            <option value="liability">부채</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">카테고리</label>
                        <select id="assetCategory" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">유형을 먼저 선택하세요</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">항목명</label>
                        <input type="text" id="assetName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="예: 신한은행 적금" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">금액 (원)</label>
                        <input type="number" id="assetAmount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" required>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">메모</label>
                        <input type="text" id="assetMemo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="선택사항">
                    </div>
                    
                    <div class="md:col-span-2 flex space-x-3">
                        <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                            ✅ 추가
                        </button>
                        <button type="button" onclick="hideAssetForm()" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            취소
                        </button>
                    </div>
                </form>
            </div>

            <!-- 자산 목록 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-700">💎 자산 목록</h3>
                    <div id="assetsList" class="space-y-3">
                        <!-- 자산 목록이 여기에 표시됩니다 -->
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-red-700">📉 부채 목록</h3>
                    <div id="liabilitiesList" class="space-y-3">
                        <!-- 부채 목록이 여기에 표시됩니다 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 페이지 5: 공유 -->
    <div id="share" class="page">
        <div class="max-w-4xl mx-auto p-6">
            <h2 class="text-2xl font-semibold mb-6 text-gray-800">🤝 가계부 공유</h2>

            <!-- 공유 상태 -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">📊 현재 공유 상태</h3>
                <div id="shareStatus" class="space-y-3">
                    <!-- 공유 상태가 여기에 표시됩니다 -->
                </div>
            </div>

            <!-- 공유 링크 생성 -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">🔗 공유 링크 생성</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">공유 유형</label>
                        <select id="shareType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="view">보기 전용 (읽기만 가능)</option>
                            <option value="edit">편집 가능 (수정 가능)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">공유할 데이터 선택</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="shareEntries" class="mr-2" checked>
                                <span class="text-sm">수입/지출 내역</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="shareAssets" class="mr-2" checked>
                                <span class="text-sm">자산 정보</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="shareBudgets" class="mr-2" checked>
                                <span class="text-sm">예산 목표</span>
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">공유 기간 (선택사항)</label>
                        <select id="shareExpiry" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">무제한</option>
                            <option value="1">1일</option>
                            <option value="7">7일</option>
                            <option value="30">30일</option>
                            <option value="90">90일</option>
                        </select>
                    </div>
                    
                    <button onclick="generateShareLink()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                        🔗 공유 링크 생성
                    </button>
                </div>
            </div>

            <!-- 생성된 공유 링크 -->
            <div id="generatedLink" class="bg-white rounded-xl shadow-lg p-6 mb-6" style="display: none;">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">✅ 공유 링크가 생성되었습니다!</h3>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">공유 링크</label>
                        <div class="flex space-x-2">
                            <input type="text" id="shareUrl" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                            <button onclick="copyShareLink()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                                📋 복사
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">공유 코드</label>
                        <div class="flex space-x-2">
                            <input type="text" id="shareCode" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-center text-lg font-mono" readonly>
                            <button onclick="copyShareCode()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                                📋 복사
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">상대방이 이 코드를 입력하여 가계부에 접근할 수 있습니다.</p>
                    </div>
                </div>
            </div>

            <!-- 공유 코드로 접속 -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">🔑 공유 코드로 접속</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">공유 코드 입력</label>
                        <div class="flex space-x-2">
                            <input type="text" id="inputShareCode" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-center text-lg font-mono" placeholder="예: ABC123">
                            <button onclick="connectWithCode()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors">
                                🔗 연결
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 활성 공유 목록 -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">📋 활성 공유 목록</h3>
                <div id="activeShares" class="space-y-3">
                    <!-- 활성 공유 목록이 여기에 표시됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 페이지 6: 설정 -->
    <div id="settings" class="page">
        <div class="max-w-4xl mx-auto p-6">
            <h2 class="text-2xl font-semibold mb-6 text-gray-800">⚙️ 가계부 설정</h2>

            <!-- 기본 설정 -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">📅 기본 설정</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">가계부 시작일</label>
                        <input type="date" id="startDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">기본 통화</label>
                        <select id="currency" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="KRW">원 (KRW)</option>
                            <option value="USD">달러 (USD)</option>
                            <option value="EUR">유로 (EUR)</option>
                        </select>
                    </div>
                </div>
                <button onclick="saveBasicSettings()" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                    💾 저장
                </button>
            </div>

            <!-- 예산 설정 -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">🎯 월별 예산 목표</h3>
                <div id="budgetSettings" class="space-y-4">
                    <!-- 예산 설정이 여기에 표시됩니다 -->
                </div>
                <button onclick="addBudgetGoal()" class="mt-4 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                    ➕ 예산 목표 추가
                </button>
            </div>

            <!-- 카테고리 관리 -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-700">💰 수입 카테고리</h3>
                    <div id="incomeCategories" class="space-y-2 mb-4">
                        <!-- 수입 카테고리 목록 -->
                    </div>
                    <div class="flex space-x-2">
                        <input type="text" id="newIncomeCategory" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="새 카테고리">
                        <button onclick="addCategory('income')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-sm transition-colors">추가</button>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-blue-700">🏦 저축 카테고리</h3>
                    <div id="savingsCategories" class="space-y-2 mb-4">
                        <!-- 저축 카테고리 목록 -->
                    </div>
                    <div class="flex space-x-2">
                        <input type="text" id="newSavingsCategory" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="새 카테고리">
                        <button onclick="addCategory('savings')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm transition-colors">추가</button>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-red-700">💸 지출 카테고리</h3>
                    <div id="expenseCategories" class="space-y-2 mb-4">
                        <!-- 지출 카테고리 목록 -->
                    </div>
                    <div class="flex space-x-2">
                        <input type="text" id="newExpenseCategory" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="새 카테고리">
                        <button onclick="addCategory('expense')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm transition-colors">추가</button>
                    </div>
                </div>
            </div>

            <!-- 데이터 관리 -->
            <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">💾 데이터 관리</h3>
                <div class="flex flex-wrap gap-4">
                    <button onclick="exportData()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                        📤 데이터 내보내기
                    </button>
                    <button onclick="importData()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                        📥 데이터 가져오기
                    </button>
                    <button onclick="resetData()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                        🗑️ 모든 데이터 초기화
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let entries = JSON.parse(localStorage.getItem('entries') || '[]');
        let assets = JSON.parse(localStorage.getItem('assets') || '[]');
        let categories = JSON.parse(localStorage.getItem('categories') || JSON.stringify({
            income: ['급여', '부업', '투자수익', '기타수입'],
            savings: ['적금', '예금', '투자', '연금'],
            expense: ['식비', '교통비', '주거비', '의료비', '쇼핑', '문화생활', '기타지출']
        }));
        let budgetGoals = JSON.parse(localStorage.getItem('budgetGoals') || '{}');
        let settings = JSON.parse(localStorage.getItem('settings') || JSON.stringify({
            startDate: new Date().toISOString().split('T')[0],
            currency: 'KRW'
        }));
        let shareData = JSON.parse(localStorage.getItem('shareData') || '{}');
        let activeShares = JSON.parse(localStorage.getItem('activeShares') || '[]');
        let connectedShares = JSON.parse(localStorage.getItem('connectedShares') || '[]');

        // 자산 카테고리
        const assetCategories = {
            asset: ['현금', '예금', '적금', '주식', '부동산', '기타자산'],
            liability: ['신용카드', '대출', '기타부채']
        };

        // 페이지 전환
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            document.getElementById(pageId).classList.add('active');
            event.target.classList.add('active');
            
            // 페이지별 초기화
            if (pageId === 'monthly') {
                initMonthlyView();
            } else if (pageId === 'yearly') {
                initYearlyView();
            } else if (pageId === 'assets') {
                updateAssetsView();
            } else if (pageId === 'settings') {
                initSettingsView();
            } else if (pageId === 'entry') {
                updateRecentEntries();
            } else if (pageId === 'share') {
                initShareView();
            }
        }

        // 초기화
        function init() {
            // 오늘 날짜 설정
            document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];
            
            // 폼 이벤트 리스너
            document.getElementById('entryForm').addEventListener('submit', addEntry);
            document.getElementById('assetEntryForm').addEventListener('submit', addAsset);
            
            // 초기 뷰 업데이트
            updateRecentEntries();
            initMonthlyView();
            initYearlyView();
            updateAssetsView();
            initSettingsView();
        }

        // 카테고리 업데이트
        function updateCategories() {
            const type = document.getElementById('entryType').value;
            const categorySelect = document.getElementById('entryCategory');
            
            categorySelect.innerHTML = '<option value="">카테고리 선택</option>';
            
            if (type && categories[type]) {
                categories[type].forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
            }
        }

        // 내역 추가
        function addEntry(e) {
            e.preventDefault();
            
            const entry = {
                id: Date.now(),
                date: document.getElementById('entryDate').value,
                type: document.getElementById('entryType').value,
                category: document.getElementById('entryCategory').value,
                amount: parseInt(document.getElementById('entryAmount').value),
                memo: document.getElementById('entryMemo').value
            };
            
            entries.unshift(entry);
            localStorage.setItem('entries', JSON.stringify(entries));
            
            // 폼 초기화
            document.getElementById('entryForm').reset();
            document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('entryCategory').innerHTML = '<option value="">유형을 먼저 선택하세요</option>';
            
            updateRecentEntries();
            
            // 성공 메시지
            alert('내역이 성공적으로 추가되었습니다! 💰');
        }

        // 최근 내역 업데이트
        function updateRecentEntries() {
            const container = document.getElementById('recentEntries');
            const recentEntries = entries.slice(0, 10);
            
            if (recentEntries.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">아직 입력된 내역이 없습니다.</p>';
                return;
            }
            
            container.innerHTML = recentEntries.map(entry => {
                const typeColors = {
                    income: 'text-green-600 bg-green-50',
                    savings: 'text-blue-600 bg-blue-50',
                    expense: 'text-red-600 bg-red-50'
                };
                
                const typeNames = {
                    income: '수입',
                    savings: '저축',
                    expense: '지출'
                };
                
                return `
                    <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2">
                                <span class="px-2 py-1 text-xs font-medium rounded-full ${typeColors[entry.type]}">
                                    ${typeNames[entry.type]}
                                </span>
                                <span class="text-sm font-medium text-gray-800">${entry.category}</span>
                            </div>
                            <p class="text-sm text-gray-600 mt-1">${entry.memo || '메모 없음'}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold ${entry.type === 'income' ? 'text-green-600' : entry.type === 'savings' ? 'text-blue-600' : 'text-red-600'}">
                                ${entry.amount.toLocaleString()}원
                            </p>
                            <p class="text-xs text-gray-500">${entry.date}</p>
                        </div>
                        <button onclick="deleteEntry(${entry.id})" class="ml-3 text-red-500 hover:text-red-700 transition-colors">
                            🗑️
                        </button>
                    </div>
                `;
            }).join('');
        }

        // 내역 삭제
        function deleteEntry(id) {
            if (confirm('이 내역을 삭제하시겠습니까?')) {
                entries = entries.filter(entry => entry.id !== id);
                localStorage.setItem('entries', JSON.stringify(entries));
                updateRecentEntries();
            }
        }

        // 월별 뷰 초기화
        function initMonthlyView() {
            const yearSelect = document.getElementById('monthlyYear');
            const monthSelect = document.getElementById('monthlyMonth');
            
            // 연도 옵션 생성
            const currentYear = new Date().getFullYear();
            const years = [...new Set(entries.map(entry => new Date(entry.date).getFullYear()))];
            if (years.length === 0) years.push(currentYear);
            
            yearSelect.innerHTML = years.sort((a, b) => b - a).map(year => 
                `<option value="${year}" ${year === currentYear ? 'selected' : ''}>${year}년</option>`
            ).join('');
            
            // 현재 월 선택
            monthSelect.value = new Date().getMonth() + 1;
            
            updateMonthlyView();
        }

        // 월별 뷰 업데이트
        function updateMonthlyView() {
            const year = parseInt(document.getElementById('monthlyYear').value);
            const month = parseInt(document.getElementById('monthlyMonth').value);
            
            const monthlyEntries = entries.filter(entry => {
                const entryDate = new Date(entry.date);
                return entryDate.getFullYear() === year && entryDate.getMonth() + 1 === month;
            });
            
            // 월별 요약 계산
            const summary = {
                income: monthlyEntries.filter(e => e.type === 'income').reduce((sum, e) => sum + e.amount, 0),
                savings: monthlyEntries.filter(e => e.type === 'savings').reduce((sum, e) => sum + e.amount, 0),
                expense: monthlyEntries.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.amount, 0)
            };
            
            summary.net = summary.income - summary.savings - summary.expense;
            
            // 요약 표시
            document.getElementById('monthlyIncome').textContent = summary.income.toLocaleString() + '원';
            document.getElementById('monthlySavings').textContent = summary.savings.toLocaleString() + '원';
            document.getElementById('monthlyExpense').textContent = summary.expense.toLocaleString() + '원';
            document.getElementById('monthlyNet').textContent = summary.net.toLocaleString() + '원';
            
            // 예산 진행률 업데이트
            updateBudgetProgress(year, month, summary);
            
            // 카테고리별 상세 업데이트
            updateMonthlyCategoryDetails(monthlyEntries);
        }

        // 예산 진행률 업데이트
        function updateBudgetProgress(year, month, summary) {
            const container = document.getElementById('budgetProgress');
            const monthKey = `${year}-${month.toString().padStart(2, '0')}`;
            
            if (!budgetGoals[monthKey] || Object.keys(budgetGoals[monthKey]).length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center">설정된 예산 목표가 없습니다. 설정 페이지에서 예산을 설정해보세요.</p>';
                return;
            }
            
            const goals = budgetGoals[monthKey];
            let html = '';
            
            Object.entries(goals).forEach(([type, goal]) => {
                const actual = summary[type] || 0;
                const percentage = goal > 0 ? Math.min((actual / goal) * 100, 100) : 0;
                const isOver = actual > goal;
                
                const typeNames = {
                    income: '수입',
                    savings: '저축',
                    expense: '지출'
                };
                
                const colors = {
                    income: isOver ? 'bg-green-500' : 'bg-green-300',
                    savings: isOver ? 'bg-blue-500' : 'bg-blue-300',
                    expense: isOver ? 'bg-red-500' : 'bg-red-300'
                };
                
                html += `
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-sm font-medium">${typeNames[type]} 목표</span>
                            <span class="text-sm ${isOver ? 'text-red-600' : 'text-gray-600'}">
                                ${actual.toLocaleString()}원 / ${goal.toLocaleString()}원
                            </span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="${colors[type]} h-2 rounded-full transition-all duration-300" style="width: ${percentage}%"></div>
                        </div>
                        <div class="text-xs text-gray-500">
                            ${percentage.toFixed(1)}% 달성 ${isOver ? '(목표 초과)' : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // 월별 카테고리 상세 업데이트
        function updateMonthlyCategoryDetails(monthlyEntries) {
            const types = ['income', 'savings', 'expense'];
            
            types.forEach(type => {
                const container = document.getElementById(`monthly${type.charAt(0).toUpperCase() + type.slice(1)}Details`);
                const typeEntries = monthlyEntries.filter(e => e.type === type);
                
                if (typeEntries.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-sm">내역이 없습니다.</p>';
                    return;
                }
                
                // 카테고리별 합계 계산
                const categoryTotals = {};
                typeEntries.forEach(entry => {
                    categoryTotals[entry.category] = (categoryTotals[entry.category] || 0) + entry.amount;
                });
                
                // 정렬 (금액 순)
                const sortedCategories = Object.entries(categoryTotals)
                    .sort(([,a], [,b]) => b - a);
                
                container.innerHTML = sortedCategories.map(([category, amount]) => `
                    <div class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                        <span class="text-sm text-gray-700">${category}</span>
                        <span class="text-sm font-medium">${amount.toLocaleString()}원</span>
                    </div>
                `).join('');
            });
        }

        // 연도별 뷰 초기화
        function initYearlyView() {
            const yearSelect = document.getElementById('yearlyYear');
            
            // 연도 옵션 생성
            const currentYear = new Date().getFullYear();
            const years = [...new Set(entries.map(entry => new Date(entry.date).getFullYear()))];
            if (years.length === 0) years.push(currentYear);
            
            yearSelect.innerHTML = years.sort((a, b) => b - a).map(year => 
                `<option value="${year}" ${year === currentYear ? 'selected' : ''}>${year}년</option>`
            ).join('');
            
            updateYearlyView();
        }

        // 연도별 뷰 업데이트
        function updateYearlyView() {
            const year = parseInt(document.getElementById('yearlyYear').value);
            
            const yearlyEntries = entries.filter(entry => {
                return new Date(entry.date).getFullYear() === year;
            });
            
            // 연도별 요약 계산
            const summary = {
                income: yearlyEntries.filter(e => e.type === 'income').reduce((sum, e) => sum + e.amount, 0),
                savings: yearlyEntries.filter(e => e.type === 'savings').reduce((sum, e) => sum + e.amount, 0),
                expense: yearlyEntries.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.amount, 0)
            };
            
            summary.net = summary.income - summary.savings - summary.expense;
            
            // 요약 표시
            document.getElementById('yearlyIncome').textContent = summary.income.toLocaleString() + '원';
            document.getElementById('yearlySavings').textContent = summary.savings.toLocaleString() + '원';
            document.getElementById('yearlyExpense').textContent = summary.expense.toLocaleString() + '원';
            document.getElementById('yearlyNet').textContent = summary.net.toLocaleString() + '원';
            
            // 월별 차트 업데이트
            updateYearlyChart(year, yearlyEntries);
            
            // 카테고리별 연간 분석 업데이트
            updateYearlyCategoryAnalysis(yearlyEntries);
        }

        // 연도별 차트 업데이트 (간단한 바 차트)
        function updateYearlyChart(year, yearlyEntries) {
            const canvas = document.getElementById('yearlyChart');
            const ctx = canvas.getContext('2d');
            
            // 캔버스 크기 설정
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // 월별 데이터 계산
            const monthlyData = Array.from({length: 12}, (_, i) => {
                const month = i + 1;
                const monthEntries = yearlyEntries.filter(entry => {
                    return new Date(entry.date).getMonth() + 1 === month;
                });
                
                return {
                    month: month,
                    income: monthEntries.filter(e => e.type === 'income').reduce((sum, e) => sum + e.amount, 0),
                    savings: monthEntries.filter(e => e.type === 'savings').reduce((sum, e) => sum + e.amount, 0),
                    expense: monthEntries.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.amount, 0)
                };
            });
            
            // 차트 그리기
            const maxValue = Math.max(...monthlyData.flatMap(d => [d.income, d.savings, d.expense]));
            if (maxValue === 0) {
                ctx.fillStyle = '#6b7280';
                ctx.font = '16px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('데이터가 없습니다', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            const barWidth = canvas.width / 12;
            const chartHeight = canvas.height - 60;
            
            monthlyData.forEach((data, index) => {
                const x = index * barWidth;
                const incomeHeight = (data.income / maxValue) * chartHeight;
                const savingsHeight = (data.savings / maxValue) * chartHeight;
                const expenseHeight = (data.expense / maxValue) * chartHeight;
                
                // 수입 (녹색)
                ctx.fillStyle = '#10b981';
                ctx.fillRect(x + 5, canvas.height - 40 - incomeHeight, barWidth / 3 - 2, incomeHeight);
                
                // 저축 (파란색)
                ctx.fillStyle = '#3b82f6';
                ctx.fillRect(x + barWidth / 3 + 3, canvas.height - 40 - savingsHeight, barWidth / 3 - 2, savingsHeight);
                
                // 지출 (빨간색)
                ctx.fillStyle = '#ef4444';
                ctx.fillRect(x + (barWidth / 3) * 2 + 1, canvas.height - 40 - expenseHeight, barWidth / 3 - 2, expenseHeight);
                
                // 월 라벨
                ctx.fillStyle = '#374151';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`${data.month}월`, x + barWidth / 2, canvas.height - 10);
            });
            
            // 범례
            ctx.fillStyle = '#10b981';
            ctx.fillRect(10, 10, 15, 15);
            ctx.fillStyle = '#374151';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('수입', 30, 22);
            
            ctx.fillStyle = '#3b82f6';
            ctx.fillRect(80, 10, 15, 15);
            ctx.fillText('저축', 100, 22);
            
            ctx.fillStyle = '#ef4444';
            ctx.fillRect(150, 10, 15, 15);
            ctx.fillText('지출', 170, 22);
        }

        // 연간 카테고리 분석 업데이트
        function updateYearlyCategoryAnalysis(yearlyEntries) {
            const types = ['income', 'savings', 'expense'];
            
            types.forEach(type => {
                const container = document.getElementById(`yearly${type.charAt(0).toUpperCase() + type.slice(1)}Analysis`);
                const typeEntries = yearlyEntries.filter(e => e.type === type);
                
                if (typeEntries.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-sm">내역이 없습니다.</p>';
                    return;
                }
                
                // 카테고리별 합계 계산
                const categoryTotals = {};
                typeEntries.forEach(entry => {
                    categoryTotals[entry.category] = (categoryTotals[entry.category] || 0) + entry.amount;
                });
                
                const total = Object.values(categoryTotals).reduce((sum, amount) => sum + amount, 0);
                
                // 정렬 (금액 순)
                const sortedCategories = Object.entries(categoryTotals)
                    .sort(([,a], [,b]) => b - a);
                
                container.innerHTML = sortedCategories.map(([category, amount]) => {
                    const percentage = total > 0 ? (amount / total * 100).toFixed(1) : 0;
                    return `
                        <div class="space-y-1">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-700">${category}</span>
                                <span class="text-sm font-medium">${amount.toLocaleString()}원</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-${type === 'income' ? 'green' : type === 'savings' ? 'blue' : 'red'}-500 h-2 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                            <div class="text-xs text-gray-500">${percentage}%</div>
                        </div>
                    `;
                }).join('');
            });
        }

        // 자산 폼 표시/숨김
        function showAssetForm() {
            document.getElementById('assetForm').style.display = 'block';
            updateAssetCategories();
        }

        function hideAssetForm() {
            document.getElementById('assetForm').style.display = 'none';
            document.getElementById('assetEntryForm').reset();
        }

        // 자산 카테고리 업데이트
        function updateAssetCategories() {
            const type = document.getElementById('assetType').value;
            const categorySelect = document.getElementById('assetCategory');
            
            categorySelect.innerHTML = '<option value="">카테고리 선택</option>';
            
            if (type && assetCategories[type]) {
                assetCategories[type].forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
            }
        }

        // 자산 추가
        function addAsset(e) {
            e.preventDefault();
            
            const asset = {
                id: Date.now(),
                type: document.getElementById('assetType').value,
                category: document.getElementById('assetCategory').value,
                name: document.getElementById('assetName').value,
                amount: parseInt(document.getElementById('assetAmount').value),
                memo: document.getElementById('assetMemo').value,
                date: new Date().toISOString().split('T')[0]
            };
            
            assets.push(asset);
            localStorage.setItem('assets', JSON.stringify(assets));
            
            hideAssetForm();
            updateAssetsView();
            
            alert('자산이 성공적으로 추가되었습니다! 💎');
        }

        // 자산 뷰 업데이트
        function updateAssetsView() {
            const assetsList = assets.filter(a => a.type === 'asset');
            const liabilitiesList = assets.filter(a => a.type === 'liability');
            
            const totalAssets = assetsList.reduce((sum, a) => sum + a.amount, 0);
            const totalLiabilities = liabilitiesList.reduce((sum, a) => sum + a.amount, 0);
            const netWorth = totalAssets - totalLiabilities;
            
            // 요약 업데이트
            document.getElementById('totalAssets').textContent = totalAssets.toLocaleString() + '원';
            document.getElementById('totalLiabilities').textContent = totalLiabilities.toLocaleString() + '원';
            document.getElementById('netWorth').textContent = netWorth.toLocaleString() + '원';
            
            // 자산 목록 업데이트
            updateAssetList('assetsList', assetsList, 'asset');
            updateAssetList('liabilitiesList', liabilitiesList, 'liability');
        }

        // 자산 목록 업데이트
        function updateAssetList(containerId, list, type) {
            const container = document.getElementById(containerId);
            
            if (list.length === 0) {
                container.innerHTML = `<p class="text-gray-500 text-sm">${type === 'asset' ? '자산' : '부채'}이 없습니다.</p>`;
                return;
            }
            
            container.innerHTML = list.map(item => `
                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                    <div class="flex-1">
                        <div class="flex items-center space-x-2">
                            <span class="px-2 py-1 text-xs font-medium rounded-full ${type === 'asset' ? 'text-green-600 bg-green-50' : 'text-red-600 bg-red-50'}">
                                ${item.category}
                            </span>
                        </div>
                        <p class="font-medium text-gray-800 mt-1">${item.name}</p>
                        <p class="text-sm text-gray-600">${item.memo || '메모 없음'}</p>
                    </div>
                    <div class="text-right">
                        <p class="font-semibold ${type === 'asset' ? 'text-green-600' : 'text-red-600'}">
                            ${item.amount.toLocaleString()}원
                        </p>
                        <p class="text-xs text-gray-500">${item.date}</p>
                    </div>
                    <button onclick="deleteAsset(${item.id})" class="ml-3 text-red-500 hover:text-red-700 transition-colors">
                        🗑️
                    </button>
                </div>
            `).join('');
        }

        // 자산 삭제
        function deleteAsset(id) {
            if (confirm('이 항목을 삭제하시겠습니까?')) {
                assets = assets.filter(asset => asset.id !== id);
                localStorage.setItem('assets', JSON.stringify(assets));
                updateAssetsView();
            }
        }

        // 설정 뷰 초기화
        function initSettingsView() {
            // 기본 설정 로드
            document.getElementById('startDate').value = settings.startDate;
            document.getElementById('currency').value = settings.currency;
            
            // 카테고리 목록 업데이트
            updateCategoryLists();
            
            // 예산 설정 업데이트
            updateBudgetSettings();
        }

        // 카테고리 목록 업데이트
        function updateCategoryLists() {
            const types = ['income', 'savings', 'expense'];
            
            types.forEach(type => {
                const container = document.getElementById(`${type}Categories`);
                const typeCategories = categories[type] || [];
                
                container.innerHTML = typeCategories.map(category => `
                    <div class="flex items-center justify-between p-2 border border-gray-200 rounded-lg">
                        <span class="text-sm">${category}</span>
                        <button onclick="deleteCategory('${type}', '${category}')" class="text-red-500 hover:text-red-700 text-sm">
                            🗑️
                        </button>
                    </div>
                `).join('');
            });
        }

        // 카테고리 추가
        function addCategory(type) {
            const input = document.getElementById(`new${type.charAt(0).toUpperCase() + type.slice(1)}Category`);
            const newCategory = input.value.trim();
            
            if (!newCategory) {
                alert('카테고리 이름을 입력해주세요.');
                return;
            }
            
            if (categories[type].includes(newCategory)) {
                alert('이미 존재하는 카테고리입니다.');
                return;
            }
            
            categories[type].push(newCategory);
            localStorage.setItem('categories', JSON.stringify(categories));
            
            input.value = '';
            updateCategoryLists();
        }

        // 카테고리 삭제
        function deleteCategory(type, category) {
            if (confirm(`'${category}' 카테고리를 삭제하시겠습니까?`)) {
                categories[type] = categories[type].filter(c => c !== category);
                localStorage.setItem('categories', JSON.stringify(categories));
                updateCategoryLists();
            }
        }

        // 기본 설정 저장
        function saveBasicSettings() {
            settings.startDate = document.getElementById('startDate').value;
            settings.currency = document.getElementById('currency').value;
            
            localStorage.setItem('settings', JSON.stringify(settings));
            alert('설정이 저장되었습니다! ✅');
        }

        // 예산 설정 업데이트
        function updateBudgetSettings() {
            const container = document.getElementById('budgetSettings');
            const currentMonth = new Date().toISOString().slice(0, 7);
            
            if (!budgetGoals[currentMonth]) {
                container.innerHTML = '<p class="text-gray-500">설정된 예산 목표가 없습니다.</p>';
                return;
            }
            
            const goals = budgetGoals[currentMonth];
            const typeNames = {
                income: '수입',
                savings: '저축',
                expense: '지출'
            };
            
            container.innerHTML = Object.entries(goals).map(([type, amount]) => `
                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
                    <span class="text-sm font-medium">${typeNames[type]} 목표</span>
                    <div class="flex items-center space-x-2">
                        <span class="text-sm">${amount.toLocaleString()}원</span>
                        <button onclick="deleteBudgetGoal('${type}')" class="text-red-500 hover:text-red-700 text-sm">
                            🗑️
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // 예산 목표 추가
        function addBudgetGoal() {
            const type = prompt('예산 유형을 선택하세요:\n1. income (수입)\n2. savings (저축)\n3. expense (지출)');
            if (!type || !['income', 'savings', 'expense'].includes(type)) {
                alert('올바른 유형을 입력해주세요.');
                return;
            }
            
            const amount = prompt('목표 금액을 입력하세요 (원):');
            if (!amount || isNaN(amount) || parseInt(amount) <= 0) {
                alert('올바른 금액을 입력해주세요.');
                return;
            }
            
            const currentMonth = new Date().toISOString().slice(0, 7);
            if (!budgetGoals[currentMonth]) {
                budgetGoals[currentMonth] = {};
            }
            
            budgetGoals[currentMonth][type] = parseInt(amount);
            localStorage.setItem('budgetGoals', JSON.stringify(budgetGoals));
            
            updateBudgetSettings();
            alert('예산 목표가 설정되었습니다! 🎯');
        }

        // 예산 목표 삭제
        function deleteBudgetGoal(type) {
            const currentMonth = new Date().toISOString().slice(0, 7);
            if (budgetGoals[currentMonth] && budgetGoals[currentMonth][type]) {
                delete budgetGoals[currentMonth][type];
                localStorage.setItem('budgetGoals', JSON.stringify(budgetGoals));
                updateBudgetSettings();
            }
        }

        // 데이터 내보내기
        function exportData() {
            const data = {
                entries,
                assets,
                categories,
                budgetGoals,
                settings,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `가계부_백업_${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // 데이터 가져오기
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (confirm('기존 데이터를 모두 덮어쓰시겠습니까?')) {
                            entries = data.entries || [];
                            assets = data.assets || [];
                            categories = data.categories || categories;
                            budgetGoals = data.budgetGoals || {};
                            settings = data.settings || settings;
                            
                            // 로컬 스토리지에 저장
                            localStorage.setItem('entries', JSON.stringify(entries));
                            localStorage.setItem('assets', JSON.stringify(assets));
                            localStorage.setItem('categories', JSON.stringify(categories));
                            localStorage.setItem('budgetGoals', JSON.stringify(budgetGoals));
                            localStorage.setItem('settings', JSON.stringify(settings));
                            
                            // 뷰 업데이트
                            updateRecentEntries();
                            updateAssetsView();
                            initSettingsView();
                            
                            alert('데이터를 성공적으로 가져왔습니다! 📥');
                        }
                    } catch (error) {
                        alert('파일을 읽는 중 오류가 발생했습니다.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // 데이터 초기화
        function resetData() {
            if (confirm('정말로 모든 데이터를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.')) {
                if (confirm('한 번 더 확인합니다. 모든 데이터가 삭제됩니다.')) {
                    localStorage.clear();
                    location.reload();
                }
            }
        }

        // 자산 유형 변경 시 카테고리 업데이트
        document.getElementById('assetType').addEventListener('change', updateAssetCategories);

        // 공유 뷰 초기화
        function initShareView() {
            updateShareStatus();
            updateActiveSharesList();
        }

        // 공유 상태 업데이트
        function updateShareStatus() {
            const container = document.getElementById('shareStatus');
            
            if (activeShares.length === 0 && connectedShares.length === 0) {
                container.innerHTML = '<p class="text-gray-500">현재 활성화된 공유가 없습니다.</p>';
                return;
            }
            
            let html = '';
            
            if (activeShares.length > 0) {
                html += `<div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                    <p class="text-blue-700 font-medium">📤 내가 공유한 가계부: ${activeShares.length}개</p>
                </div>`;
            }
            
            if (connectedShares.length > 0) {
                html += `<div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                    <p class="text-green-700 font-medium">📥 연결된 가계부: ${connectedShares.length}개</p>
                </div>`;
            }
            
            container.innerHTML = html;
        }

        // 공유 링크 생성
        function generateShareLink() {
            const shareType = document.getElementById('shareType').value;
            const shareEntries = document.getElementById('shareEntries').checked;
            const shareAssets = document.getElementById('shareAssets').checked;
            const shareBudgets = document.getElementById('shareBudgets').checked;
            const shareExpiry = document.getElementById('shareExpiry').value;
            
            if (!shareEntries && !shareAssets && !shareBudgets) {
                alert('공유할 데이터를 최소 하나는 선택해주세요.');
                return;
            }
            
            // 공유 코드 생성 (6자리 랜덤)
            const shareCode = Math.random().toString(36).substring(2, 8).toUpperCase();
            
            // 공유 데이터 준비
            const sharedData = {
                entries: shareEntries ? entries : [],
                assets: shareAssets ? assets : [],
                budgetGoals: shareBudgets ? budgetGoals : {},
                categories: categories,
                settings: settings
            };
            
            // 만료일 계산
            let expiryDate = null;
            if (shareExpiry) {
                expiryDate = new Date();
                expiryDate.setDate(expiryDate.getDate() + parseInt(shareExpiry));
            }
            
            // 공유 정보 저장
            const shareInfo = {
                id: Date.now(),
                code: shareCode,
                type: shareType,
                data: sharedData,
                createdAt: new Date().toISOString(),
                expiryDate: expiryDate ? expiryDate.toISOString() : null,
                accessCount: 0
            };
            
            activeShares.push(shareInfo);
            shareData[shareCode] = shareInfo;
            
            localStorage.setItem('activeShares', JSON.stringify(activeShares));
            localStorage.setItem('shareData', JSON.stringify(shareData));
            
            // 공유 링크 표시
            const shareUrl = `${window.location.origin}${window.location.pathname}?share=${shareCode}`;
            document.getElementById('shareUrl').value = shareUrl;
            document.getElementById('shareCode').value = shareCode;
            document.getElementById('generatedLink').style.display = 'block';
            
            updateActiveSharesList();
            updateShareStatus();
            
            alert('공유 링크가 생성되었습니다! 🎉');
        }

        // 공유 링크 복사
        function copyShareLink() {
            const shareUrl = document.getElementById('shareUrl');
            shareUrl.select();
            document.execCommand('copy');
            alert('공유 링크가 복사되었습니다! 📋');
        }

        // 공유 코드 복사
        function copyShareCode() {
            const shareCode = document.getElementById('shareCode');
            shareCode.select();
            document.execCommand('copy');
            alert('공유 코드가 복사되었습니다! 📋');
        }

        // 공유 코드로 연결
        function connectWithCode() {
            const inputCode = document.getElementById('inputShareCode').value.trim().toUpperCase();
            
            if (!inputCode) {
                alert('공유 코드를 입력해주세요.');
                return;
            }
            
            // 시뮬레이션: 실제로는 서버에서 확인해야 함
            // 여기서는 로컬 스토리지의 shareData에서 확인
            if (!shareData[inputCode]) {
                alert('유효하지 않은 공유 코드입니다.');
                return;
            }
            
            const sharedInfo = shareData[inputCode];
            
            // 만료 확인
            if (sharedInfo.expiryDate && new Date() > new Date(sharedInfo.expiryDate)) {
                alert('만료된 공유 코드입니다.');
                return;
            }
            
            // 이미 연결된 코드인지 확인
            if (connectedShares.some(share => share.code === inputCode)) {
                alert('이미 연결된 가계부입니다.');
                return;
            }
            
            // 연결 정보 저장
            const connectionInfo = {
                code: inputCode,
                type: sharedInfo.type,
                connectedAt: new Date().toISOString(),
                ownerName: `사용자_${inputCode.substring(0, 3)}`
            };
            
            connectedShares.push(connectionInfo);
            localStorage.setItem('connectedShares', JSON.stringify(connectedShares));
            
            // 접근 횟수 증가
            sharedInfo.accessCount++;
            shareData[inputCode] = sharedInfo;
            localStorage.setItem('shareData', JSON.stringify(shareData));
            
            document.getElementById('inputShareCode').value = '';
            updateShareStatus();
            updateActiveSharesList();
            
            alert(`가계부에 성공적으로 연결되었습니다! (${sharedInfo.type === 'view' ? '보기 전용' : '편집 가능'}) 🎉`);
        }

        // 활성 공유 목록 업데이트
        function updateActiveSharesList() {
            const container = document.getElementById('activeShares');
            
            if (activeShares.length === 0 && connectedShares.length === 0) {
                container.innerHTML = '<p class="text-gray-500">활성화된 공유가 없습니다.</p>';
                return;
            }
            
            let html = '';
            
            // 내가 공유한 목록
            if (activeShares.length > 0) {
                html += '<h4 class="font-medium text-gray-800 mb-3">📤 내가 공유한 가계부</h4>';
                activeShares.forEach(share => {
                    const isExpired = share.expiryDate && new Date() > new Date(share.expiryDate);
                    html += `
                        <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg ${isExpired ? 'bg-gray-50' : 'bg-white'}">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${share.type === 'view' ? 'text-blue-600 bg-blue-50' : 'text-green-600 bg-green-50'}">
                                        ${share.type === 'view' ? '보기 전용' : '편집 가능'}
                                    </span>
                                    <span class="text-sm font-mono font-medium">${share.code}</span>
                                    ${isExpired ? '<span class="text-xs text-red-500">(만료됨)</span>' : ''}
                                </div>
                                <p class="text-xs text-gray-500 mt-1">
                                    생성일: ${new Date(share.createdAt).toLocaleDateString()} | 
                                    접근 횟수: ${share.accessCount}회
                                    ${share.expiryDate ? ` | 만료일: ${new Date(share.expiryDate).toLocaleDateString()}` : ''}
                                </p>
                            </div>
                            <button onclick="deleteShare('${share.code}')" class="text-red-500 hover:text-red-700 transition-colors">
                                🗑️
                            </button>
                        </div>
                    `;
                });
            }
            
            // 연결된 가계부 목록
            if (connectedShares.length > 0) {
                if (activeShares.length > 0) html += '<div class="my-4 border-t border-gray-200"></div>';
                html += '<h4 class="font-medium text-gray-800 mb-3">📥 연결된 가계부</h4>';
                connectedShares.forEach(connection => {
                    html += `
                        <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg bg-white">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${connection.type === 'view' ? 'text-blue-600 bg-blue-50' : 'text-green-600 bg-green-50'}">
                                        ${connection.type === 'view' ? '보기 전용' : '편집 가능'}
                                    </span>
                                    <span class="text-sm font-medium">${connection.ownerName}의 가계부</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">
                                    연결일: ${new Date(connection.connectedAt).toLocaleDateString()} | 
                                    코드: ${connection.code}
                                </p>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="viewSharedData('${connection.code}')" class="text-blue-500 hover:text-blue-700 transition-colors text-sm">
                                    👁️ 보기
                                </button>
                                <button onclick="disconnectShare('${connection.code}')" class="text-red-500 hover:text-red-700 transition-colors">
                                    🔌
                                </button>
                            </div>
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html;
        }

        // 공유 삭제
        function deleteShare(code) {
            if (confirm('이 공유를 삭제하시겠습니까?')) {
                activeShares = activeShares.filter(share => share.code !== code);
                delete shareData[code];
                
                localStorage.setItem('activeShares', JSON.stringify(activeShares));
                localStorage.setItem('shareData', JSON.stringify(shareData));
                
                updateActiveSharesList();
                updateShareStatus();
            }
        }

        // 공유 연결 해제
        function disconnectShare(code) {
            if (confirm('이 가계부 연결을 해제하시겠습니까?')) {
                connectedShares = connectedShares.filter(connection => connection.code !== code);
                localStorage.setItem('connectedShares', JSON.stringify(connectedShares));
                
                updateActiveSharesList();
                updateShareStatus();
            }
        }

        // 공유된 데이터 보기
        function viewSharedData(code) {
            if (!shareData[code]) {
                alert('공유 데이터를 찾을 수 없습니다.');
                return;
            }
            
            const sharedInfo = shareData[code];
            const data = sharedInfo.data;
            
            // 새 창에서 공유 데이터 표시 (간단한 요약)
            let summary = `=== 공유된 가계부 데이터 ===\n\n`;
            
            if (data.entries && data.entries.length > 0) {
                const totalIncome = data.entries.filter(e => e.type === 'income').reduce((sum, e) => sum + e.amount, 0);
                const totalSavings = data.entries.filter(e => e.type === 'savings').reduce((sum, e) => sum + e.amount, 0);
                const totalExpense = data.entries.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.amount, 0);
                
                summary += `📊 수입/지출 요약:\n`;
                summary += `- 총 수입: ${totalIncome.toLocaleString()}원\n`;
                summary += `- 총 저축: ${totalSavings.toLocaleString()}원\n`;
                summary += `- 총 지출: ${totalExpense.toLocaleString()}원\n`;
                summary += `- 순 자산 변화: ${(totalIncome - totalSavings - totalExpense).toLocaleString()}원\n\n`;
            }
            
            if (data.assets && data.assets.length > 0) {
                const totalAssets = data.assets.filter(a => a.type === 'asset').reduce((sum, a) => sum + a.amount, 0);
                const totalLiabilities = data.assets.filter(a => a.type === 'liability').reduce((sum, a) => sum + a.amount, 0);
                
                summary += `💎 자산 요약:\n`;
                summary += `- 총 자산: ${totalAssets.toLocaleString()}원\n`;
                summary += `- 총 부채: ${totalLiabilities.toLocaleString()}원\n`;
                summary += `- 순 자산: ${(totalAssets - totalLiabilities).toLocaleString()}원\n\n`;
            }
            
            summary += `📅 데이터 생성일: ${new Date(sharedInfo.createdAt).toLocaleString()}\n`;
            summary += `🔒 권한: ${sharedInfo.type === 'view' ? '보기 전용' : '편집 가능'}`;
            
            alert(summary);
        }

        // URL에서 공유 코드 확인 (페이지 로드 시)
        function checkShareCode() {
            const urlParams = new URLSearchParams(window.location.search);
            const shareCode = urlParams.get('share');
            
            if (shareCode) {
                document.getElementById('inputShareCode').value = shareCode;
                showPage('share');
                
                // 자동으로 연결 시도
                setTimeout(() => {
                    if (confirm(`공유 코드 "${shareCode}"로 가계부에 연결하시겠습니까?`)) {
                        connectWithCode();
                    }
                }, 500);
            }
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            init();
            checkShareCode();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97ba31a7e2ddaa4a',t:'MTc1NzI4OTkyNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
